---
title: "I see you"
subtitle: "Base de Dados IMDB"
author: "Marcio Vakassugui"
date: "2022-05-10"
output: 
  html_document: 
    code_folding: hide
    includes:
      in_header: "cabecalho.html"
    theme: paper
    highlight: zenburn
    toc: yes
    toc_float: yes
    smooth_scroll: no
    collapsed: yes
  html_notebook: 
    toc: yes
---

```{r setup }
#| include=FALSE

knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  align = "center",
  fig.height = 7,
  fig.width = 14
)
```
<br><br>

# Introdução

<br>

::: {align="justify" style="text-indent: 3em;"}
O presente trabalho foi elaborado tendo como propósito analisar os dados de uma das maiores bases pesquisáveis sobre filmes e séries do mundo e transformar estes dados brutos em informações. Trata-se da base IMDB (*Internet Move Database*) disponíbilizada por um dos mais respeitados *sites* de crítica popular de filmes. 

Aos apaixonados pela sétima arte, que não abrem mão de assistir a um filme, no aconchego de casa ou em uma sala de cinema, trarei algumas curiosidades da indústria cinematográfica e , em especial, de um filme que impressionou o público em 2009 com a qualidade dos efeitos visuais e que deve retornar às telas dos cinemas em breve para a continuação da saga (*The Way of Water*). Avatar de James Cameron, um dos maiores sucessos de bilheteria da história. 


```{r figura 01 -  avatar 2}
#| fig.align = "center",
#| out.width = "40%",
#| echo = FALSE

knitr::include_graphics("https://i.imgur.com/gvwmCrU.jpeg")
```

Caso desejem ver os códigos em R, eles estão disponíveis por meio dos botões `CODE` ao lado de cada visualização.

:::


```{r carregar os pacotes}
#| echo = FALSE

library(readr)                                                                                      # leitura.
library(tidyverse)                                                                              # manipulação.
library(lubridate)                                                                     # manipulação de datas.
library(forcats)                                                                    # maninpulação de factors.
library(kableExtra)                                                                                 # tabelas.
library(plotly)                                                                      # extensão para gráficos.
library(gghighlight)                                                                 # extensão para gráficos.
library(ggtext)                                                                      # extensão para gráficos.
library(ggthemes)                                                                     # temas para relatórios.
library(here)
source("../R/funcoes_imdb.R")
```

```{r  Leitura das bases}
#| echo = FALSE

caminho_com_here_imdb <- here("data-raw", "imdb.rds")
caminho_com_here_imdb_aval <- here("data-raw", "imdb_avaliacoes.rds")
caminho_com_here_imdb_pessoas <- here("data-raw", "imdb_pessoas.rds")
caminho_com_here_tab_moedas <- here("data-raw", "siglas_moedas_paises.xlsx")

imdb <- read_rds(caminho_com_here_imdb)
imdb_avaliacoes <- read_rds(caminho_com_here_imdb_aval)
imdb_pessoas <- read_rds(caminho_com_here_imdb_pessoas)
    
```

```{r manipulação de dados}
#| echo = FALSE

# alterar o tipo da variável data_lancamento de "char" para "date" 

imdb_novo <- imdb |>    
  mutate(
    data_lancamento = ymd(data_lancamento),                                             # conversão para date.
  )
```

<br>

# Análises

<br>

::: {align="justify" style="text-indent: 3em;"}

As informações foram obtidas a partir da manipulação das bases ***imdb***, com dados gerais dos filmes e séries, ***imdb_pessoas***, com dados sobre os elencos de artistas, diretores e roteiristas e ***imdb_avaliacoes***, com notas e totais de avaliaçoes.

O imdb possui `r nrow(imdb)` linhas com `r ncol(imdb)` variáveis dos filmes produzidos entre 1894 e 2020. O imdb_pessoas por sua vez conta com  `r nrow(imdb_pessoas)` linhas e `r ncol(imdb_pessoas)` colunas e o imdb_avaliacoes com um total de `r nrow(imdb_avaliacoes)` linhas e `r ncol(imdb_avaliacoes)` colunas.

As operações de importação, arrumação, transformação e visualização dos dados foram realizadas por meio da linguagem R, seus pacotes e extensões.

Na seção Anexos, ao final deste relatório, disponilizamos os dicionários das bases com a lista de variáveis e definições. 

:::

<br>

### 1. Evolução da produção da indústria cinematográfica

<br>

::: {align="justify" style="text-indent: 3em;"}

Em 28 de setembro de 1895, os irmãos Lumière realizaram a primeira exibição pública do cinematógrafo, uma invenção que imprimia uma sucessão de fotos em um filme de celulose e que por meio de uma manivela reproduzia as imagens em sequência, transformando as figuras estáticas em imagens dinâmicas projetadas sobre uma tela. Desde então, milhares de filmes foram produzidos, tendo o auge em quantidades de produções em 2018 e interrompida pela pandemia de SARS COV-2.

De acordo com a base imdb, podemos observar no gráfico abaixo que a quantidade de filmes produzidos evoluiu de 1 obra em 1894 para 271 obras em 1946, pós Segunda Guerra Mundial, e então para 3281 lançamentos em 2018. Entretanto, com o isolamento do público devido à pandemia, a indústria cinematográfica, mais dependente dos serviços de streaming, adiou os lançamentos de seus filmes, provocando a redução no número de produções como pode ser observado no gráfico 01.
:::


<br><br>

```{r plot01 - qtde de filmes x ano}
#| echo = TRUE,
#| fig.height = 4,
#| fig.width = 9,
#| fig.cap = "Gráfico 01 - Evolução da Industria Cinematográfica. Fonte: Base de dados Imdb",
#| highlight = TRUE

p01_filmes_ano <- imdb_novo |> 
  mutate(ano_lancamento = year(data_lancamento)) |>                            # coluna com ano de lançamento.
  select(ano_lancamento) |> 
  drop_na() |>
  group_by(ano_lancamento) |> 
  summarise(qte = n()) |>                                                   # resumo quantidade de filmes/ano.
  slice_head(n=112) |>                 
  ggplot()+
  aes(x = ano_lancamento, 
      y = qte)+
  annotate("rect",                                                              # anotação retangular em 2018.
           xmin = 2010,
           xmax = 2026,
           ymin = 2950, 
           ymax = 3500,
           fill = "#99D8FF", 
           alpha = 0.3
           ) +
  annotate("text",                                                          # anotação de texto - ano de 2018.
           x = 1970, 
           y = 3281,
           label = "Auge da produção cinematográfica", 
           size = 3
           ) +
  geom_segment(aes(y = 3281,                                                              # linha de anotação.
                   x = 1992,  
                   xend = 2009,     
                   yend = 3281   
                   ), 
               size = 0.3,
               fill = "#000000"   
               ) +
  geom_line(color = "#4C586B")+                                                            # gráfico de linha.
  geom_point(color = "#A71D31",                                                           # gráfico de pontos.
             shape = 7,
             size = 0.7
             )+
  gghighlight(ano_lancamento >=1946,                                         # destaca anos superiores a 1960.
              unhighlighted_params = list(colour = "#4C586B")
              )+
  labs(title = "Total de filmes por ano",                           
       x = "
    Ano",
    y = "Quantidade
    
    "
  )+
  scale_x_continuous(breaks = seq(0,                                     # escala x de 0 a 2022, step 10 anos.
                                  2022, 
                                  10
                                  )
                     ) +
  scale_y_continuous(breaks = seq(0,                                      # escala y de 0 a 4000, step de 500.
                                  4000, 
                                  500
                                  )
                     ) +
  theme_classic()                                                           
  
p01_filmes_ano |> 
  ggplotly()                                                                               # gráfico dinâmico.
```

<br><br>

### 2. O mês

::: {align="justify" style="text-indent: 3em;"}
O ano de 2018 com o maior números de *premieres* da história teve-se em outubro daquele ano o maior número de estreias da história. Foram 386 obras cinematográficas.

:::


```{r tab01 - mes x maior numero de lancamentos}

# coluna mes
imdb_datas <- imdb_novo |>
  mutate(mes = month(data_lancamento,                                                            # coluna mês.
                     label = TRUE, 
                     abbr = TRUE
                     )
         )  

# maior número de lançamentos mensal.
mes_maior_lancamento <- imdb_datas |>                        
  group_by(mes,
           ano
           ) |>        
  summarise(qte = n()) |>             
  drop_na() |> 
  slice_max(qte) |> 
  arrange(desc(qte))

# tabela com dados do mês e maior número de estreias.
tab01_mes_maior_lancamento <- mes_maior_lancamento |>   
  head(n=1) |> 
  kbl(align = "l",                                                                   # alinhamento à esquerda.
      col.names = c("Mês",                                                                # nome do cabeçalho.
                    "Ano de Lançamento", 
                    "Quantidade de Filmes"
                    ),
      full_width = TRUE,
      ) |> 
  kable_styling(bootstrap_options = c("striped", 
                                      "condensed"),
                html_font = "",
                font_size = 10,
                full_width = TRUE, 
                fixed_thead = list(enabled = TRUE, 
                                              background = "#EDF6FD")
  ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                                  # configurações das colunas.
              bold = FALSE,
              width = "10cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "10cm"
              ) |>
  column_spec(3,
              bold = FALSE,
              width = "10cm"
              ) |> 
  footnote(general = "Maior Quantidade de Filmes em um mês. Fonte: Base de dados IMDB.",                                # rodapé.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 01:",
  )

tab01_mes_maior_lancamento                                                               # visualiza a tabela.

```

<br>

::: {align="justify" style="text-indent: 3em;"}
Superou o maior total de lançamentos regitrados até então, setembro de 2017, quando ocorreram 358 lançamentos. No gráfico 02, encontra-se a relação dos 13 meses com os maiores números de estreias, todos entre os anos de 2014 e 2018, período de maior produção cinematográfica da história como destacado no gráfico 01.

:::


```{r plot02 - total de lançamentos x mês}
#| fig.height = 6,
#| fig.width = 14,
#| fig.cap = "Gráfico 02 - Meses com Maiores Totais de Lançamentos. Fonte: Base de dados Imdb",

# Cria o gráfico com 
meses_mais_qte <- mes_maior_lancamento |> 
  group_by(qte, ano) |>
  summarise(mes) |> 
  arrange(desc(qte)) |> 
  unite(col = "mes_ano", c("mes","ano"), sep = "/") |> 
  arrange(desc(qte)) |> 
  head(20) 

 
cores_plot02 <- c("#CC5A71", "#536265", "#536265", "#536265", "#536265","#536265",
                  "#536265", "#536265", "#536265", "#536265", "#536265","#536265",
                  "#536265")

plot02_lancamento_mes <- meses_mais_qte|> 
  ggplot(aes(x = fct_reorder(mes_ano, qte, .desc = TRUE), 
             y = qte, 
             fill = mes_ano,
             label = qte))+               # cria o gráfico de lollypop - combinando geom_point e geom_segment.
  geom_point(                                                                        # cria elemento circular.
    size = 5,                                                                                      # diâmetro.
    color = cores_plot02                                                                       # cor vermelha.
  )+
  geom_label(                                                                            # formatar os labels.
    size = 4,                                                               # diâmetro do círculo do lollypop.
    alpha = 0,                                                                     # elimina o fundo do label.
    label.size = NA,                                                  # elimina a moldura retangular do label.
    color = cores_plot02,                                                        # cor do círculo em vermelho.
    vjust = -1,                                                           # posição do label acima do círculo.
  ) +
  geom_segment(aes(x = mes_ano,                                                   # criar o elemento segmento.
                   xend = mes_ano,
                   y = 0,
                   yend = qte
                   ),
               color = cores_plot02,
               size = 1.5,                                                              # largura do segmento.
  )+
  labs(                                                                # editar o texto do título em markdown.
    title = "Total de lançamentos por *<span style = 'color:#CC5A71;'>mês </span>*",
    subtitle ="Os meses com maior quantidade de estreias",                 # editao o texto subtítulo em text.
    y = "Quantidade de filmes
    ",
    x = "
    Meses do ano"
  ) +
  theme_classic()+                                                               # seleção do tema do gráfico.
  scale_y_continuous(breaks = seq(0, 500, 50),
                     limits = c(0, 500),
                     expand = expansion(add = c(0,0)))+                                       # formatar escala do eixo y.  
  theme_imdb()

plot02_lancamento_mes                                                                   # visualiza o gráfico.
```

<br><br>

::: {align="justify" style="text-indent: 3em;"}

Abaixo temos os 5 filmes deste mês de outubro de acordo com suas notas médias IMDB. Consideramos somente os filmes com mais de 100000 avaliações. 

:::
```{r tab02 - 5 filmes de outubro de 2018 com maior ranking }

## Manipulação da base para obtenção da relação dos 15 filmes  de outubro de 2018 por ranking 
mes_maior_lancamento <- imdb_datas |>                                # lista dos 15 filmes com melhor ranking.
  group_by(mes) |>        
  summarise(qte = n(),
            titulo,
            data_lancamento, 
            nota_imdb, 
            num_avaliacoes,
            pais,
            ano = year(data_lancamento)) |>
  filter(mes == "out" & ano == 2018 & num_avaliacoes >= 100000) |> 
  arrange(desc(nota_imdb)) |> 
  slice_head(n=5)

mes_maior_lancamento$mes <- NULL                                                        # Exclusão de colunas. 
mes_maior_lancamento$qte <- NULL

## Tabela com os 15 filmes  de outubro de 2018com melhores rankings
mes_maior_lancamento |> 
  select(titulo, data_lancamento, nota_imdb, num_avaliacoes, pais) |> 
kbl(
  align = "l",                                                            # alinhamento do texto do cabeçalho.
  col.names = c("título",                                                       # define o nome das variáveis.
                "lançamento", 
                "nota",
                "avaliações",
                "país"),
  ) |> 
  kable_styling(                                                          # altera as configurações da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "",
    font_size = 10,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD"),
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                        # altera as configurações das colunas.
              bold = FALSE,
              width = "10cm",
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "4cm"
              
              ) |>
  column_spec(3,
              bold = FALSE,
              width = "2cm"
              ) |> 
  column_spec(4,
              bold = FALSE,
              width = "4cm"
              ) |> 
  column_spec(5,
              bold = FALSE,
              width = "10cm"
              ) |> 
  footnote(general = "Top 5 filmes Nota Média/ Outubro 2018. Fonte: Base de dados IMDB.",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 02:",
           )
```

<br>

::: {align="justify" style="text-indent: 3em;"}
Apresentamos um resumo dos dados da base IMDB sobre estes filmes.
:::

<br>

```{r imdb com lucros }
#| echo = FALSE

# considerando apenas o valores em dólares

imdb_filmes_dolares <- imdb_novo |>
  #select(orcamento, receita, genero, titulo) |> 
  filter(str_detect(orcamento, pattern = "\\$.*"))

# eliminar o símbolo $ nos valores das colunas orçamento e receita

imdb_filmes_dolares <- imdb_filmes_dolares |> 
  mutate(orcamento = str_remove(orcamento, pattern = "\\$ "),
         receita = str_remove(receita, pattern = "\\$ "))


# alterar o tipo das variáveis orcamento e  receita

imdb_filmes_dolares$orcamento <- as.numeric(imdb_filmes_dolares$orcamento)
imdb_filmes_dolares$receita <- as.numeric(imdb_filmes_dolares$receita)

  
# calcular o lucro dos filmes

imdb_filmes_dolares <- imdb_filmes_dolares |> 
  mutate(
    lucro = receita - orcamento
  ) |>
  drop_na()



```


####  {.tabset .tabset-fade}

##### A Star is Born

```{r cod filme nasce uma estrela}

imdb_nasce_uma_estrela <- imdb_filmes_dolares |> 
  filter(titulo == "A Star Is Born") |> 
  mutate(thumbnail_nasce_uma_estrela = "../data-raw/nasce_uma_estrela_thumbnail.jpg") |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao,
         elenco, orcamento, receita, genero, lucro, thumbnail_nasce_uma_estrela)
  
```

```{r figura 02 - imagem do filme nasce uma estrela}
#| fig.float= "right",
#| out.width = "30%",
#| echo = FALSE

knitr::include_graphics(imdb_nasce_uma_estrela$thumbnail_nasce_uma_estrela)
```


::: {align="justify" style="text-indent: 3em;"}
O filme "**`r imdb_nasce_uma_estrela$titulo`**" foi  lançado  no Brasil como "**Nasce uma Estrela**". Pertence aos gêneros `r imdb_nasce_uma_estrela$genero`. Sua *premier* ocorreu em `r imdb_nasce_uma_estrela$data_lancamento`,  com duração de `r imdb_nasce_uma_estrela$duracao` minutos sob a direção de `r imdb_nasce_uma_estrela$direcao`. Roteiro de `r imdb_nasce_uma_estrela$roteiro`.  
Contou com a participação de `r imdb_nasce_uma_estrela$elenco` em seu elenco.  
A obra teve um orçamento, de acordo com a base, de US`r imdb_nasce_uma_estrela$orcamento/1000000` milhões e uma receita de US`r round(imdb_nasce_uma_estrela$receita/1000000,2)` milhões, obtendo um **`r ifelse(imdb_nasce_uma_estrela$lucro >0, "lucro", "prejuízo" )`** de US$`r round(imdb_nasce_uma_estrela$lucro/1000000,2)` milhões.  
**Sinopse: Um experiente músico descobre a jovem artista desconhecida a quem ajuda a encontrar fama, mas acaba se apaixonando por ela. O relacionamento pessoal entre os dois começa a desandar à medida que Jack luta contra problemas com alcolismo.**  
***Fonte: https://www.imdb.com/title/tt1517451/?ref_=fn_al_tt_1***
:::
<br>

##### Searching

```{r cod filme searching}

imdb_searching <- imdb_filmes_dolares |> 
  filter(titulo == "Searching") |> 
  mutate(thumbnail_searching = "../data-raw/Buscando_thumbnail.jpg") |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao,
         elenco, orcamento, receita, genero, lucro, thumbnail_searching)
```

```{r figura 03 - imagem do filme searching}
#| fig.float= "right",
#| out.width = "30%",
#| echo = FALSE

knitr::include_graphics(imdb_searching$thumbnail_searching)
```

::: {align="justify" style="text-indent: 3em;"}
O filme "**`r imdb_searching$titulo`**" foi  lançado  no Brasil como "**Buscando**". Pertence aos gêneros `r imdb_searching$genero`. Sua *premier* ocorreu em `r imdb_searching$data_lancamento`,  com duração de `r imdb_searching$duracao` minutos sob a direção de `r imdb_searching$direcao`. Roteiro de `r imdb_searching$roteiro`.  

Contou com a participação de `r imdb_searching$elenco` em seu elenco.  
A obra teve um orçamento, de acordo com a base, de US`r imdb_searching$orcamento/1000000` milhões e uma receita de US`r round(imdb_searching$receita/1000000,2)` milhões, obtendo um **`r ifelse(imdb_searching$lucro >0, "lucro", "prejuízo" )`** de US$`r round(imdb_searching$lucro/1000000,2)` milhões.  
**Sinopse: Depois que sua filha de 16 anos desaparece, um pai desesperado entra em seu laptop procurando pistas para encontrá-la.**  
***Fonte: https://www.imdb.com/title/tt7668870/?ref_=fn_al_tt_1***

:::

##### First Man

```{r cod filme first man}

imdb_firstman <- imdb_filmes_dolares |> 
  filter(titulo == "First Man - Il primo uomo") |> 
  mutate(thumbnail_firstman = "../data-raw/first_man_thumbnail.jpg") |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao,
         elenco, orcamento, receita, genero, lucro, thumbnail_firstman)

```

```{r figura 04 -imagem do filme first man}
#| fig.float= "right",
#| out.width = "15%",
#| echo = FALSE

knitr::include_graphics(imdb_firstman$thumbnail_firstman)
```

::: {align="justify" style="text-indent: 3em;"}
O filme "**`r imdb_firstman$titulo`**" foi  lançado  no Brasil como "**O Primeiro Homem**". Pertence aos gêneros `r imdb_firstman$genero`. Sua *premier* ocorreu em `r imdb_firstman$data_lancamento`,  com duração de `r imdb_firstman$duracao` minutos sob a direção de `r imdb_firstman$direcao`. Roteiro de `r imdb_firstman$roteiro`.  
Contou com a participação de `r imdb_firstman$elenco` em seu elenco.  
A obra teve um orçamento, de acordo com a base, de US`r imdb_firstman$orcamento/1000000` milhões e uma receita de US`r round(imdb_firstman$receita/1000000,2)` milhões, obtendo um **`r ifelse(imdb_firstman$lucro >0, "lucro", "prejuízo" )`** de US$`r round(imdb_firstman$lucro/1000000,2)` milhões.  
**Sinopse: Um olhar sobre a vida do astronauta Neil Armstrong e a lendária missão espacial que o levou a ser o primeiro homem a camihar na Lua.**   ***Fonte: https://www.imdb.com/title/tt1213641/?ref_=fn_al_tt_1***

:::


##### Soldado

```{r cod filme soldado}

imdb_soldado <- imdb_filmes_dolares |> 
  filter(titulo == "Soldado") |> 
  mutate(thumbnail_soldado = "../data-raw/sicario_thumbnail.jpg") |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao,
         elenco, orcamento, receita, genero, lucro, thumbnail_soldado)
```

```{r figura 05 - imagem do filme soldado}
#| fig.float= "right",
#| out.width = "15%",
#| echo = FALSE

knitr::include_graphics(imdb_soldado$thumbnail_soldado)
```

::: {align="justify" style="text-indent: 3em;"}
O filme "**`r imdb_soldado$titulo`**" foi  lançado  no Brasil como "**Sicario 2 - Soldado**". Pertence aos gêneros `r imdb_soldado$genero`. Sua *premier* ocorreu em `r imdb_soldado$data_lancamento`,  com duração de `r imdb_soldado$duracao` minutos sob a direção de `r imdb_soldado$direcao`. Roteiro de `r imdb_soldado$roteiro`.  
Contou com a participação de `r imdb_soldado$elenco` em seu elenco.  
A obra teve um orçamento, de acordo com a base, de US`r imdb_soldado$orcamento/1000000` milhões e uma receita de US`r round(imdb_soldado$receita/1000000,2)` milhões, obtendo um **`r ifelse(imdb_soldado$lucro >0, "lucro", "prejuízo" )`** de US$`r round(imdb_soldado$lucro/1000000,2)` milhões.  
**Sinopse: A guerra contra as drogas na fronteira do México com os Estados Unidos aumenta quando os cartéis começam a introduzir terroristas no território americano.**  ***Fonte: https://www.imdb.com/title/tt5052474/?ref_=fn_al_tt_3***

:::

##### 7 sconosciuti a El Royale

```{r cod filme 7 sconosciuti a El Royale}

imdb_royale <- imdb_filmes_dolares |> 
  filter(titulo == "7 sconosciuti a El Royale") |> 
  mutate(thumbnail_royale = "../data-raw/maus_momentos_em_royale_thumbnail.jpg") |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao,
         elenco, orcamento, receita, genero, lucro, thumbnail_royale)

```

```{r figura 06 - imagem do filme 7 sconosciuti a El Royale}
#| fig.float= "right",
#| out.width = "20%",
#| echo = FALSE

knitr::include_graphics(imdb_royale$thumbnail_royale)
```

::: {align="justify" style="text-indent: 3em;"}
O filme "**`r imdb_royale$titulo`**" foi  lançado  no Brasil como "**Maus Momentos no Hotel Royale**". Pertence aos gêneros `r imdb_royale$genero`. Sua *premier* ocorreu em `r imdb_royale$data_lancamento`,  com duração de `r imdb_royale$duracao` minutos sob a direção de `r imdb_royale$direcao`. Roteiro de `r imdb_royale$roteiro`.  
Contou com a participação de `r imdb_royale$elenco` em seu elenco.  
A obra teve um orçamento, de acordo com a base, de US`r imdb_royale$orcamento/1000000` milhões e uma receita de US`r round(imdb_royale$receita/1000000,2)` milhões, obtendo um **`r ifelse(imdb_royale$lucro >0, "lucro", "prejuízo" )`** de US$`r round(imdb_royale$lucro/1000000,2)` milhões.  
**Sinopse: Em 1969 alguns estranhos com segredos se conhecem por casualidade no hotel El Royale no lago Tahoe. Durante uma das noites, cada um mostrará sua verdadeir personalidade.**
***fonte: https://www.imdb.com/title/tt6628394/?ref_=fn_al_tt_1***
:::

### 2. O dia

<br>

::: {align="justify" style="text-indent: 3em;"}

No Brasil, as estreias dos filmes ocorrem nas quintas-feiras. Neste mês,maio de 2022, tivemos os lançamentos de "Doutor Estranho no Multiverso da Loucura"  e "A Vida é Agora" (05/05/2022), "Chamas da Vingança" (19/05/2022), o filme nacional "Vovó Ninja" e "Top Gun: Maverick" (26/05/2022). 

Na base imdb, conforme a tabela 03, a grande maioria dos filmes e séries estreiaram no primeiro dia dos meses. A diferença é significativa em relação aos demais dias como pode ser visto no gráfico 03.
<br>

:::

```{r tab03 - dia com o maior numero de lancamento}

#### Manipulação da base para a obtencão do dia com o maior número de lançamentos
dia_maior_lancamento <- imdb_novo |> 
  mutate(dia = day(data_lancamento)) |> 
  group_by(dia) |> 
  summarise(qtde = n()) |> 
  drop_na() |> 
  slice_max(order_by = qtde)

### Tabela com os dados do dia com maior número de lançamentos
dia_maior_lancamento |>                                                                
  kbl(align = "l",                                                        # alinhamento do texto do cabeçalho.
      col.names = c("Dia",                                                        # define o nome das colunas.
                  "Quantidade de Filmes"
                  ),
      ) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),                                  # define estilo da tabela.
    html_font = "",
    font_size = 10,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE,
                       background = "#EDF6FD"
                       )
                ) |> 
  kable_classic_2() |>                                                              # define o tema da tabela.
  column_spec(1,                                                            # define os padrões da coluna dia.
              bold = FALSE,
              width = "15cm"
              ) |>      
  column_spec(2,                                # define os padrões da coluna "Quantidade de Filmes Lançados".
              bold = FALSE,
              width = "15cm"
              ) |> 
  footnote(general = "Dia com maior número de lançamentos. fonte: Base de dados IMDB.",               # cria o rodapé da tabela.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 03:",
           )
```

<br>


```{r plot03 - lancamentos x dias}
#| echo = TRUE,
#| fig.cap = "Gráfico 03 - Total de lançamentos por dia. Fonte: Base de dados Imdb",
#| highlight = TRUE

### Grafico dias com maior quantidade de filmes 
plot03_dia_filmes <- imdb_novo |> 
  mutate(dia = day(data_lancamento)) |> 
  group_by(dia) |> 
  summarise(qtde = n()) |> 
  drop_na() |> 
  ggplot()+                              # cria o gráfico de lollypop - combinando geom_point e geom_segment.
  aes(x = dia, 
      y = qtde, 
      fill = dia, 
      label = qtde)+
  geom_point(                                                                       # cria elemento circular.
    size = 5,                                                                                     # diâmetro.
    color = "#CC5A71"                                                                         # cor vermelha.
  )+
  geom_label(                                                                           # formatar os labels.
    size = 4,                                                              # diâmetro do círculo do lollypop.
    alpha = 0,                                                                    # elimina o fundo do label.
    label.size = NA,                                                 # elimina a moldura retangular do label.
    color = "#CC5A71",                                                          # cor do círculo em vermelho.
    vjust = -1,                                                          # posição do label acima do círculo.
  ) +
  geom_segment(aes(x = dia,                                                      # criar o elemento segmento.
                   xend = dia,
                   y = 0,
                   yend = qtde
  ),
  size = 1.5,                                                                          # largura do segmento.
  color = "#CC5A71"                                                            # cor do segmento em vermelho.
  )+
  gghighlight(dia == 1 | dia == 31,                                                 # destaca os dias 1 e 31. 
              unhighlighted_params = list(colour = "#4C586B")                     # cor cinza para os demais.
  )+
  labs(                                                               # editar o texto do título em markdown.
    title = "Total de lançamentos por *<span style = 'color:#CC5A71;'>dia </span>*",
    subtitle ="Os dias com maior e menor quantidade de estreias",         # editao o texto subtítulo em text.
    y = "Quantidade de filmes
    ",
    x = "
    Dias do mês"
  ) +
  theme_classic()+                                                              # seleção do tema do gráfico.
  scale_y_continuous(breaks = seq(0, 8000, 1000),
                     limits = c(0,8000),
                     expand = c(0,0)) +                                       # formatar escala do eixo y.  
  scale_x_continuous(breaks = seq(0, 31, 1)) +                                   # formatar escala do eixo x.
  theme_imdb()

plot03_dia_filmes                                                                      # visualiza o gráfico.

```


<br>

### 3. Os paises com maior número de filmes

<br>

::: {align="justify" style="text-indent: 3em;"}
Embora a indústria cinematográfica indiana seja a que  mais crie obras, a base Imdb mostra que os EUA são de longe o país com a maior quantidade de filmes ao longo da história. 

:::

<br>

```{r top 5 de paises com mais filmes na base}
#| fig.out = 100

## Manipulação da base para a obtencão dos 5 países com mais filmes na base
top_5_paises <- imdb_novo |> 
  group_by(pais) |> 
  summarise(qtde = n()) |> 
  arrange(desc(qtde)) |> 
  slice_head(n=5)

## Tabela com os dados do dia com maior número de lançamentos
top_5_paises |>                                                                        
  kbl(align = "l",                                                        # alinhamento do texto do cabeçalho.
      col.names = c("País",                                                       # define o nome das colunas.
                  "Quantidade de Filmes"
                  ),
      ) |> 
  kable_styling(  bootstrap_options = c("striped",                                # define o estilo da tabela.
                                        "condensed"),
                  html_font = "Arial",
                  font_size = 10,
                  full_width = TRUE, 
                  fixed_thead = list(enabled = TRUE, 
                                     background = "#EDF6FD"
                                     )
                  ) |> 
  kable_classic_2() |>                                                              # define o tema da tabela.
  column_spec(1,                                                   # altera as configurações da coluna "País".
              bold = FALSE,
              width = "15cm"
  ) |>      
  column_spec(2,                          # altera as configurações da coluna "Quantidade de Filmes Lançados".
              bold = FALSE,
              width = "15cm"
  ) |> 
  footnote(general = "Países maiores produtores de filmes. Fonte: Base de dados IMDB.",       # cria o rodapé.
           footnote_as_chunk = TRUE,                  
           fixed_small_size = TRUE,
           general_title = "Tabela 04:",
  )

```

```{r plot04 - paises x qtde de filmes}
#| echo = TRUE,
#| fig.height = 10,
#| fig.cap = "Gráfico 04 - Países e totais de lançamentos. Fonte: Base de dados Imdb",

### Manipulando os dados para obtenção dos 16 países com maiores quantidades de filmes lançados
top_16_paises <- imdb_novo |> 
  group_by(pais) |> 
  summarise(qtde = n()) |> 
  arrange(desc(qtde)) |> 
  slice_head(n=16)

### Palete de cores

cor <- c(                                                       # paleta  de cores para os elementos gráficos.
  "#c42847", "#ffad05", "#7d5ba6", "#00bbf9", "#2bc016",
  "#536265", "#536265", "#536265", "#536265", "#536265",
  "#536265", "#536265", "#536265", "#536265", "#536265",
  "#536265"
)

### Gráfico com os 16 países com maior número de filmes produzidos

plot_top_16_paises <- top_16_paises |> 
  ggplot(aes(y = fct_reorder(pais,      # reordenar a sequência dos países em ordem decrescente da quantidade.
                             qtde, 
                             .desc = FALSE
                             ),
             x = qtde, 
             label = qtde
             )
         ) +
  geom_col(fill = cor)+
  geom_label(size = 4.5,                                                                 # formatar os labels.
             alpha = 0,
             label.size = NA,    
             fontface = "bold",  
             color = cor,
             hjust = -0.3
             ) +
  geom_curve(aes(y = 14,                   # formatar curva para anotação " Relação dos países com mais.....".
                 x = 8000,  
                 xend = 15000,     
                 yend = 10
                 ),
             arrow = arrow(type = "closed",                                         # formata a seta da linha.
                           length = unit(0.02, "npc"
                                         )
                           ),
             curvature = -0.14,  
             color = "#000000" 
             ) +
  geom_curve(aes(y = 1,                             # formatar curva para anotação "Décima sexta posição....".
                 x = 3000,  
                 xend = 9500,     
                 yend = 2
                 ),
             arrow = arrow(type = "closed",                                         # formata a seta da linha.
                           length = unit(0.02,
                                         "npc") 
                           ),
             curvature = 0,                                                           # curvatura = 0 -- reta.
             color = "#000000"
             )+
  labs(                                                                            # define textos do gráfico.
    title = "Países com maior quantidade de lançamentos de filmes",
    subtitle = "Destaque para os cinco paises com maiores notas",
    x = "Quantidade de filmes lançados",
    y = "Paises"
  )+
  scale_x_continuous(                                                    # altera limites e quebras do eixo x.
    breaks = seq(0, 29000,2500),
    limits = c(0,29000),
    expand = expansion(add = c(0,1500)),
    labels = scales::number_format(accuracy = 0.1,
                                   decimal.mark = ",",
                                   big.mark = ".")
  )+
  scale_y_discrete(                                                    # altera limites e quebras do eixo x.
    expand = expansion(add = c(1,0))
  )+
  theme_classic()+                                                                 # define o tema do gráfico.
  theme_imdb()+    
  annotate( "text",
            x = 21000, y = 9, label = "Relação dos cinco países com mais lançamentos 
            registrados na base IMDB",
            color = "#000000", 
            size = 4,
            family = ""
  )+
  annotate( "text",
            x = 14000, y = 2, label = "Décima sexta posição do Brasil",
            color = "#000000", 
            size = 4,
            family = ""
  )

plot_top_16_paises

```

<br>

::: {align="justify" style="text-indent: 3em;"}

O Brasil possui 736 filmes na base, são obras de 1931 a 2020. A melhor média Imdb é a do filme "O Auto da Compadecida", avaliada por 11127  pessoas, que possui média de 8,6.  

Os outros quatro filmes com melhores notas estão relacionados na tabela 05.

:::

<br>

```{r tab04 - melhores filmes brasileiros - ranking imdb }

# Análise dos filmes brasileiros com maior ranking
top_5_filmes_brasil <- imdb_novo |> 
  filter(pais == "Brazil" & num_avaliacoes >= 10000) |> 
  summarise( titulo, 
             ano, 
             genero, 
             nota_imdb,
             num_avaliacoes)|>
  arrange(desc(nota_imdb)) |> 
  slice_head(n = 5)

# Gŕafico dos filmes brasileiros com maior ranking
top_5_filmes_brasil |>                                                                        
  kbl(
    align = "l",                                                          # alinhamento do texto do cabeçalho.
    col.names = c("Título",                                                       # define o nome das colunas.
                  "Ano",
                  "Gênero",
                  "Nota IMDB",
                  "Numero de Avaliações"),
    ) |> 
  kable_styling(                                                                  # altera o estilo da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                          # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "10cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              # background = "#022859",
              # color = "#FFFFFF",
              width = "5cm"
              ) |> 
  column_spec(3,                                                          # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "7cm"
              ) |>
  column_spec(4,                                                          # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>
  column_spec(5,                                                          # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>
    footnote(general = "Filmes nacionais com a melhores notas Imdb. Fonte: Base de dados IMDB.",                     # inseri o rodapé.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 05:",
           )
```

<br>

### 4. Lista de todas as moedas citadas na base

<br>

::: {align="justify" style="text-indent: 3em;"}
A variável orçamento representa o valor total estimado de gastos para a produção de um filme ou de uma série. A indústria movimenta bilhões de dólares utilizados na contratação de tecnologias para produção de efeitos especiasi e trilhas sonoras e contratação de seu elenco. 

A base Imdb possui os valores de orçamento em variadas moedas. Relacionamos todas as moedas presentes no *dataset* e apresentamo-las na tabela por código e divisa.

:::

<br>

```{r tab05 - moedas na base - orçamento}

# lista de todas as moedas da base - coluna orçamento
moedas_orcamento <- imdb_novo |> 
  select(orcamento) |>
  mutate(moeda = str_extract(string = orcamento,
                             pattern = "[\\w | \\$].* " )
         ) |> 
  distinct(moeda) |> 
  drop_na() |> 
  arrange(moeda)

moedas_orcamento <- moedas_orcamento |> 
  mutate(moeda = str_trim(moeda)) |> 
  mutate(moeda = str_replace(moeda, pattern = "\\$",
                             replacement = "USD"))

# utilizar uma base de moedas e suas divisas para juntar à tabela acima
# importar a tabela xls "siglas_moedas_paises"
tab_moedas <- readxl::read_xlsx(caminho_com_here_tab_moedas)

# juntar as tabelas moedas_receita e tab_moedas por meio da coluna moeda
moedas_orcamento_unificada<- left_join(x = moedas_orcamento,
                                       y = tab_moedas, 
                                       by = "moeda",
                                       copy = TRUE) |> 
  distinct(moeda, divisa) |> 
  mutate(divisa = str_to_title(divisa))

moedas_orcamento_unificada |> 
  kbl(
    align = "l",                                                          # alinhamento do texto do cabeçalho.
    col.names = c("Moeda",                                                        # define o nome das colunas.
                  "Divisa"
                  )
    ) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    html_font = "",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                          # altera as configurações da tabela.
              bold = FALSE,
              width = "15cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "15cm"
              ) |> 
  footnote(general = "Relação de moedas da base. Fonte:Base de dados IMDB.",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 06:",
           )
```

<br>

::: {align="justify" style="text-indent: 3em;"}
Totalizam `r nrow(moedas_orcamento_unificada)` diferentes moedas. Algumas não existem atualmente, como o Franco francês ou as outras 25 moedas dos paises do Bloco Europeu que passaram a utilizar o Euro.

:::
<br>

### 5. Maiores lucros da indústria por gêneros em toda história

<br>

::: {align="justify" style="text-indent: 3em;"}
Considerando a soma dos lucros dos filmes por gênero, vemos que os gêneros aventura, ação e comédia são as mais lucrativas. 
:::

<br>

```{r tab07 - maiores lucros por gênero na história}

# usar a base imdb, precisamos fazer a separação da coluna genero

imdb_filmes_dolares_genero <- imdb_filmes_dolares |> 
  separate(col = genero,
           into = c("genero1", "genero2", "genero3"),
           sep = ","
  )

# pivotar a base de wide para long

imdb_filmes_dolares_genero <- imdb_filmes_dolares_genero |> 
  pivot_longer(
    cols = c("genero1", "genero2", "genero3"),
    names_to = "tipos_generos",
    values_to = "generos",
    values_drop_na = TRUE
  ) |> 
  mutate(generos = str_trim(generos))

# maiores lucros por gênero

lucros_genero <- imdb_filmes_dolares_genero |>
  group_by(generos) |>
  summarise(lucro_total = sum(lucro)) |> 
  arrange(desc(lucro_total)) |> 
  slice_head(n=10) |> 
  mutate(lucro_total = paste("US$",format_dolar(lucro_total)))

lucros_genero |> 
  kbl(
    align = "l",                                            # alinhamento do texto do cabeçalho.
    col.names = c("Gêneros",                                           # define o nome das colunas.
                  "Lucro Total")
    ) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    html_font = "",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                            # altera as configurações da tabela.
              bold = FALSE,
              width = "15cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "15cm"
              ) |> 
  footnote(general = "Maiores lucros por gênero. Fonte: Base de dados IMDB.",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 07:",
           )

```

<br>

::: {align="justify" style="text-indent: 3em;"}
Entretanto, considerando a quantidade de filmes produzidos por gênero e calculando o lucro por filme, animação, aventura e sci-fi os que apresentam maiores ganhos.

:::
<br>

```{r tab08 - lucro por genero por filme produzido}

lucros_genero_filme <- imdb_filmes_dolares_genero |>
  group_by(generos) |>
  summarise(lucro_total = sum(lucro)/n()) |> 
  arrange(desc(lucro_total)) |> 
  slice_head(n=10) |> 
  mutate(lucro_total = paste("US$",format_dolar(lucro_total)))

lucros_genero_filme |> 
  kbl(
    align = "l",                                            # alinhamento do texto do cabeçalho.
    col.names = c("Gêneros",                                           # define o nome das colunas.
                  "Lucro Total por Filme")
    ) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    html_font = "",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                            # altera as configurações da tabela.
              bold = FALSE,
              width = "15cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "15cm"
              ) |> 
  footnote(general = "Lucros por gênero e quantidades de filmes. Base de dados IMDB.",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 08:",
           )


```

<br>

### 6. Maiores notas médias por gênero

<br>

::: {align="justify" style="text-indent: 3em;"}

Para a construção da visualização abaixo, consideramos todas as categorias. O resultado apresentou a classe *film Noir* com as melhores médias. 

Até hoje, não existe consenso sobre *film Noir* ser uma categoria de filmes ou um estilo de filmagem. Esta categoria refere-se a filmes de longa metragem típicas dos anos 40, combinando temas policiais, criminais e marcados pela presença de anti-herois e ambientes urbanos.

Atualmente, acredita-se que existam cerca de 300 títulos produzidos entre 1940 e 1958. 

:::

```{r plot05 - notas médias por gêneros}
#| echo = TRUE,
#| fig.height = 4,
#| fig.width = 9,
#| fig.cap = "Gráfico 05 - Notas médias por gêneros.  Fonte: Base de dados IMDB.",
#| highlight = TRUE

## Fazer o join de imdb e imdb_avaliacoes

imdb_join_aval <- left_join(imdb_filmes_dolares_genero, imdb_avaliacoes, by = "id_filme")

## fazer a separação das variáveis da coluna genero

imdb_join_aval_generos <- imdb_join_aval |> 
  separate(col = generos,
           into = c("genero_aval1", "genero_aval2", "genero_aval3"),
           sep = ","
           )


# fazer o pivotamento da base para long

imdb_join_aval_generos <- imdb_join_aval_generos |> 
  pivot_longer(
    cols = c("genero_aval1", "genero_aval2", "genero_aval3"),
    names_to = "tipos_generos_aval",
    values_to = "generos_aval",
    values_drop_na = TRUE
  ) |> 
  mutate(generos_aval = str_trim(generos_aval))


# Fazer o join de imdb_join_aval_generos e imdb_avaliacoes

imdb_medias_genero <- left_join(
  imdb_join_aval_generos,
  imdb_avaliacoes
) 


# Descobrir as maiores notas médias por gêneros
# considerando o número de avaliações superiores a 10000

plot05_media_genero <- imdb_medias_genero |> 
  group_by(generos_aval) |> 
  summarise(nota_media = mean(nota_imdb)) |> 
  arrange(desc(nota_media)) |> 
  ggplot()+
  aes(x = fct_reorder(generos_aval,nota_media, .desc = TRUE), y = nota_media, fill = generos_aval) +
  geom_point(
    size = 5
  )+
  geom_segment(aes(x = generos_aval,
                   xend = generos_aval,
                   y = 5,
                   yend =  nota_media),
               linetype = 1,
               size = 0.1
  )+
  labs(
    title = "Gêneros e suas médias",
    x = "Gêneros",
    y = "Médias"
  )+
  scale_y_continuous(breaks = seq(0, 8.5, 0.5),
                     limits = c(5, 8.5),
                     expand = expansion(add = c(0,0))) +
  theme(
      axis.text.x = element_text(angle = 45, hjust = -0.2, size = 7),
      axis.text.y = element_text(size = 7),
      axis.line.x = element_line(color = "#1F1F1F"), 
      axis.line.y = element_line(color = "#1F1F1F"), 
      axis.title.x = element_text(size = 11, face = "plain"),
      axis.title.y = element_text(size = 11, face = "plain"),
      plot.background = element_rect(fill = "#FFFFFF"),
      panel.background = element_rect(fill = "#FFFFFF"),
      plot.margin = unit(c(1, 1, 1, 1), "cm"),                                        # distância das margens.
      plot.title = element_markdown(                                          # título do gráfico em markdown.
        size = 16,
        family = "",                                                                   # fonte do título.
        margin = unit(c(0, 0, 0.5, 0), "cm")                                              # margens do título.
      ), 
      text = element_text(                                                                # textos do gráfico.
        family = "",    
        color = "#000000",
        size = 9
      ),                                                                        # padrões dos ticks do eixo x.
      axis.title = element_text(                                                  # texto do título do eixo x.
        size = 14,
        hjust = 0.5,
      ),
      legend.position = "none"   
    )


plot05_media_genero |> 
  ggplotly(
    tooltip = c("y", "generos_aval")
  )


```

<br>

### 7. Avatar

<br>

```{r figura 07 - avatar filme}
#| fig.align = "center",
#| out.width = "40%",
#| echo = FALSE

knitr::include_graphics("../data-raw/avatar.jpg")

```


```{r cod avatar - descricao do filme}

imdb_avatar<- imdb_filmes_dolares |> 
  filter(titulo == "Avatar") |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao,
         elenco, orcamento, receita, genero, lucro)
  
```



::: {align="justify" style="text-indent: 3em;"}
O filme "**`r imdb_avatar$titulo`**" pertence aos gêneros `r imdb_avatar$genero`. Sua *premier* ocorreu em `r imdb_avatar$data_lancamento`,  com duração de `r imdb_avatar$duracao` minutos sob a direção de `r imdb_avatar$direcao`. Roteiro de `r imdb_avatar$roteiro`.  
Contou com a participação de `r imdb_avatar$elenco` em seu elenco.  

:::
<br>





```{r analise - avatar}
#| include = FALSE

# considerando apenas o valores em dólares
imdb_filmes_dolares <- imdb_novo |>
  filter(str_detect(orcamento, pattern = "\\$.*"))

# eliminar o símbolo $ nos valores das colunas orçamento e receita
imdb_filmes_dolares <- imdb_filmes_dolares |> 
  mutate(orcamento = str_remove(orcamento, pattern = "\\$ "),
         receita = str_remove(receita, pattern = "\\$ "))

# alterar o tipo das variáveis orcamento e  receita
imdb_filmes_dolares$orcamento <- as.numeric(imdb_filmes_dolares$orcamento)
imdb_filmes_dolares$receita <- as.numeric(imdb_filmes_dolares$receita)

# calcular o lucro dos filmes
imdb_filmes_dolares <- imdb_filmes_dolares |> 
  mutate(
    lucro = receita - orcamento
  ) |>
  drop_na(lucro)

# juntar as bases para as demais análises
imdb_base_completa <- left_join(imdb_filmes_dolares, imdb_avaliacoes, by = "id_filme")

# Renomear a variável direcao para nome para fajzer o join com imdb_pessoas
imdb_base_completa <- imdb_base_completa |> 
    rename("nome" = "direcao")

# join entre imdb_base_completa e imdb_pessoas
imdb_completa_pessoas <- left_join(imdb_base_completa, 
                                   imdb_pessoas,
                                   by = "nome"
)

# Retornar a designação da variável nome para direcao
imdb_completa_pessoas <- imdb_completa_pessoas |> 
  rename("direcao" = "nome")
```


#### 7.1 - Direção

<br>

```{r tab09 - dados avatar diretor}

imdb_completa_pessoas |> 
  filter(titulo == "Avatar") |> 
  select(titulo, direcao, local_nascimento, data_nascimento) |> 
  mutate(idade = year(Sys.Date())-year(data_nascimento)) |> 
  kbl(
    align = "l",                                               # alinhamento do texto do cabeçalho à esquerda.
    col.names = c("Filme",                                             # define o nome dos cabeçalhos da tabela.
                  "Diretor",
                  "Local de Nascimento",
                  "Data de Nascimento",
                  "Idade"
                  ),
    full_width = TRUE
  ) |> 
  kable_styling(                                                          # altera as configurações da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "",
    font_size = 10,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
  ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                        # altera as configurações das colunas.
              bold = FALSE,
              width = "6cm"
  ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "6cm"
  ) |> 
  column_spec(3, 
              bold = FALSE,
              width = "6cm"
  ) |> 
  column_spec(4, 
              bold = FALSE,
              width = "6cm"
  ) |> 
  column_spec(5, 
              bold = FALSE,
              width = "6cm"
  ) |> 
  footnote(general = "James Cameron. Base de dados IMDB.",                           # cria rodapé.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 09:",
  )
  


```

<br>

::: {align="justify" style="text-indent: 3em;"}

James Francis Cameron, nascido em Kapuskasing, Ontário, Canadá no dia 16 de agosto de 1954, atualmente com 68 anos é um produtor, cineasta, diretor e roteirista.

:::

<br>

#### 7.2 - Filmes de James Cameron na Base

<br>

::: {align="justify" style="text-indent: 3em;"}

Além dos 7 filmes listados na base Imdb relacionados na tabela 10, também atuou como diretor/roteirista nos filmes Piranha II: The spawning, Terminator, Rambo: First Blood Part II, The Abyss, Strange Days, Ghosts of the Abyss e Alita: Battle Angel.
:::

```{r tab10 - Filmes de Cameron}

filmes_cameron <- imdb_completa_pessoas |> 
  filter(direcao == "James Cameron") |> 
  select(titulo, data_lancamento, genero, nota_imdb, lucro) |> 
  arrange(data_lancamento) |> 
  mutate(lucro = paste("US$",format_dolar(lucro)))



tab_filmes_cameron <- filmes_cameron|>
  kbl(
    align = "l",                                               # alinhamento do texto do cabeçalho à esquerda.
    col.names = c("Título",                                             # define o nome dos cabeçalhos da tabela.
                  "Data de Lançamento",
                  "Gênero",
                  "Nota IMDB",
                  "lucro"
    ),
    full_width = TRUE
  ) |> 
  kable_styling(                                                          # altera as configurações da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "",
    font_size = 10,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
  ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                        # altera as configurações das colunas.
              bold = FALSE,
              width = "5cm"
  ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "4.5cm"
  ) |> 
  column_spec(3, 
              bold = FALSE,
              width = "5cm"
  ) |> 
  column_spec(4, 
              bold = FALSE,
              width = "5cm"
  ) |> 
  column_spec(5, 
              bold = FALSE,
              width = "5cm"
  ) |>
  footnote(general = "Filmes de Cameron na base. Fonte: Base de dados IMDB.",                           # cria rodapé.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 10:",
  )

tab_filmes_cameron
```


<br>

#### 7.3- Lucro médios dos filmes James Cameron na base

```{r code lucro medio filmes de Cameron, include=FALSE}
#| include = FALSE


lucro_medio_filmes <- imdb_completa_pessoas |> 
  filter(direcao == "James Cameron") |> 
  summarise(lucro_medio = round(mean(lucro),2)) |> 
  mutate(lucro_medio = paste("US$",format_dolar(lucro_medio)))

```



::: {align="justify" style="text-indent: 3em;"}

O lucro médio dos `r nrow(filmes_cameron)` filmes listados na base Imdb foi de `r lucro_medio_filmes`. Avatar com um ganho de `r filmes_cameron$lucro[7]` e Titanic com um ganho de `r filmes_cameron$lucro[6]` foram os com maiores lucros.


:::

<br>

```{r tab11 - posicao avatar no ranking imdb}

imdb_novo <- imdb_novo |> 
  mutate(ranking = 0)

imdb_novo_ordenado <- imdb_novo |> 
  arrange(desc(nota_imdb)) |> 
  mutate(ranking = c(1: length(imdb_novo$ranking)))


tab10_posicao_imdb <- imdb_novo_ordenado |> 
  filter(titulo == "Avatar") |> 
  mutate(total_filmes = nrow(ranking)) |> 
  select(titulo, direcao, nota_imdb, ranking) |> 
  kbl(
    align = "l",                                               # alinhamento do texto do cabeçalho à esquerda.
    col.names = c("Título",                                          # define o nome dos cabeçalhos da tabela.
                  "Direção",
                  "Nota IMDB",
                  "Ranking IMDB"
    ),
    full_width = TRUE
  ) |> 
  kable_styling(                                                          # altera as configurações da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "",
    font_size = 10,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
  ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                        # altera as configurações das colunas.
              bold = FALSE,
              width = "5cm"
  ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "5cm"
  ) |> 
  column_spec(3, 
              bold = FALSE,
              width = "5cm"
  ) |> 
  column_spec(4, 
              bold = FALSE,
              width = "5cm"
  ) |>
  footnote(general = "Avatar - ranking e nota. fonte: Base de dados IMDB.",                           # cria rodapé.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 11:",
  )


tab10_posicao_imdb
```

<br>


#### 7.4 - Posição de Avatar no ranking do maiores lucros

<br>

::: {align="justify" style="text-indent: 3em;"}

Entre todos os `r nrow(imdb_novo)` filmes, Avatar ocupa a primeira posição no *ranking*  de lucros. 
:::

<br>
 
```{r tab12 - posicao de avatar no ranking lucros}

imdb_filmes_dolares <- imdb_filmes_dolares |> 
  mutate(ranking = 0)

# Vamos construir a coluna com o ranking dos filmes de acordo com sua renda em dólares
imdb_filmes_dolares_ordenado <- imdb_filmes_dolares |> 
  arrange(desc(lucro)) |> 
  mutate(ranking_dolar = c(1: length(imdb_filmes_dolares$ranking))) |> 
  select(titulo, direcao, lucro, ranking_dolar) 


tab11_posicao_dolar <- imdb_filmes_dolares_ordenado |> 
  filter(titulo == "Avatar") |> 
  mutate(lucro = paste("US$",format_dolar(lucro))) |> 
  kbl(
    align = "l",                                               # alinhamento do texto do cabeçalho à esquerda.
    col.names = c("Título",                                          # define o nome dos cabeçalhos da tabela.
                  "Direção",
                  "Lucro",
                  "Ranking dólar"
    ),
    full_width = TRUE
  ) |> 
  kable_styling(                                                          # altera as configurações da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "",
    font_size = 10,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
  ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                        # altera as configurações das colunas.
              bold = FALSE,
              width = "5cm"
  ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "5cm"
  ) |> 
  column_spec(3, 
              bold = FALSE,
              width = "5cm"
  ) |> 
  column_spec(4, 
              bold = FALSE,
              width = "5cm"
  ) |>
  footnote(general = "Avatar - ranking de lucro. Fonte: Base de dados IMDB.",                           # cria rodapé.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 12:",
  )


tab11_posicao_dolar


```

#### 7.5 - Data de lançamento

```{r tab13 - dados do dia semana do lancamento avatar}

tab12_dia_semana <- imdb_novo_ordenado |> 
  filter(titulo == "Avatar") |> 
  mutate(data_lancamento_dia = wday(data_lancamento, week_start = getOption("lubridate.week.start", 7),
                                    abbr = FALSE, label = TRUE)) |>
  select(titulo, data_lancamento, data_lancamento_dia) |> 
  kbl(
    align = "l",                                               # alinhamento do texto do cabeçalho à esquerda.
    col.names = c("Título",                                          # define o nome dos cabeçalhos da tabela.
                  "Data de lançamento",
                  "Dia da semana"
    ),
    full_width = TRUE
  ) |> 
  kable_styling(                                                          # altera as configurações da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "",
    font_size = 10,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
  ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                        # altera as configurações das colunas.
              bold = FALSE,
              width = "7.5cm"
  ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "7.5cm"
  ) |> 
  column_spec(3, 
              bold = FALSE,
              width = "5cm"
  ) |>
  footnote(general = "Dia de lançamento. Fonte: Base de dados IMDB.",                           # cria rodapé.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 13:",
  )


tab12_dia_semana

```

<br>

::: {align="justify" style="text-indent: 3em;"}
A estreia nas salas de cinemas dos Estados Unidos ocorreu em `r imdb_novo_ordenado |> filter(titulo == "Avatar") |> select(data_lancamento)`, em uma sexta-feira. Neste dia, tinha exatos `r as.duration(year("2010-01-15") - year("1982-06-07"))` anos de idade. 

:::

```{r tab14 - dados dia lancamento Avatar - outros filmes}

tab13_outros_filmes <- imdb_novo_ordenado |> 
  filter(data_lancamento == "2010-01-15") |> 
  select(titulo, data_lancamento, genero, nota_imdb,pais) |>
  kbl(
    align = "l",                                               # alinhamento do texto do cabeçalho à esquerda.
    col.names = c("Título",                                          # define o nome dos cabeçalhos da tabela.
                  "Data de Lançamento",
                  "Gênero",
                  "Nota IMDB",
                  "País"
    ),
    full_width = TRUE
  ) |> 
  kable_styling(                                                          # altera as configurações da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "",
    font_size = 10,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
  ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                        # altera as configurações das colunas.
              bold = FALSE,
              width = "5cm"
  ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "5cm"
  ) |> 
  column_spec(3, 
              bold = FALSE,
              width = "5cm"
  ) |> 
  column_spec(4, 
              bold = FALSE,
              width = "5cm"
  ) |>
  column_spec(5, 
              bold = FALSE,
              width = "5cm"
  ) |>
  footnote(general = "Filmes lançados no mesmo dia. Fonte:Base de dados IMDB.",                           # cria rodapé.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 14:",
  )


tab13_outros_filmes
```

<br>

#### 7.6 - Distribuição de notas de Avatar por intervalo de classes de idade

<br>

```{r plot06 - notas médias imdb por faixa etária}
#| echo = TRUE,
#| fig.cap = "Gráfico 06 - Notas por faixa etária. Fonte: Base de dados Imdb",

# Gráfico distribuição da nota do filme avatar por idade

imdb_avaliacoes <- imdb_avaliacoes |> 
  rename("[00-18)" = "nota_media_idade_0_18",
         "[18-30)" = "nota_media_idade_18_30",
         "[30-45)" = "nota_media_idade_30_45",
         "[45-60)" = "nota_media_idade_45_mais")




imdb_join_avatar_idades <- left_join(imdb_novo, imdb_avaliacoes, by = "id_filme") |> 
  filter(titulo == "Avatar") |>
  pivot_longer("faixas_etarias", values_to = "nota_media_idade", cols =c("[00-18)",
                                                                         "[18-30)",
                                                                         "[30-45)",
                                                                         "[45-60)"
  )
  
  ) |> 
  group_by(faixas_etarias) |> 
  summarise(nota_media_idade)


cor <- c(                                                       # paleta  de cores para os elementos gráficos.
  "#c42847", "#ffad05", "#7d5ba6", "#00bbf9"
)


plot06_medias_idade <- imdb_join_avatar_idades |> 
  ggplot(aes(x=faixas_etarias, y = nota_media_idade, label = nota_media_idade))+
  geom_col(width = 0.5,
           fill = cor)+
  geom_label(nudge_y = 0.5)+
  labs(title = "Distribuição das Notas por Idade",
       subtitle = "Notas médias por intervalo de classes do filme Avatar",
       x = "Idade",
       y = "Nota Média")+
  theme_classic()+
  theme_imdb() +
  scale_y_continuous(expand =expansion(add = c(0, 0.5)),
                     labels = scales::number_format(accuracy = 0.1,
                                                    decimal.mark = ","))

plot06_medias_idade

```

<br>


# Conclusão

#  



# Anexos

## Dicionários

### Dicionário da base IMDB

<br>

<style type="text/css">
.tg  {border-collapse:collapse;border-color:#ccc;border-spacing:0;}
.tg td{background-color:#fff;border-bottom-width:1px;border-color:#ccc;border-style:solid;border-top-width:1px;
  border-width:0px;color:#333;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:4px 10px;
  word-break:normal;}
.tg th{background-color:#f0f0f0;border-bottom-width:1px;border-color:#ccc;border-style:solid;border-top-width:1px;
  border-width:0px;color:#333;font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;
  padding:4px 10px;word-break:normal;}
.tg .tg-5bbp{background-color:#edf6fd;border-color:inherit;font-size:11px;text-align:left;vertical-align:middle}
.tg .tg-i82w{background-color:#f9f9f9;border-color:inherit;font-size:11px;text-align:left;vertical-align:middle}
.tg .tg-ncrr{border-color:inherit;font-size:11px;text-align:left;vertical-align:middle}
@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;}}</style>
<div class="tg-wrap"><table class="tg" style="undefined;table-layout: fixed; width: 834px">
<colgroup>
<col style="width: 211.005682px">
<col style="width: 102.005682px">
<col style="width: 521.005682px">
</colgroup>
<thead>
  <tr>
    <th class="tg-5bbp">Variável</th>
    <th class="tg-5bbp">Tipo</th>
    <th class="tg-5bbp">Descrição</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-i82w">id_filme</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">identificador alfanumérico exclusivo do título</td>
  </tr>
  <tr>
    <td class="tg-ncrr">titulo</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">nome da obra em materiais promocionais na data do lançamento</td>
  </tr>
  <tr>
    <td class="tg-i82w">titulo_original</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">nome original da obra, no idioma original</td>
  </tr>
  <tr>
    <td class="tg-ncrr">ano</td>
    <td class="tg-ncrr">dbl</td>
    <td class="tg-ncrr">ano da produção</td>
  </tr>
  <tr>
    <td class="tg-i82w">data_lancamento</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">data do lançamento do filme ou a data de início da série</td>
  </tr>
  <tr>
    <td class="tg-ncrr">genero</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">inclui até três gêneros associados ao título</td>
  </tr>
  <tr>
    <td class="tg-i82w">duracao</td>
    <td class="tg-i82w">dbl</td>
    <td class="tg-i82w">tempo de execução em minutos</td>
  </tr>
  <tr>
    <td class="tg-ncrr">pais</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">país</td>
  </tr>
  <tr>
    <td class="tg-i82w">idioma</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">idioma</td>
  </tr>
  <tr>
    <td class="tg-ncrr">orcamento</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">orçamento</td>
  </tr>
  <tr>
    <td class="tg-i82w">receita</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">receita</td>
  </tr>
  <tr>
    <td class="tg-ncrr">receita_eua</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">receita nos EUa</td>
  </tr>
  <tr>
    <td class="tg-i82w">nota_imdb</td>
    <td class="tg-i82w">dbl</td>
    <td class="tg-i82w">nota média obtida pela obra nas avaliações dos usuários</td>
  </tr>
  <tr>
    <td class="tg-ncrr">num_avaliacoes</td>
    <td class="tg-ncrr">dbl</td>
    <td class="tg-ncrr">total de avaliações realizadas para cada título</td>
  </tr>
  <tr>
    <td class="tg-i82w">direcao</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">diretor(es)</td>
  </tr>
  <tr>
    <td class="tg-ncrr">roteiro</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">roteirista(s)</td>
  </tr>
  <tr>
    <td class="tg-i82w">producao</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">empresa produtora</td>
  </tr>
  <tr>
    <td class="tg-ncrr">elenco</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">nomes dos integrantes do elenco</td>
  </tr>
  <tr>
    <td class="tg-i82w">descricao</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">sinopse da obra</td>
  </tr>
  <tr>
    <td class="tg-ncrr">num_criticas_publico</td>
    <td class="tg-ncrr">dbl</td>
    <td class="tg-ncrr">total de críticas recebidas do público</td>
  </tr>
  <tr>
    <td class="tg-i82w">num_criticas_critica</td>
    <td class="tg-i82w">dbl</td>
    <td class="tg-i82w">total de críticas recebidas dos críticos</td>
  </tr>
</tbody>
</table></div>

<br>
