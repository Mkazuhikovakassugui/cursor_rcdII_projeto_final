---
title: "I see you!"
author: "Marcio Vakassugui"
date: '2022-05-10'
output:
  html_document:
    code_folding: hide
    includes:
      in_header: cabecalho.html
    theme: paper
    highlight: zenburn
    toc: yes
    toc_float: yes
    smooth_scroll: no
    collapsed: yes
  pdf_document:
    toc: yes
subtitle: Base de Dados IMDB
---

```{r setup }
#| include=FALSE

knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  align = "center",
  fig.height = 7,
  fig.width = 14
)
```
<br><br>

# Introdução

<br>

::: {align="justify" style="text-indent: 3em;"}
O presente trabalho foi elaborado tendo como propósito analisar os dados de uma das maiores bases pesquisáveis sobre filmes, séries e celebridades do mundo e transformar estes dados em informações. Trata-se da base Imdb (*Internet Move Database*), criada em 1990 por Col Needham, no Reino Unido, e comprada pela *Amazon* em 1998.

Aos apaixonados pela sétima arte, que não abrem mão do prazer em assistir a um filme, no aconchego de casa ou em uma sessão de cinema, trarei algumas curiosidades da indústria cinematográfica, em especial, de um filme que impressionou o público em 2010 com a qualidade dos efeitos visuais, e que deve retornar às telas dos cinemas para a continuação da saga com o episódio "*The Way of Water*" (capítulo 2) de **Avatar**, um dos maiores sucessos de bilheteria da história, dirigido por James Cameron.

De acordo com o site "*Avatar wiki*", **I see you** é uma saudação. Na língua Na'vi é expresso por **Oel ngati kame** para uma saudação neutra ou **Oel ngati kameie** para expressar um sentimento positivo sobre conhecer alguém. Também é o tema principal do filme, interpretado por Leona Lewis e produzido por James Horner e Simon Franglen.

:::

```{r figura 01 -  avatar 2}
#| fig.align = "center",
#| out.width = "40%",
#| echo = FALSE

knitr::include_graphics("https://i.imgur.com/gvwmCrU.jpeg")

```

::: {align="justify" style="text-indent: 3em;"}
Caso desejem ver os códigos que geraram as visualizações deste trabalho, eles estarão disponíveis ao lado das tabelas e gráficos por meio dos botões `CODE`.

:::

```{r carregar os pacotes}
#| echo = FALSE

library(readr)                                                                                      # leitura.
library(tidyverse)                                                                              # manipulação.
library(lubridate)                                                                     # manipulação de datas.
library(forcats)                                                                    # maninpulação de factors.
library(kableExtra)                                                                                 # tabelas.
library(plotly)                                                                      # extensão para gráficos.
library(gghighlight)                                                                 # extensão para gráficos.
library(ggtext)                                                                      # extensão para gráficos.
library(ggthemes)                                                                     # temas para relatórios.
library(here)                                                                           # endereços relativos.
library(scales)                                              # com métodos para formatação de labels de plots.
source("../R/funcoes_imdb.R")                                                   # leitura das funções criadas.
```

```{r  Leitura das bases}
#| echo = FALSE

remotes::install_github("curso-r/basesCursoR")
imdb <- basesCursoR::pegar_base("imdb_completa")
imdb_pessoas <- basesCursoR::pegar_base("imdb_pessoas")
imdb_avaliacoes <- basesCursoR::pegar_base("imdb_avaliacoes")
caminho_com_here_tab_moedas <- here("data-raw", "siglas_moedas_paises.xlsx")

```

```{r code  - alterar tipo da variavel data com lubridade}
#| echo = FALSE
# alterar o tipo da variável data_lancamento de "char" para "date" 

imdb_novo <- imdb |>    
  mutate(
    data_lancamento = ymd(data_lancamento),                                             # conversão para date.
  )

```

<br>

# Análises

<br>

::: {align="justify" style="text-indent: 3em;"}
As informações foram obtidas a partir das bases "***Imdb***", que contém os dados gerais dos filmes e séries, "***Imdb_pessoas***", com os dados sobre os elencos, diretores e roteiristas e "***Imdb_avaliacoes***", com as notas médias e os dados de classificações.

A base "*Imdb*" possui `r nrow(imdb)` linhas com `r ncol(imdb)` variáveis de filmes produzidos entre 1894 e 2020. A "*imdb_pessoas*" por sua vez conta com  `r nrow(imdb_pessoas)` linhas e `r ncol(imdb_pessoas)` colunas e a "*imdb_avaliacoes*" com um total de `r nrow(imdb_avaliacoes)` linhas e `r ncol(imdb_avaliacoes)` colunas.

Na seção de anexos, ao final deste relatório, disponibilizo os dicionários das bases com as listas de variáveis e definições. 

As operações de importação, arrumação, transformação e visualização dos dados foram realizadas por meio da linguagem R, seus pacotes e extensões.

:::

<br>

### 1. Evolução da produção da indústria cinematográfica

<br>

::: {align="justify" style="text-indent: 3em;"}
Em 28 de setembro de 1895, os irmãos Lumière realizaram a primeira exibição pública do cinematógrafo, uma invenção que imprimia uma sucessão de fotos em um filme de celulose e que por meio de uma manivela reproduzia as imagens em sequência, transformando as figuras estáticas em imagens dinâmicas projetadas sobre uma tela. Desde então, milhares de filmes foram produzidos, alcançando o auge em 2018.

Pode-se observar no gráfico 01 que a quantidade de filmes produzidos evoluiu de 1 obra em 1894 para 271 obras em 1946, pós Segunda Guerra Mundial, e então para 3281 lançamentos em 2018. Entretanto, com o isolamento do público devido à pandemia de COVID 19, a indústria cinematográfica adiou os lançamentos de seus filmes, provocando a redução do número de produções nos anos seguintes.

:::


<br><br>

```{r plot01 - Evolucao da industria cinematografica}
#| echo = TRUE,
#| fig.height = 4,
#| fig.width = 9,
#| fig.cap = "Gráfico 01 - Evolução da Industria Cinematográfica. Fonte: Base de dados Imdb",
#| highlight = TRUE

# Gráfico "Evolução da Indústria Cinematográfica"

p01 <- imdb_novo |> 
  mutate(ano_lancamento = year(data_lancamento)) |>                     # cria a coluna com ano de lançamento.
  select(ano_lancamento) |> 
  drop_na() |>
  group_by(ano_lancamento) |> 
  summarise(qte = n()) |>                                                 
  slice_head(n=112) |>                    # exclui os dados de 2021, pois possui dados de apenas alguns meses.
  ggplot()+
  aes(x = ano_lancamento, 
      y = qte)+
  annotate("rect",                  # cria um destaque em azul para os anos de maior produção cinematográfica.
           xmin = 2010,
           xmax = 2026,
           ymin = 2950, 
           ymax = 3500,
           fill = "#99D8FF", 
           alpha = 0.3
           ) +
  annotate("text",                                     # cria anotação de texto para a área destacada em azul.
           x = 1990, 
           y = 3281,
           label = "Auge da produção cinematográfica", 
           size = 3
           ) +
  geom_line(color = "#4C586B")+            # gráfico lollypop formado pela combinação dos geom's line e point.
  geom_point(color = "#A71D31",                                                           
             shape = 7,
             size = 0.7
             )+
  gghighlight(ano_lancamento >=1946,                  # destaca no gráfico os dados dos anos a partir de 1960.
              unhighlighted_params = list(colour = "#4C586B")
              )+
  labs(title = "Total de filmes por ano",                           
       x = "
    Ano",
       y = "Quantidade 
    
    "            
  )+
  scale_x_continuous(breaks = seq(0,                                    
                                  2022, 
                                  10
                                  )
                     ) +
  scale_y_continuous(breaks = seq(0,                                  
                                  4000, 
                                  500
                                  ),
                     labels = number_format(accuracy = 0.1,
                                            big.mark = ".",
                                            decimal.mark = ",",
                                            )
                     ) +
  theme_classic()   

# Gráfico - evolução da indústria cinematográfica
  
p01 |> 
  ggplotly()   

```

<br><br>

### 2. A maior quantidade de filmes produzidos em um mês individualizados por ano

<br>

::: {align="justify" style="text-indent: 3em;"}
O ano de 2018 teve o maior número de estreias da história e em outubro deste ano (2018) o maior número de estreias em um mês com 386 obras cinematográficas, superando o número de lançamentos registrados até então de setembro de 2017.

:::

```{r tab01 - maior quantidade filmes em um mes}

#Tabela 01: Maior quantidade de filmes em um mês

# criar a coluna mes

imdb_datas <- imdb_novo |>
  mutate(mes = month(data_lancamento,  
                     label = TRUE, 
                     abbr = TRUE
                     )
         )

# encontrar o mês histórico com o maior número de lançamentos.

mes_maior_lancamento <- imdb_datas |>   
  group_by(mes,
           ano
           ) |>  
  summarise(qte = n()) |>             
  drop_na() |> 
  slice_max(qte) |> 
  arrange(desc(qte))

# define condicção para formatar o valor de qte para a tabela 01

mes_maior_lancamento_tab01 <- mes_maior_lancamento

mes_maior_lancamento_tab01[[3]] <-  cell_spec(mes_maior_lancamento_tab01[[3]],    # destacar a qte  na tabela.
                                              color = ifelse(mes_maior_lancamento_tab01[[3]] >= 380,
                                                             "#B80C09",
                                                             "#3F88C5"
                                                             )
                                              )

### selecionar apena a primeira linha

mes_maior_lancamento_tab01 <- mes_maior_lancamento_tab01 |>   
  head(n=1)

### Tabela 01 - maior quantidade de filmes em um mês

tab01 <-  mes_maior_lancamento_tab01 |> 
  kbl(align = "l", 
      col.names = c("Mês",  
                    "Ano de Lançamento", 
                    "Quantidade de Filmes"
                    ),
      full_width = TRUE,
      escape = FALSE
      ) |> 
  kable_styling(bootstrap_options = c("striped",                                  # formatar estilo da tabela.
                                      "condensed"
                                      ),
                font_size = 12,
                full_width = TRUE, 
                fixed_thead = list(enabled = TRUE, 
                                   background = "#EDF6FD"
                                   ) 
                ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                                  # configurações das colunas.
              width = "10cm"
              ) |>      
  column_spec(2, 
              width = "10cm"
              ) |>
  column_spec(3,
              width = "10cm"
              ) |> 
  footnote(general = "Maior quantidade de filmes em um mês por ano. Fonte: Base de dados IMDB.",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 01:"
           )

# visualiza a tabela 01

tab01     

```

<br>

::: {align="justify" style="text-indent: 3em;"}
No gráfico 02, tem-se os 13 meses com os maiores números de filmes, todos entre os anos de 2014 e 2018, período de maior produção cinematográfica (vide gráfico 01).

:::


```{r plot02 - total de lançamentos x mês}
#| fig.height = 8,
#| fig.width = 14,
#| fig.cap = "Gráfico 02 - Meses com os maiores números de lançamentos por ano. Fonte: Base de dados Imdb",

# Gráfico 02 - meses com maiores totais de lançamentos

# encontrar os 13 meses com maiores totais de lançamentos

meses_mais_qte <- mes_maior_lancamento |> 
  group_by(qte, ano) |>
  summarise(mes) |> 
  arrange(desc(qte)) |> 
  unite(col = "mes_ano",
        c("mes",
          "ano"
          ),
        sep = "/"
        ) |>       
  arrange(desc(qte)) |> 
  head(13) 

# paleta de cores que será usada nos gráficos 

cores_plot02 <- c("#CC5A71", "#536265", "#536265", "#536265", "#536265","#536265",
                  "#536265", "#536265", "#536265", "#536265", "#536265","#536265",
                  "#536265")

# gráfico meses com maiores totais de lançamentos.

plot02 <- meses_mais_qte|> 
  ggplot(aes(x = fct_reorder(mes_ano, 
                             qte,
                             .desc = TRUE    
                             ), 
             y = qte, 
             fill = mes_ano,
             label = qte
             )
         )+                                        # gráfico lollypop - a partir de geom_point e geom_segment.
  geom_point(size = 5,                                                             # cria o elemento circular.
             color = cores_plot02
             )+
  geom_label(size = 5, 
             alpha = 0, 
             label.size = NA, 
             color = cores_plot02,   
             vjust = -1
             ) +
  geom_segment(aes(x = mes_ano,                                                    # cria o elemento segmento.
                   xend = mes_ano,
                   y = 0,
                   yend = qte
                   ),
               color = cores_plot02,
               size = 1.5,  
               )+
  labs(title = "Total de lançamentos por *<span style = 'color:#CC5A71;'>mês </span>*",
       subtitle ="Os meses com maior quantidade de estreias",        
       y = "Quantidade de filmes
    ",
       x = "
    Meses do ano"
  ) +
  theme_classic()+                                                               # seleção do tema do gráfico.
  scale_y_continuous(breaks = seq(0,
                                  500,
                                  50
                                  ),
                     limits = c(0, 
                                500
                                ),
                     expand = expansion(add = c(0,
                                                0)
                                        )
                     )+                                   
  theme_imdb()

# Visualiza o gráfico meses com maiores totais de lançamentos

plot02     

```

<br><br>

::: {align="justify" style="text-indent: 3em;"}
Na tabela 02, listo os 5 filmes deste mês de outubro com as maiores notas médias, considerando apenas os filmes com mais de 100000 avaliações.

:::

<br>

```{r tab02 - 5 filmes de outubro de 2018 com maior ranking }


# Tabela 02: Top 5 filmes

# obtenção da relação dos 5 filmes  de outubro de 2018 por ranking 

mes_maior_lancamento <- imdb_datas |>                                
  group_by(mes) |>        
  summarise(qte = n(),
            titulo,
            data_lancamento, 
            nota_imdb, 
            num_avaliacoes,
            pais,
            ano = year(data_lancamento)) |>
  filter(mes == "out" & ano == 2018 & num_avaliacoes >= 100000) |> # filtros 2018 e mais de 100000 avaliacões.
  arrange(desc(nota_imdb)) |> 
  slice_head(n=5)

mes_maior_lancamento$mes <- NULL                                                        # Exclusão de colunas. 
mes_maior_lancamento$qte <- NULL

# Tabela com os 5 filmes  de outubro de 2018com melhores rankings

tab02 <- mes_maior_lancamento |> 
  select(titulo, data_lancamento, nota_imdb, num_avaliacoes, pais) |> 
kbl(
  align = "l",                                                            # alinhamento do texto do cabeçalho.
  col.names = c("título",                                                       # define o nome das variáveis.
                "lançamento", 
                "nota",
                "avaliações",
                "país"),
  ) |> 
  kable_styling(                                                          # altera as configurações da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "",
    font_size = 12,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD"),
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                        # altera as configurações das colunas.
              bold = FALSE,
              width = "10cm",
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "4cm"
              ) |>
  column_spec(3,
              bold = FALSE,
              width = "2cm"
              ) |> 
  column_spec(4,
              bold = FALSE,
              width = "4cm"
              ) |> 
  column_spec(5,
              bold = FALSE,
              width = "10cm"
              ) |> 
  footnote(general = "Top 5 filmes Nota Média/ Outubro 2018. Fonte: Base de dados IMDB.",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 02:",
           )

# visualiza a tabela - top 5 filmes

tab02

```

<br>

::: {align="justify" style="text-indent: 3em;"}
Abaixo, apresento um resumo de cada um dos 5 filmes, a partir dos dados da base Imdb, com uma breve sinopse.

:::

<br>

```{r code - imdb com lucros }
#| echo = FALSE

# considerando apenas o valores em dólares

imdb_filmes_dolares <- imdb_novo |>
  filter(str_detect(orcamento, pattern = "\\$.*"))

# eliminar o símbolo $ nos valores das colunas orçamento e receita

imdb_filmes_dolares <- imdb_filmes_dolares |> 
  mutate(orcamento = str_remove(orcamento, pattern = "\\$ "),
         receita = str_remove(receita, pattern = "\\$ "))

# alterar o tipo das variáveis orcamento e  receita

imdb_filmes_dolares[[10]]<- as.numeric(imdb_filmes_dolares[[10]])
imdb_filmes_dolares[[11]] <- as.numeric(imdb_filmes_dolares[[11]])

# calcular o lucro dos filmes

imdb_filmes_dolares <- imdb_filmes_dolares |> 
  mutate(
    lucro = receita - orcamento
  ) |>
  drop_na()

```


####  {.tabset .tabset-fade}

##### A Star is Born

```{r code - filme nasce uma estrela}

imdb_nasce_uma_estrela <- imdb_filmes_dolares |> 
  filter(titulo == "A Star Is Born") |> 
  mutate(thumbnail_nasce_uma_estrela = "../data-raw/nasce_uma_estrela_thumbnail.jpg") |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao,
         elenco, orcamento, receita, genero, lucro, thumbnail_nasce_uma_estrela)
  
```

```{r figura 02 - imagem do filme nasce uma estrela}
#| fig.float= "right",
#| out.width = "30%",
#| echo = FALSE

knitr::include_graphics(imdb_nasce_uma_estrela$thumbnail_nasce_uma_estrela)

```


::: {align="justify" style="text-indent: 3em;"}
O filme "**`r imdb_nasce_uma_estrela$titulo`**" foi  lançado  no Brasil como "**Nasce uma Estrela**". Pertence aos gêneros **`r imdb_nasce_uma_estrela$genero`**. Sua *premiere* ocorreu em `r imdb_nasce_uma_estrela$data_lancamento`,  com duração de `r imdb_nasce_uma_estrela$duracao` minutos sob a direção de `r imdb_nasce_uma_estrela$direcao`. Roteiro de `r imdb_nasce_uma_estrela$roteiro`.  

Contou com a participação de `r imdb_nasce_uma_estrela$elenco` em seu elenco.  

A obra teve um orçamento, de acordo com a base, de US`r imdb_nasce_uma_estrela$orcamento/1000000` milhões e uma receita de US`r round(imdb_nasce_uma_estrela$receita/1000000,2)` milhões, obtendo um **`r ifelse(imdb_nasce_uma_estrela$lucro >0, "lucro", "prejuízo" )`** de US$`r round(imdb_nasce_uma_estrela$lucro/1000000,2)` milhões.  

**Sinopse: Um experiente músico descobre a jovem artista desconhecida a quem ajuda a encontrar fama, mas acaba se apaixonando por ela. O relacionamento pessoal entre os dois começa a desandar à medida que Jack luta contra problemas com alcoolismo.**  
***Fonte: [imdb-Nasce uma estrela](https://www.imdb.com/title/tt1517451/?ref_=fn_al_tt_1)***

:::
<br>

##### Searching

```{r code - filme searching}

imdb_searching <- imdb_filmes_dolares |> 
  filter(titulo == "Searching") |> 
  mutate(thumbnail_searching = "../data-raw/Buscando_thumbnail.jpg") |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao,
         elenco, orcamento, receita, genero, lucro, thumbnail_searching)

```

```{r figura 03 - imagem do filme searching}
#| fig.float= "right",
#| out.width = "30%",
#| echo = FALSE

knitr::include_graphics(imdb_searching$thumbnail_searching)

```

::: {align="justify" style="text-indent: 3em;"}
O filme "**`r imdb_searching$titulo`**" foi  lançado  no Brasil como "**Buscando**". Pertence aos gêneros **`r imdb_searching$genero`**. Sua *premiere* ocorreu em `r imdb_searching$data_lancamento`,  com duração de `r imdb_searching$duracao` minutos sob a direção de `r imdb_searching$direcao`. Roteiro de `r imdb_searching$roteiro`.  

Contou com a participação de `r imdb_searching$elenco` em seu elenco.  

A obra teve um orçamento, de acordo com a base, de US`r imdb_searching$orcamento/1000000` milhões e uma receita de US`r round(imdb_searching$receita/1000000,2)` milhões, obtendo um **`r ifelse(imdb_searching$lucro >0, "lucro", "prejuízo" )`** de US$`r round(imdb_searching$lucro/1000000,2)` milhões.  

**Sinopse: Depois que sua filha de 16 anos desaparece, um pai desesperado entra em seu laptop procurando pistas para encontrá-la.**  
***Fonte: [imdb-buscando](https://www.imdb.com/title/tt7668870/?ref_=fn_al_tt_1)***

:::

##### First Man

```{r code - filme first man}

imdb_firstman <- imdb_filmes_dolares |> 
  filter(titulo == "First Man - Il primo uomo") |> 
  mutate(thumbnail_firstman = "../data-raw/first_man_thumbnail.jpg") |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao,
         elenco, orcamento, receita, genero, lucro, thumbnail_firstman)

```

```{r figura 04 -imagem do filme first man}
#| fig.float= "right",
#| out.width = "15%",
#| echo = FALSE

knitr::include_graphics(imdb_firstman$thumbnail_firstman)

```

::: {align="justify" style="text-indent: 3em;"}
O filme "**`r imdb_firstman$titulo`**" foi  lançado  no Brasil como "**O Primeiro Homem**". Pertence aos gêneros **`r imdb_firstman$genero`**. Sua *premiere* ocorreu em `r imdb_firstman$data_lancamento`,  com duração de `r imdb_firstman$duracao` minutos sob a direção de `r imdb_firstman$direcao`. Roteiro de `r imdb_firstman$roteiro`.  

Contou com a participação de `r imdb_firstman$elenco` em seu elenco.  

A obra teve um orçamento, de acordo com a base, de US`r imdb_firstman$orcamento/1000000` milhões e uma receita de US`r round(imdb_firstman$receita/1000000,2)` milhões, obtendo um **`r ifelse(imdb_firstman$lucro >0, "lucro", "prejuízo" )`** de US$`r round(imdb_firstman$lucro/1000000,2)` milhões.  

**Sinopse: Um olhar sobre a vida do astronauta Neil Armstrong e a lendária missão espacial que o levou a ser o primeiro homem a caminhar na Lua.**   ***Fonte: [imdb-first man](https://www.imdb.com/title/tt1213641/?ref_=fn_al_tt_1)***

:::


##### Soldado

```{r code - filme soldado}

imdb_soldado <- imdb_filmes_dolares |> 
  filter(titulo == "Soldado") |> 
  mutate(thumbnail_soldado = "../data-raw/sicario_thumbnail.jpg") |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao,
         elenco, orcamento, receita, genero, lucro, thumbnail_soldado)

```

```{r figura 05 - imagem do filme soldado}
#| fig.float= "right",
#| out.width = "15%",
#| echo = FALSE

knitr::include_graphics(imdb_soldado$thumbnail_soldado)

```

::: {align="justify" style="text-indent: 3em;"}
O filme "**`r imdb_soldado$titulo`**" foi  lançado  no Brasil como "**Sicario 2 - Soldado**". Pertence aos gêneros **`r imdb_soldado$genero`**. Sua *premiere* ocorreu em `r imdb_soldado$data_lancamento`,  com duração de `r imdb_soldado$duracao` minutos sob a direção de `r imdb_soldado$direcao`. Roteiro de `r imdb_soldado$roteiro`.  

Contou com a participação de `r imdb_soldado$elenco` em seu elenco.  

A obra teve um orçamento, de acordo com a base, de US`r imdb_soldado$orcamento/1000000` milhões e uma receita de US`r round(imdb_soldado$receita/1000000,2)` milhões, obtendo um **`r ifelse(imdb_soldado$lucro >0, "lucro", "prejuízo" )`** de US$`r round(imdb_soldado$lucro/1000000,2)` milhões.  

**Sinopse: A guerra contra as drogas na fronteira do México com os Estados Unidos aumenta quando os cartéis começam a introduzir terroristas no território americano.**  ***Fonte: [imdb-soldado](https://www.imdb.com/title/tt5052474/?ref_=fn_al_tt_3)***

:::

##### 7 sconosciuti a El Royale

```{r code - filme 7 sconosciuti a El Royale}

imdb_royale <- imdb_filmes_dolares |> 
  filter(titulo == "7 sconosciuti a El Royale") |> 
  mutate(thumbnail_royale = "../data-raw/maus_momentos_em_royale_thumbnail.jpg") |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao,
         elenco, orcamento, receita, genero, lucro, thumbnail_royale)

```

```{r figura 06 - imagem do filme 7 sconosciuti a El Royale}
#| fig.float= "right",
#| out.width = "20%",
#| echo = FALSE

knitr::include_graphics(imdb_royale$thumbnail_royale)

```

::: {align="justify" style="text-indent: 3em;"}
O filme "**`r imdb_royale$titulo`**" foi  lançado  no Brasil como "**Maus Momentos no Hotel Royale**". Pertence aos gêneros **`r imdb_royale$genero`**. Sua *premiere* ocorreu em `r imdb_royale$data_lancamento`,  com duração de `r imdb_royale$duracao` minutos sob a direção de `r imdb_royale$direcao`. Roteiro de `r imdb_royale$roteiro`.  

Contou com a participação de `r imdb_royale$elenco` em seu elenco.  

A obra teve um orçamento, de acordo com a base, de US`r imdb_royale$orcamento/1000000` milhões e uma receita de US`r round(imdb_royale$receita/1000000,2)` milhões, obtendo um **`r ifelse(imdb_royale$lucro >0, "lucro", "prejuízo" )`** de US$`r round(imdb_royale$lucro/1000000,2)` milhões.  

**Sinopse: Em 1969 alguns estranhos com segredos se conhecem por casualidade no hotel El Royale no lago Tahoe. Durante uma das noites, cada um mostrará sua verdadeir personalidade.**
***Fonte: [imdb-hotel royale](https://www.imdb.com/title/tt6628394/?ref_=fn_al_tt_1)***

:::

<br>

### 3. O mês com o maior número de filmes no geral

<br>

::: {align="justify" style="text-indent: 3em;"}
Outubro foi o mês, entre todos os meses, com o maior número de estreias, considerando todos os anos. Foram mais de 8000 títulos, valor até então nunca atingido como pode ser visto na tabela 03.

:::

<br>

```{r tab03 - mês histórico com o maior número de lançamentos}

# tabela 03 - Mês com o maior número de lançamentos

# encontrar os meses com os maiores números de lançamentos (geral)

mes_maior_lancamento_geral <- imdb_datas |>                        
  group_by(mes) |>        
  summarise(qte = n()) |>             
  drop_na() |>
  arrange(desc(qte))


# tabela 03 - mes com maior lançamento geral

# configura qte do mes com mais lançamento para tabela 03

mes_maior_lancamento_tab03 <- mes_maior_lancamento_geral

mes_maior_lancamento_tab03[[2]] <- cell_spec(mes_maior_lancamento_tab03[[2]],
                                             color = ifelse(mes_maior_lancamento_tab03[[2]] >=8000,
                                                            "#B80C09",
                                                             "#3F88C5"
                                                            )
                                             )

# Tabela 03 - Mês com maior número de lançamentos

tab03 <- mes_maior_lancamento_tab03 |> 
  kbl(align = "l",                                                                   # alinhamento dos textos.
      col.names = c("Mês",                                                        
                    "Quantidade de Filmes"
                    ),
      full_width = TRUE,
      escape = FALSE
      ) |> 
  kable_styling(bootstrap_options = c("striped",
                                      "condensed"
                                      ),
                font_size = 12,
                full_width = TRUE, 
                fixed_thead = list(enabled = TRUE, 
                                   background = "#EDF6FD"
                                   ) 
                ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                                  # configurações das colunas.
              bold = FALSE,
              width = "10cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "10cm"
              ) |>
  footnote(general = "Maior quantidade de filmes no geral. Fonte: Base de dados IMDB.",            
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 03:"
           )

# visualiza a tabela 03

tab03    

```

<br>


### 4. O dia

<br>

::: {align="justify" style="text-indent: 3em;"}
As produções cinematográficas estreiam todas as semanas no mundo inteiro. No Brasil, elas ocorrem nas quintas-feiras. 

Analisando os dias de lançamentos dos filmes da base Imdb, observa-se, no gráfico 03, que o total de estreias ocorridas no primeiro dia de cada mês, com um total de 7260 filmes, foi significativamente maior que o ocorrido nos demais dias, cujas quantidades pouco variaram (entre 2240 e 2831 filmes). O dia 31 foi, naturalmente, aquele com menor número de estreias, pois nem todos os meses possuem este dia.

:::

<br>

```{r tab04 - dia com o maior numero de lancamentos}

# Tabela 04 - Dia com o maior número de lancamentos

# Obter o dia com o maior número de lançamentos

dia_maior_lancamento <- imdb_novo |> 
  mutate(dia = day(data_lancamento)) |> 
  group_by(dia) |> 
  summarise(qtde = n()) |> 
  drop_na() |> 
  slice_max(order_by = qtde)                         # obtem o maior valor ordenado pela quantidade de filmes.

### configurar valor qtde lançamentos para a tabela 04

dia_maior_lancamento[[2]][1] <- cell_spec(dia_maior_lancamento[[2]][1], 
                                          color = ifelse(dia_maior_lancamento[[2]][1]==7260,
                                                         "#B80C09",
                                                         ""
                                                         )
                                          )

### Tabela 04 - dia com o maior número de lançamentos

tab04 <- dia_maior_lancamento |>                                                                
  kbl(align = "l",                                                      
      col.names = c("Dia",                                                
                    "Quantidade de Filmes"
                    ),
      escape = FALSE
      ) |> 
  kable_styling(bootstrap_options = c("striped",                               # configura o estilo da tabela.
                                      "condensed"
                                      ),
                font_size = 12,
                full_width = TRUE, 
                fixed_thead = list(enabled = TRUE,
                                   background = "#EDF6FD"
                                   )
                ) |> 
  kable_classic_2() |>                                                              # define o tema da tabela.
  column_spec(1,                                                        
              bold = FALSE,
              width = "15cm"
              ) |>      
  column_spec(2,
              bold = FALSE,
              width = "15cm"
              ) |> 
  footnote(general = "Dia com maior número de lançamentos. fonte: Base de dados IMDB.",       
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 04:"
           )

### Visualiza tabela dia com o maior número de filmes lançados

tab04

```

<br>

```{r plot03 - lancamentos x dias}
#| echo = TRUE,
#| fig.height = 8,
#| fig.width = 14,
#| fig.cap = "Gráfico 03 - Total de lançamentos por dia. Fonte: Base de dados Imdb",

# Grafico total de lançamentos por dia

plot03<- imdb_novo |> 
  mutate(dia = day(data_lancamento)) |> 
  group_by(dia) |> 
  summarise(qtde = n()) |> 
  drop_na() |> 
  ggplot()+                           
  aes(x = dia, 
      y = qtde, 
      fill = dia, 
      label = qtde)+
  geom_point( size = 5,                                                              # cria elemento circular.
              color = "#CC5A71" 
              )+
  geom_label(size = 3.5, 
             alpha = 0,  
             label.size = NA, 
             color = "#CC5A71",     
             vjust = -1,       
             ) +
  geom_segment(aes(x = dia,                                                         # criar elemento segmento.
                   xend = dia,
                   y = 0,
                   yend = qtde
                   ),
               size = 1.5, 
               color = "#CC5A71"  
               )+
  gghighlight(dia == 1 | dia == 31,                                                  # destaca os dias 1 e 31. 
              unhighlighted_params = list(colour = "#4C586B"
                                          ) 
              )+
  labs(title = "Total de lançamentos por *<span style = 'color:#CC5A71;'>dia </span>*",
    subtitle ="Os dias com maior e menor quantidade de estreias", 
    y = "Quantidade de filmes
    ",
    x = "
    Dias do mês"
  ) +
  theme_classic()+                          
  scale_y_continuous(breaks = seq(0,
                                  8000,
                                  1000
                                  ),                                              # formatar escala do eixo y. 
                     limits = c(0,
                                8000
                                ),
                     expand = c(0,
                                0
                                )
                     ) +                                        
  scale_x_continuous(breaks = seq(0, 
                                  31,
                                  1
                                  )
                     ) +                                                          # formatar escala do eixo x.
  theme_imdb()

# Visualiza o gráfico total de lançamentos por dia

plot03                  

```

<br>

### 5. Os países com maior número de filmes

<br>

::: {align="justify" style="text-indent: 3em;"}
Embora a indústria cinematográfica indiana seja a que mais produza obras atualmente, ela ocupa apenas a quarta posição em quantidades de filmes da base Imdb. Os Estados Unidos são notadamente o país com o maior número de filmes, como mostrado na tabela 05.

:::

<br>

```{r tab05 - top 5 de paises com mais filmes na base}
#| fig.out = 100

# Tabela 05 - paises maiores produtores de filmes

# Obter os 5 países com mais filmes na base

top_5_paises <- imdb_novo |> 
  separate_rows(pais, sep = ", ") |> 
  group_by(pais) |> 
  summarise(qtde = n()) |> 
  arrange(desc(qtde)) |> 
  slice_head(n=5)

# Tabela 05 paises maiores produtores de filmes

tab05 <- top_5_paises |>                                                                        
  kbl(align = "l",                                      
      col.names = c("País",                   
                  "Quantidade de Filmes"
                  ),
      ) |> 
  kable_styling(  bootstrap_options = c("striped",                                # define o estilo da tabela.
                                        "condensed"
                                        ),
                  font_size = 12,
                  full_width = TRUE, 
                  fixed_thead = list(enabled = TRUE, 
                                     background = "#EDF6FD"
                                     )
                  ) |> 
  kable_classic_2() |>                                                              # define o tema da tabela.
  column_spec(1,                                                
              bold = FALSE,
              width = "15cm"
              ) |>      
  column_spec(2,                        
              bold = FALSE,
              width = "15cm"  
              ) |> 
  footnote(general = "Países maiores produtores de filmes. Fonte: Base de dados IMDB.",
           footnote_as_chunk = TRUE,                  
           fixed_small_size = TRUE,
           general_title = "Tabela 05:"
           )

# Visualiza a tabela - paises maiores produtores de filmes

tab05

```

<br>

```{r top 5 filmes Brasil}
#| include=FALSE


top_5_filmes_brasil <- imdb_novo |> 
  separate_rows(pais, sep = ", ") |> 
  filter(pais == "Brazil") |> 
  summarise( titulo, 
             ano, 
             genero, 
             nota_imdb,
             num_avaliacoes)|>
  arrange(desc(nota_imdb), desc(num_avaliacoes)) |> 
  slice_head(n=5)

```


### 6. O Brasil na base Imdb

<br>

::: {align="justify" style="text-indent: 3em;"}
O gráfico 04 mostra o Brasil na vigésima segunda posição, com 979 filmes produzidos entre 1931 e 2020, entre os quais "Cidade de Deus" e "O Auto da Compadecida" possuem ambos a maior média de 8.6, conforme a tabela 06.

:::


```{r plot04 - paises x qtde de filmes}
#| echo = TRUE,
#| fig.height = 10,
#| fig.cap = "Gráfico 04 - Países com mais filmes lançados e o Brasil. Fonte: Base de dados Imdb",

# gráfico 04: paises e totais de lançamentos

# obter os 22 países com maiores quantidades de filmes lançados

top_22_paises <- imdb_novo |> 
  separate_rows(pais, sep = ", ") |> 
  group_by(pais) |> 
  summarise(qtde = n()) |> 
  arrange(desc(qtde)) |> 
  slice_head(n=22) 
  
# Paleta de cores para os elementos gráficos

cor <- c(                                               
  "#c42847", "#ffad05", "#7d5ba6", "#00bbf9", "#2bc016",
  "#536265", "#536265", "#536265", "#536265", "#536265",
  "#536265", "#536265", "#536265", "#536265", "#536265",
  "#536265", "#536265", "#536265", "#536265", "#536265",
  "#536265", "#DE541E"
)

### Gráfico 04 - com os 16 países com maior número de filmes produzidos ----

plot04 <- top_22_paises |> 
  ggplot(aes(y = fct_reorder(pais,      # reordenar a sequência dos países em ordem decrescente da quantidade.
                             qtde, 
                             .desc = FALSE
                             ),
             x = qtde, 
             label = qtde
             )
         ) +
  geom_col(fill = cor)+
  geom_label(size = 4.5, 
             alpha = 0,
             label.size = NA,    
             fontface = "bold",  
             color = cor,
             hjust = -0.3
             ) +
  geom_curve(aes(y = 18,                                                       # formatar curva para anotação.
                 x = 8000,  
                 xend = 16000,     
                 yend = 16
                 ),
             arrow = arrow(type = "closed",                                         # formata a seta da linha.
                           length = unit(0.02,
                                         "npc"
                                         )
                           ),
             curvature = 0,  
             color = "#000000" 
             ) +
  geom_curve(aes(y = 1,                                                        # formatar curva para anotação.
                 x = 2800,  
                 xend = 11000,     
                 yend = 2
                 ),
             arrow = arrow(type = "closed",                                         # formata a seta da linha.
                           length = unit(0.02,
                                         "npc"
                                         ) 
                           ),
             curvature = 0, 
             color = "#000000"
             )+
  labs(title = "Países com maior número de filmes e o Brasil",
       subtitle = "Destaque para os cinco paises com maiores notas",
       x = "Quantidade de filmes lançados",
       y = "Paises"
       )+
  scale_x_continuous(breaks = seq(0,
                                  35500,
                                  2500
                                  ),
                     limits = c(0,
                                35500
                                ),
                     expand = expansion(add = c(0,
                                                1500
                                                )
                                        ),
                     labels = scales::number_format(accuracy = 1,
                                                    big.mark = "."
                                                    )
                     )+
  scale_y_discrete(expand = expansion(add = c(1,
                                              0
                                              )
                                      )
                   )+
  theme_classic()+                                                                 # define o tema do gráfico.
  theme_imdb()+
  annotate("text",
            x = 22000,
            y = 15.5,
            label = "Relação dos cinco países com mais lançamentos 
            registrados na base IMDB",
            color = "#000000", 
            size = 4,
            family = ""
           )+
  annotate( "text",
            x = 14700, 
            y = 2, 
            label = "Vigésima segunda posição",
            color = "#000000", 
            size = 4,
            family = ""
            )

# visualiza o gráfico 04 - paise e quantidades de filmes

plot04

```

<br>

```{r tab06 - melhores filmes brasileiros - ranking imdb }

# Tabela dos filmes brasileiros com maior ranking

tab06 <- top_5_filmes_brasil |>  
  kbl(align = "l",   
      col.names = c("Título",  
                    "Ano",
                    "Gênero",
                    "Nota IMDB",
                    "Numero de Avaliações"
                    ),
      ) |> 
  kable_styling(bootstrap_options = c("striped",                                  # altera o estilo da tabela.
                                      "condensed"
                                      ),
                font_size = 12,   
                full_width = TRUE, 
                fixed_thead = list(enabled = TRUE,
                                   background = "#EDF6FD"
                                   )
                ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                          # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "10cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              # background = "#022859",
              # color = "#FFFFFF",
              width = "5cm"
              ) |> 
  column_spec(3,                                                          # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "7cm"
              ) |>
  column_spec(4,                                                          # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>
  column_spec(5,                                                          # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>
    footnote(general = "Filmes nacionais com a melhores notas Imdb. Fonte: Base de dados IMDB.",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 06:",
           )

# Visualiza a tabela - filmes nacionais com maiores notas medias

tab06

```

<br>

### 7. Lista de todas as moedas citadas na base

<br>

::: {align="justify" style="text-indent: 3em;"}
A variável orçamento representa o valor total estimado de gastos para a produção e divulgação de um filme ou série. A indústria movimenta bilhões de dólares utilizados na contratação de tecnologias para produção de efeitos especiais e trilhas sonoras e na contratação de seu elenco. 

A base Imdb possui os valores de orçamento em variadas moedas. Relacionei todas as moedas presentes no *dataset* e listei-as na tabela 07 por código e divisa.

:::

<br>

```{r tab07 - relacão de moedas da base}

# Tabela 07 - relação de moedas da base

# lista de todas as moedas da base - coluna orçamento

moedas_orcamento <- imdb_novo |> 
  select(orcamento) |>
  mutate(moeda = str_extract(string = orcamento,                    # cria a coluna com os símbolos de moedas.
                             pattern = "[\\w | \\$].* " )        # regex para extração dos símbolos de moedas.
         ) |> 
  distinct(moeda) |>                      
  drop_na() |> 
  arrange(moeda)

# substituir o símbolo de moeda de $ para USD.

moedas_orcamento <- moedas_orcamento |> 
  mutate(moeda = str_trim(moeda)) |> 
  mutate(moeda = str_replace(moeda, pattern = "\\$",            
                             replacement = "USD"
                             )
         )

# Base de dados em xlsx com as moedas e suas divisas para operação de join

# caminho relativo do arquivo

tab_moedas <- readxl::read_xlsx(caminho_com_here_tab_moedas)

# juntar as tabelas moedas_receita e tab_moedas por meio da coluna moeda

moedas_orcamento_unificada<- left_join(x = moedas_orcamento,
                                       y = tab_moedas, 
                                       by = "moeda",
                                       copy = TRUE
                                       ) |> 
  distinct(moeda, divisa) |> 
  mutate(divisa = str_to_title(divisa))

# Tabela 07 - Relação de moedas na base

tab07 <- moedas_orcamento_unificada |> 
  kbl(align = "l",  
      col.names = c("Moeda",  
                    "Divisa"
                    )
    ) |> 
  kable_styling(                                                                    # define estilo da tabela.
    bootstrap_options = c("striped", 
                          "condensed"
                          ),
    font_size = 12,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE,
                       background = "#EDF6FD"
                       )
    ) |> 
  kable_classic_2() |>                                                              # define o tema da tabela.
  column_spec(1,                                                    
              bold = FALSE,
              width = "15cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "15cm"
              ) |> 
  footnote(general = "Relação de moedas da base. Fonte:Base de dados IMDB.",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 07:",
           )

# visualiza - relação de moedas da base

tab07

```

<br>

::: {align="justify" style="text-indent: 3em;"}
Algumas moedas como o Franco francês e o Marco alemão foram substituídas pelo Euro.

:::
<br>

### 8. Maiores lucros da indústria por gêneros em toda história

<br>

::: {align="justify" style="text-indent: 3em;"}
Analisando a soma dos lucros dos filmes por gênero, tem-se aventura, ação e comédia os mais lucrativos. Na tabela 08, encontra-se a lista dos 10 mais rentáveis.

:::

<br>

```{r tab08 - maiores lucros por gênero na história}

# separação da coluna genero para posterior pivotamento

imdb_filmes_dolares_genero <- imdb_filmes_dolares |> 
  separate(col = genero,
           into = c("genero1",
                    "genero2", 
                    "genero3"
                    ),
           sep = ","
  )

# pivotar a base de wide para long

imdb_filmes_dolares_genero <- imdb_filmes_dolares_genero |> 
  pivot_longer(
    cols = c("genero1",
             "genero2", 
             "genero3"
             ),
    names_to = "tipos_generos",
    values_to = "generos",
    values_drop_na = TRUE
  ) |> 
  mutate(generos = str_trim(generos))                 # remove os espaços em branco no início e fim da string.

# 10 gêneros com os maiores lucros

lucros_genero <- imdb_filmes_dolares_genero |>
  group_by(generos) |>
  summarise(lucro_total = sum(lucro)) |> 
  arrange(desc(lucro_total)) |> 
  slice_head(n=10) |> 
  mutate(lucro_total = paste("US$",         # formatar o valor obtido para o formato com US$ para a tabela 07.
                             format_dolar(lucro_total)      # função format_dolar() disponível no diretorio R.
                             )
         )

# Tabela 08 - Maiores lucros por gênero

tab08 <- lucros_genero |> 
  kbl(align = "l",  
      col.names = c("Gêneros",   
                    "Lucro Total"
                    )
      ) |> 
  kable_styling(bootstrap_options = c("striped",                                # altera os estilos da tabela.
                                      "condensed"
                                      ),
                font_size = 12,  
                full_width = TRUE, 
                fixed_thead = list(enabled = TRUE,
                                   background = "#EDF6FD"
                                   )
                ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                                    # define o tema da tabela.
              bold = FALSE,
              width = "15cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "15cm"
              ) |> 
  footnote(general = "Maiores lucros por gênero. Fonte: Base de dados IMDB.",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 08:",
           )

# Visualiza a tabela - Maiores lucros por gênero

tab08

```

<br>

::: {align="justify" style="text-indent: 3em;"}
Considerando que certos gêneros produzem mais filmes que outros, pode-se encontrar os mais lucrativos por filme.

:::
<br>

```{r tab09 - lucro por genero e quantidade de filme}

# obter as dez categorias com maiores lucros pela quantidade de filmes da categoria

lucros_genero_filme <- imdb_filmes_dolares_genero |>
  group_by(generos) |>
  summarise(lucro_total = sum(lucro)/n()) |> 
  arrange(desc(lucro_total)) |> 
  slice_head(n=10) |> 
  mutate(lucro_total = paste("US$",
                             format_dolar(lucro_total)
                             )
         )

# Tabela 09 - generos com maiores lucros por quantidade de filmes

tab09 <- lucros_genero_filme |> 
  kbl(align = "l", 
      col.names = c("Gêneros",     
                    "Lucro Total por Filme"
                    )
      ) |> 
  kable_styling(bootstrap_options = c("striped", 
                                      "condensed"
                                      ),
                font_size = 12,    
                full_width = TRUE, 
                fixed_thead = list(enabled = TRUE,
                                   background = "#EDF6FD"
                                   )
                ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                          # altera as configurações da tabela.
              bold = FALSE,
              width = "15cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "15cm"
              ) |> 
  footnote(general = "Lucros por gênero e quantidades de filmes. Base de dados IMDB.",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 09:",
           )

# Visualiza a tabela - lucros por gênero e quantidade de filmes

tab09

```

<br>

::: {align="justify" style="text-indent: 3em;"}
A tabela 09 traz o *ranking* dos lucros médios dos filmes por gênero. Animação e aventura lideram a classificação neste critério. 

:::

<br>

### 9. Maiores notas médias por gênero

<br>

::: {align="justify" style="text-indent: 3em;"}
Na construção do gráfico 05, considera-se todas as categorias, independentemente da quantidade de filmes produzidos em cada gênero. *Film Noir* apresentou a melhor média. 

Até hoje, não existe consenso sobre *film Noir* ser um gênero de filmes ou um estilo de filmagem. 

Este gênero ou estilo se refere a filmes de longa metragem típicas dos anos 40, que combina temas policiais, criminais e são marcados pela presença de anti-heróis em ambientes urbanos.

:::

```{r plot05 - notas médias por gêneros}
#| echo = TRUE,
#| fig.height = 4,
#| fig.width = 9,
#| fig.cap = "Gráfico 05 - Notas médias por gêneros.  Fonte: Base de dados IMDB.",

## join de imdb e imdb_avaliacoes

imdb_join_aval <- left_join(imdb_filmes_dolares_genero,
                            imdb_avaliacoes,
                            by = "id_filme"
                            )

## separação das variáveis da coluna genero

imdb_join_aval_generos <- imdb_join_aval |> 
  separate(col = generos,
           into = c("genero_aval1",
                    "genero_aval2", 
                    "genero_aval3"
                    ),
           sep = ","
           )

# pivotamento da base para long

imdb_join_aval_generos <- imdb_join_aval_generos |> 
  pivot_longer(
    cols = c("genero_aval1", 
             "genero_aval2", 
             "genero_aval3"),
    names_to = "tipos_generos_aval",
    values_to = "generos_aval",
    values_drop_na = TRUE
  ) |> 
  mutate(generos_aval = str_trim(generos_aval))

# join de imdb_join_aval_generos e imdb_avaliacoes

imdb_medias_genero <- left_join(imdb_join_aval_generos,
                                imdb_avaliacoes
                                ) 

# descobrir as maiores notas médias por gêneros considerando o número de avaliações superiores a 10000

maiores_nota_genero <- imdb_medias_genero |> 
  group_by(generos_aval) |> 
  summarise(nota_media = mean(nota_imdb)) |> 
  arrange(desc(nota_media)) 

# gráfico 05 - notas média por genero

plot05 <- maiores_nota_genero|> 
  ggplot()+
  aes(x = fct_reorder(generos_aval,nota_media,
                      .desc = TRUE
                      ),
      y = nota_media, 
      fill = generos_aval
      ) +
  geom_point(size = 5)+
  geom_segment(aes(x = generos_aval,
                   xend = generos_aval,
                   y = 5,
                   yend =  nota_media),
               linetype = 1,
               size = 0.1
               )+
  labs(title = "Gêneros e suas médias",
       x = "Gêneros",
       y = "Médias"
       )+
  scale_y_continuous(breaks = seq(0,
                                  8.5,
                                  0.5
                                  ),
                     limits = c(5, 
                                8.5
                                ),
                     expand = expansion(add = c(0,
                                                0
                                                )
                                        )
                     ) +
  scale_x_discrete(labels = c("Film-Noir", 
                              "Documentário", 
                              "Biografia",
                              "História", 
                              "Guerra", 
                              "Western",
                              "Animação", 
                              "Drama", 
                              "Musica", 
                              "Crime",
                              "Esporte", 
                              "Musical",
                              "Aventura",
                              "Romance",
                              "Mistério", 
                              "Sci-Fi", 
                              "Suspense", 
                              "Ação", 
                              "Fantasia", 
                              "Comédia", 
                              "Família",
                              "Terror"
                              )
                   ) +
  theme(axis.text.x = element_text(angle = 45, 
                                   hjust = -0.2, 
                                   size = 7
                                   ),
        axis.text.y = element_text(size = 7),
        axis.line.x = element_line(color = "#1F1F1F"), 
        axis.line.y = element_line(color = "#1F1F1F"), 
        axis.title.x = element_text(size = 11,
                                    face = "plain"
                                    ),
        axis.title.y = element_text(size = 11, 
                                    face = "plain"
                                    ),
        plot.background = element_rect(fill = "#FFFFFF"),
        panel.background = element_rect(fill = "#FFFFFF"),
        plot.margin = unit(c(1,
                             1,
                             1, 
                             1
                             ),
                           "cm"
                           ),                                       
        plot.title = element_markdown(                                       
        size = 16,
        family = "",                                                                
        margin = unit(c(0,
                        0,
                        0.5,
                        0
                        ),
                      "cm"
                      )     
        ), 
        text = element_text(family = "",   
                            color = "#000000",
                            size = 9
                            ),  
        axis.title = element_text(size = 14,
                                  hjust = 0.5
                                  ),
      legend.position = "none"   
      )

# Visualizar o gráfico notas médias por gêneros

plot05 |> 
  ggplotly(
    tooltip = c("y",                            # mostrar no gráfico dinamicamente apenas nota média e gênero.
                "generos_aval"
                )
    )

```

<br>

### 10. Avatar

```{r code descricao Avatar}
#| include = FALSE

descricao_avatar <- read_csv("../data/avatar_descricao_traduzida.csv")

descricao_portugues <- descricao_avatar[[2]]

```

::: {align="justify" style="text-indent: 3em;"}
Agora, apresento as informações sobre o filme **Avatar** obtidas a partir da base Imdb.

:::
<br>

#### 10.1 - Dados do filme

::: {align="justify" style="text-indent: 3em;"}
Sinopse da obra: `r descricao_portugues`

:::

<br>

```{r figura 07 - avatar filme}
#| fig.align = "center",
#| out.width = "40%",
#| echo = FALSE

knitr::include_graphics("../data-raw/avatar.jpg")

```

```{r cod avatar - descricao do filme}

imdb_avatar<- imdb_filmes_dolares |> 
  filter(titulo == "Avatar") |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao,
         elenco, orcamento, receita, genero, lucro)
  
```

::: {align="justify" style="text-indent: 3em;"}
"**`r imdb_avatar$titulo`**" pertence aos gêneros **`r imdb_avatar$genero`**. Sua *premiere* ocorreu em `r imdb_avatar$data_lancamento`,  com duração de `r imdb_avatar$duracao` minutos sob a direção `r imdb_avatar$direcao`.

Contou com a participação de `r imdb_avatar$elenco` em seu elenco.  

:::
<br>


```{r analise - avatar}
#| include = FALSE

# considerando apenas o valores em dólares

imdb_filmes_dolares <- imdb_novo |>
  filter(str_detect(orcamento, 
                    pattern = "\\$.*"
                    )
         )

# eliminar o símbolo $ nos valores das colunas orçamento e receita

imdb_filmes_dolares <- imdb_filmes_dolares |> 
  mutate(orcamento = str_remove(orcamento, pattern = "\\$ "),
         receita = str_remove(receita, pattern = "\\$ ")
         )

# alterar o tipo das variáveis orcamento e  receita

imdb_filmes_dolares$orcamento <- as.numeric(imdb_filmes_dolares$orcamento)
imdb_filmes_dolares$receita <- as.numeric(imdb_filmes_dolares$receita)

# calcular o lucro dos filmes

imdb_filmes_dolares <- imdb_filmes_dolares |> 
  mutate(
    lucro = receita - orcamento
  ) |>
  drop_na(lucro)

# juntar as bases para as demais análises

imdb_base_completa <- left_join(imdb_filmes_dolares, 
                                imdb_avaliacoes,
                                by = "id_filme"
                                )

# Renomear a variável direcao para nome para fajzer o join com imdb_pessoas

imdb_base_completa <- imdb_base_completa |> 
    rename("nome" = "direcao")

# join entre imdb_base_completa e imdb_pessoas

imdb_completa_pessoas <- left_join(imdb_base_completa, 
                                   imdb_pessoas,
                                   by = "nome"
                                   )

# Retornar a designação da variável nome para direcao

imdb_completa_pessoas <- imdb_completa_pessoas |> 
  rename("direcao" = "nome")

```

#### 10.2 - Direção

<br>

```{r tab10 - dados avatar diretor}

# tabela 10 - James Cameron

# Selecionar dados de James Cameron

dados_james <- imdb_completa_pessoas |> 
  filter(titulo == "Avatar") |> 
  select(titulo,
         direcao, 
         local_nascimento,
         data_nascimento
         ) |> 
  mutate(idade = year(Sys.Date())-year(data_nascimento))   # calcula a idade de James Cameron na data de hoje.

# formatar a variável idade para a tabela 10

dados_james[[5]] <- cell_spec(dados_james[[5]],
                              color = ifelse(dados_james[[5]] == 68,
                                             "#B80C09",
                                             "#3F88C5"
                                             )
                              )

# tabela 10 - dados de James Cameron

tab10 <- dados_james |> 
  kbl(align = "l",   
      col.names = c("Filme",
                    "Diretor", 
                    "Local de Nascimento",
                    "Data de Nascimento",
                    "Idade Atual"
                    ),
      full_width = TRUE,
      escape = FALSE
      ) |> 
  kable_styling(bootstrap_options = c("striped",                                  # define o estilo da tabela.
                                      "condensed"
                                      ),
                html_font = "",
                font_size = 12,
                full_width = TRUE, 
                fixed_thead = list(enabled = TRUE,
                                   background = "#EDF6FD"
                                   )
                ) |> 
  kable_classic_2() |>                                                              # define o tema da tabela.
  column_spec(1,                                                        
              bold = FALSE,
              width = "6cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "6cm"
              ) |> 
  column_spec(3, 
              bold = FALSE,
              width = "6cm"
              ) |> 
  column_spec(4, 
              bold = FALSE,
              width = "6cm"
              ) |> 
  column_spec(5, 
              bold = FALSE,
              width = "6cm"
              ) |> 
  footnote(general = "James Cameron. Base de dados IMDB.",  
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 10:"
           )
  
# visualiza a tabela - James Cameron

tab10

```

<br>

::: {align="justify" style="text-indent: 3em;"}
James Francis Cameron, nascido em Kapuskasing, Ontário, Canadá no dia 16 de agosto de 1954, atualmente com 68 anos é um produtor, cineasta, diretor e roteirista.

Em 2010, recebeu o prêmio de melhor diretor no Globo de Ouro com o filme **Avatar**. Também foi indicado para a mesma categoria no Oscar 2010 com este filme, concorrendo com Quentin Tarantino de "Bastardos Inglórios", Lee Daniels de "*Precious*", Jason Reitman de " *Up in the Air*" e Kathryn Bigelow de "*The Hurt Locker*". Não venceu, ficando o prêmio para Kathryn Bigelow, mas viu seu filme ser indicado em outras oito categorias, vencendo em três: melhor fotografia, melhor direção de arte e melhor efeitos visuais.

:::

<br>

#### 10.3 - Filmes de James Cameron na base

<br>

::: {align="justify" style="text-indent: 3em;"}
Além dos 7 filmes listados na base e relacionados na tabela 11, também atuou como diretor/roteirista nos filmes Piranha II: *The spawning*, Rambo: *First Blood Part II*, *Strange Days*, *Ghosts of the Abyss* e Alita: *Battle Angel*.

:::

```{r tab11 - Filmes de Cameron}

# tabela 11 - Filmes de Cameron na Base

# encontra os filmes de Cameron e cria coluna lucro com moeda US$ para a tabela 10.

filmes_cameron <- imdb_completa_pessoas |> 
  filter(direcao == "James Cameron") |> 
  select(titulo, data_lancamento,
         genero,
         nota_imdb, 
         lucro
         ) |> 
  arrange(data_lancamento) |>                                            # cria coluna lucro para a tabela 10.
  mutate(lucro = paste("US$",
                       format_dolar(lucro)
                       )
         )                       

# Tabela 11 - Filmes de Cameron

tab11 <- filmes_cameron|>
  kbl(
    align = "l",                                               
    col.names = c("Título",                         
                  "Data de Lançamento",
                  "Gênero",
                  "Nota IMDB",
                  "lucro"
    ),
    full_width = TRUE
  ) |> 
  kable_styling(                                                                  # altera o estilo da tabela.
    bootstrap_options = c("striped", 
                          "condensed"
                          ),
    font_size = 12,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, 
                       background = "#EDF6FD"
                       )
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                                    # define o tema da tabela.
              bold = FALSE,
              width = "5cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "4.5cm"
              ) |> 
  column_spec(3, 
              bold = FALSE,
              width = "5cm"
              ) |> 
  column_spec(4, 
              bold = FALSE,
              width = "5cm"
              ) |> 
  column_spec(5, 
              bold = FALSE,
              width = "5cm"
              ) |>
  footnote(general = "Filmes de Cameron na base. Fonte: Base de dados IMDB.",   
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 11:"
           )

# visualiza a tabela- Filmes de Cameron

tab11

```

<br>

#### 10.4 - Lucro médio dos filmes James Cameron na base

<br>

```{r code lucro medio filmes de Cameron, include=FALSE}
#| include = FALSE

lucro_medio_filmes <- imdb_completa_pessoas |> 
  filter(direcao == "James Cameron") |> 
  summarise(lucro_medio = round(mean(lucro),2)) |> 
  mutate(lucro_medio = paste("US$",format_dolar(lucro_medio)))

```

::: {align="justify" style="text-indent: 3em;"}
O lucro médio dos `r nrow(filmes_cameron)` filmes listados na base Imdb foi de `r lucro_medio_filmes`. **Avatar** com um ganho de `r filmes_cameron$lucro[7]` e Titanic com um ganho de `r filmes_cameron$lucro[6]` lideram a lista dos mais lucrativos.

:::

<br>

#### 10.5 - Nota média do filme Avatar e posição no ranking

<br>

```{r tab12 - posicao avatar no ranking imdb}

# tabela 12 - Avatar ranking e nota

# criar a coluna ranking

imdb_novo <- imdb_novo |> 
  mutate(ranking = 0)

# ordena os filmes em ordem decrescente da nota e preenche a coluna ranking 

imdb_novo_ordenado <- imdb_novo |> 
  arrange(desc(nota_imdb)) |> 
  mutate(ranking = c(1: length(imdb_novo$ranking)))

### seleciona os dados do filme Avatar

imdb_tab12 <- imdb_novo_ordenado |> 
  filter(titulo == "Avatar") |> 
  mutate(total_filmes = nrow(ranking)) |> 
  select(titulo, direcao,
         nota_imdb,
         ranking) 

# configura a coluna ranking imdb para tabela 12

imdb_tab12[[4]] <- cell_spec(imdb_tab12[[4]], 
                             color = ifelse(imdb_tab12[[4]] >=2600,
                                            "#B80C09",
                                            ""
                                            )
                             )

### Tabela 12 - com dados de Avatar e sua posição no ranking

tab12 <- imdb_tab12 |> 
  kbl(align = "l",  
      col.names = c("Título",           
                    "Direção",
                    "Nota IMDB",
                    "Ranking IMDB"
      ),
      full_width = TRUE,
      escape = FALSE
  ) |> 
  kable_styling(                                                                  # altera o estilo da tabela.
    bootstrap_options = c("striped",
                          "condensed"
    ),
    font_size = 12,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, 
                       background = "#EDF6FD"
    )
  ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                        # altera as configurações das colunas.
              bold = FALSE,
              width = "5cm"
  ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "5cm"
  ) |> 
  column_spec(3, 
              bold = FALSE,
              width = "5cm"
  ) |> 
  column_spec(4, 
              bold = FALSE,
              width = "5cm"
  ) |>
  footnote(general = "Avatar - ranking e nota. Fonte: Base de dados IMDB.",     
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 12:"
  )

# visualiza a tabela 11 - Avatar ranking e nota

tab12

```

<br>

::: {align="justify" style="text-indent: 3em;"}
Entre os filmes de James Cameron,  a nota de **Avatar** não é a mais alta entre os listados, com 7,8 é inferior às notas de Exterminador, Aliens e Exterminador 2 (vide tabela 11). Entretanto, foi o filme com a maior receita conforme o gráfico 06.

:::

<br>

```{r plot06 - filmes James Cameron}
#| fig.align = "center",
#| out.width = "100%",
#| echo = FALSE,
#| fig.cap = "Gráfico 06 - receita - orcamento e posição imdb. Fonte: Base de dados Imdb",

p <- imdb_filmes_dolares |> 
  filter(direcao == "James Cameron") |>
  select(titulo, receita, orcamento, nota_imdb) |> 
  mutate(titulo = factor(titulo, titulo)) |> 
  #mutate(text = paste("receita:", receita,"orçamento:", orcamento, "nota:", nota_imdb, sep = ",")) |> 
  ggplot(aes(x = receita, y = orcamento, size = nota_imdb, color = titulo))+
  geom_point(alpha=0.7) +
  scale_size(range = c(1.4, 13), name="Nota Imdb") +
  viridis::scale_color_viridis(discrete=TRUE, guide="none") +
  hrbrthemes::theme_ipsum()+
  theme(legend.position = "none",
        text = element_text(                                                                  # textos do gráfico.
      family = "",  
      color = "#000000",
      size = 10
    ),
    axis.text.x = element_text(                                                             # texto do eixo x.
      color = "#000000",       
      size = 7,
      margin = unit(c(0.5, 0, 0.5, 0), "cm")  
    ),
    axis.text.y = element_text(                                                            # texto do eixo y.
      color = "#000000",    
      size = 7,
      family = "", 
      margin = unit(c(0, 0.5, 0.5, 0), "cm") 
    ))+
  scale_y_continuous(labels = scales::number_format(accuracy = 0.1,
                                                    decimal.mark = ",",
                                                    big.mark = ".",
                                                    prefix = "US$"
                                                    ),
                     )+
  scale_x_continuous(labels = scales::number_format(accuracy = 0.1,
                                                    decimal.mark = ",",
                                                    prefix = "US$",
                                                    big.mark = "."
                                                    ),
                     breaks = seq(0,3000000000, 500000000)
                     )
  

pp <-  ggplotly(p)
  
pp

```

<br>

#### 10.6 - Posição de Avatar no ranking dos maiores lucros

<br>

::: {align="justify" style="text-indent: 3em;"}
Entre todos os `r nrow(imdb_novo)` filmes, **Avatar** ocupa a primeira posição no *ranking*  de lucros.

:::

<br>
 
```{r tab13 - posicao de avatar no ranking lucros}

# tabela 13 - Avatar - ranking de lucro

# cria a coluna ranking_lucro

imdb_filmes_dolares <- imdb_filmes_dolares |> 
  mutate(ranking = 0)

# preenche a coluna ranking dos filmes de acordo com sua renda em dólares
imdb_filmes_dolares_ordenado <- imdb_filmes_dolares |> 
  arrange(desc(lucro)) |> 
  mutate(ranking_dolar = c(1: length(imdb_filmes_dolares$ranking))) |> 
  select(titulo,
         direcao,
         lucro,
         ranking_dolar
         ) 

### Tabela 13 - Avatar ranking de lucro ----

imdb_tab13<- imdb_filmes_dolares_ordenado |> 
  filter(titulo == "Avatar") |> 
  mutate(lucro = paste("US$",
                       format_dolar(lucro)                        # cria coluna lucro com US$ para a tabela12.
                       )
         )

# configura coluna ranking dolar para destaque na tabela 13

imdb_tab13[[4]] <- cell_spec(imdb_tab13[[4]],
                             color = ifelse(imdb_tab13[[4]] == 1, 
                                            "#B80C09",
                                            ""
                                            )
                             )

tab13 <- imdb_tab13 |> 
  kbl(align = "l",  
      col.names = c("Título",                   
                    "Direção",
                    "Lucro",
                    "Ranking dólar"
      ),
      full_width = TRUE,
      escape = FALSE
  ) |> 
  kable_styling(bootstrap_options = c("striped",                                  # define o estilo da tabela.
                                      "condensed"
  ),
  font_size = 12,
  full_width = TRUE, 
  fixed_thead = list(enabled = TRUE, 
                     background = "#EDF6FD"
  )
  ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                        # altera as configurações das colunas.
              bold = FALSE,
              width = "5cm"
  ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "5cm"
  ) |> 
  column_spec(3, 
              bold = FALSE,
              width = "5cm"
  ) |> 
  column_spec(4, 
              bold = FALSE,
              width = "5cm"
  ) |>
  footnote(general = "Avatar - ranking de lucro. Fonte: Base de dados IMDB.",                         
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 13:",
  )


# visualiza tabela 13 Avatar ranking de lucro

tab13

```

<br>

#### 10.7 - Data de lançamento

<br>

```{r tab14 - dados do dia semana do lancamento avatar}

# tabela 14 - dia de lançamento

### seleciona dados do filme Avatar

imdb_tab14 <- imdb_novo_ordenado |> 
  filter(titulo == "Avatar") |> 
  mutate(data_lancamento_dia = wday(data_lancamento,
                                    week_start = getOption("lubridate.week.start",
                                                           7
                                                           ),
                                    abbr = FALSE,
                                    label = TRUE
                                    )
         ) |>
  select(titulo, data_lancamento, data_lancamento_dia) 

### configura a coluna data_lancamento_dia para destaque na tabela 14

imdb_tab14[[3]] <- cell_spec(imdb_tab14[[3]], 
                                color = ifelse(imdb_tab14[[3]] == "sexta",
                                               "#B80C09",
                                               ""
                                               )
                                )

# Tabela 14 - Dia da semana do lançamento

tab14 <- imdb_tab14|> 
  kbl(align = "l",    
      col.names = c("Título", 
                    "Data de lançamento",
                    "Dia da semana"
                    ),
      full_width = TRUE,
      escape = FALSE
      ) |> 
  kable_styling(bootstrap_options = c("striped",                                  # define o estilo da tabela.
                                      "condensed"
                                      ),
                font_size = 12,
                full_width = TRUE, 
                fixed_thead = list(enabled = TRUE,
                                   background = "#EDF6FD"
                                   )
                ) |> 
  kable_classic_2() |>                                                              # define o tema da tabela.
  column_spec(1,                                                 
              bold = FALSE,
              width = "7.5cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "7.5cm"
              ) |> 
  column_spec(3, 
              bold = FALSE,
              width = "5cm"
              ) |>
  footnote(general = "Dia da semana do lançamento. Fonte: Base de dados IMDB.",                    
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 14:"
           )

# visualiza a tabela 14 - dia de lançamento

tab14

```

<br>

::: {align="justify" style="text-indent: 3em;"}
A estreia nas salas de cinemas dos Estados Unidos ocorreu em `r imdb_novo_ordenado |> filter(titulo == "Avatar") |> select(data_lancamento)`, em uma sexta-feira. Neste dia, tinha `r as.duration(year("2010-01-15") - year("1989-06-07"))` anos de idade. 

:::

<br>

#### 10.8 - Filmes lançados no mesmo dia

<br>

::: {align="justify" style="text-indent: 3em;"}
Na tabela 15, listo todos os filmes lançados no dia 15 de janeiro de 2010, data de lançamento de **Avatar**.

:::

<br>

```{r tab15 - filmes lançados no mesmo dia}

# tabela 15 - filmes lançados no mesmo dia

tab15 <- imdb_novo_ordenado |> 
  filter(data_lancamento == "2010-01-15") |> 
  select(titulo,
         data_lancamento,
         genero,
         nota_imdb,
         pais
         ) |>
  kbl(align = "l",  
      col.names = c("Título",
                    "Data de Lançamento",
                    "Gênero",
                    "Nota IMDB",
                    "País"
                    ),
      full_width = TRUE
      ) |> 
  kable_styling(bootstrap_options = c("striped",                                  # define o estilo da tabela.
                                      "condensed"
                                      ),
    font_size = 12,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, 
                       background = "#EDF6FD"
                       )
    ) |> 
  kable_classic_2() |>                                                               #define o tema da tabela.
  column_spec(1,                                                
              bold = FALSE,
              width = "5cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "5cm"
              ) |> 
  column_spec(3, 
              bold = FALSE,
              width = "5cm"
              ) |> 
  column_spec(4, 
              bold = FALSE,
              width = "5cm"
              ) |>
  column_spec(5, 
              bold = FALSE,
              width = "5cm"
              ) |>
  footnote(general = "Filmes lançados no mesmo dia. Fonte:Base de dados IMDB.",           
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Tabela 15:",
           )
# visualiza a tabela - filmes lançados no mesmo dia

tab15

```

<br>

#### 10.8 - Distribuição de notas de Avatar por intervalo de classes de idade

<br>

::: {align="justify" style="text-indent: 3em;"}
Pode-se observar no gráfico 07 que as notas por faixa etária variaram pouco. A menor nota de 7.5 para o intervalo de 0 a 18 anos e a maior nota de 7.9 para a classe de pessoas com mais de 45 anos.

:::

<br>

```{r plot07 - notas médias imdb por faixa etária}
#| echo = TRUE,
#| fig.cap = "Gráfico 07 - Notas por faixa etária. Fonte: Base de dados Imdb",

# Gráfico distribuição da nota do filme avatar por idade

# renomear as colunas

imdb_avaliacoes <- imdb_avaliacoes |> 
  rename("[00-18)" = "nota_media_idade_0_18",
         "[18-30)" = "nota_media_idade_18_30",
         "[30-45)" = "nota_media_idade_30_45",
         "[45-ou mais)" = "nota_media_idade_45_mais")

# join das base imdb e imdb_avaliações

imdb_join_avatar_idades <- left_join(imdb_novo, imdb_avaliacoes, by = "id_filme") |> 
  filter(titulo == "Avatar") |>
  pivot_longer("faixas_etarias",
               values_to = "nota_media_idade", 
               cols =c("[00-18)",
                       "[18-30)",
                       "[30-45)",
                       "[45-ou mais)"
                       )
               ) |> 
  group_by(faixas_etarias) |> 
  summarise(nota_media_idade)

# cria paleta de cores para o gráfico

cor <- c("#c42847", 
         "#ffad05", 
         "#7d5ba6", 
         "#00bbf9"
         )

# gráfico 06 - notas por faixa etária

plot07 <- imdb_join_avatar_idades |> 
  ggplot(aes(x=faixas_etarias, 
             y = nota_media_idade, 
             label = nota_media_idade
             )
         )+
  geom_col(width = 0.5,
           fill = cor,
           alpha = 0.9
           )+
  geom_label(nudge_y = 0.5)+
  labs(title = "Distribuição das Notas por Idade",
       subtitle = "Notas médias por intervalo de classes do filme Avatar",
       x = "Idade",
       y = "Nota Média")+
  theme_classic()+
  theme_imdb() +
  scale_y_continuous(expand =expansion(add = c(0,
                                               0.5)
                                       ),
                     labels = scales::number_format(accuracy = 0.1,
                                                    decimal.mark = ","
                                                    )
                     )

# visualiza o grafico notas por faixa etária

plot07

```

<br>


# Conclusão

<br>

::: {align="justify" style="text-indent: 3em;"}
Explorei os recursos do **tidyverse** e demais ferramentas da linguagem R abordados no curso e extrai informações interessantes e curiosidades sobre artistas, quantidade de filmes, valores de receitas, gastos e lucros que a indústria cinematográfica movimenta e particularidades sobre os gêneros dos filmes. 

Na seção 10, trouxe informações sobre o meu filme preferido, **Avatar**.
 
A base permite a descoberta de muitas outras informações além das que apresentei neste trabalho e se constitui em uma excelente fonte para pesquisas sobre filmes e séries.

Aos amantes do cinema, segue o *link* do *trailer* de ["**Avatar: O Caminho das Águas**"](https://www.imdb.com/video/vi2659435033/?playlistId=tt1630029&ref_=tt_pr_ov_vi).

:::

<br>

# Anexos

<br>

## Dicionários

### 1. Dicionário da base Imdb

<br>

<style type="text/css">
.tg  {border:none;border-collapse:collapse;border-color:#9ABAD9;border-spacing:0;}
.tg td{background-color:#EBF5FF;border-color:#9ABAD9;border-style:solid;border-width:0px;color:#444;
  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:4px 10px;word-break:normal;}
.tg th{background-color:#409cff;border-color:#9ABAD9;border-style:solid;border-width:0px;color:#fff;
  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:4px 10px;word-break:normal;}
.tg .tg-4eio{background-color:#D2E4FC;border-color:#ffffff;font-size:12px;text-align:left;vertical-align:top}
.tg .tg-thfk{border-color:#ffffff;font-size:12px;text-align:left;vertical-align:top}
.tg .tg-w9cf{border-color:#ffffff;font-size:12px;font-weight:bold;text-align:left;vertical-align:top}
@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;}}</style>
<div class="tg-wrap"><table class="tg" style="undefined;table-layout: fixed; width: 828px">
<colgroup>
<col style="width: 210.005682px">
<col style="width: 211.005682px">
<col style="width: 407.005682px">
</colgroup>
<thead>
  <tr>
    <th class="tg-w9cf">Variável</th>
    <th class="tg-w9cf">Tipo</th>
    <th class="tg-w9cf">Descrição</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-4eio">id_filme</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">identificador alfanumérico exclusivo do título</td>
  </tr>
  <tr>
    <td class="tg-thfk">titulo</td>
    <td class="tg-thfk">chr</td>
    <td class="tg-thfk">nome da obra em materiais promocionais na data do lançamento</td>
  </tr>
  <tr>
    <td class="tg-4eio">titulo_original</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">nome original da obra, no idioma original</td>
  </tr>
  <tr>
    <td class="tg-thfk">ano</td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk">ano da produção</td>
  </tr>
  <tr>
    <td class="tg-4eio">data_lancamento</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">data do lançamento do filme ou a data de início da série</td>
  </tr>
  <tr>
    <td class="tg-thfk">genero</td>
    <td class="tg-thfk">chr</td>
    <td class="tg-thfk">inclui até três gêneros associados ao título</td>
  </tr>
  <tr>
    <td class="tg-4eio">duracao</td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio">tempo de execução em minutos</td>
  </tr>
  <tr>
    <td class="tg-thfk">pais</td>
    <td class="tg-thfk">chr</td>
    <td class="tg-thfk">país</td>
  </tr>
  <tr>
    <td class="tg-4eio">idioma</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">idioma</td>
  </tr>
  <tr>
    <td class="tg-thfk">orcamento</td>
    <td class="tg-thfk">chr</td>
    <td class="tg-thfk">orçamento</td>
  </tr>
  <tr>
    <td class="tg-4eio">receita</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">receita</td>
  </tr>
  <tr>
    <td class="tg-thfk">receita_eua</td>
    <td class="tg-thfk">chr</td>
    <td class="tg-thfk">receita nos EUA</td>
  </tr>
  <tr>
    <td class="tg-4eio">nota_imdb</td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio">nota média obtida pela obra nas avaliações dos usuários</td>
  </tr>
  <tr>
    <td class="tg-thfk">num_avaliacoes</td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk">total de avaliações realizadas para cada título</td>
  </tr>
  <tr>
    <td class="tg-4eio">direcao</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">diretor(es)</td>
  </tr>
  <tr>
    <td class="tg-thfk">roteiro</td>
    <td class="tg-thfk">chr</td>
    <td class="tg-thfk">roteirista(s)</td>
  </tr>
  <tr>
    <td class="tg-4eio">producao</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">empresa produtora</td>
  </tr>
  <tr>
    <td class="tg-thfk">elenco</td>
    <td class="tg-thfk">chr</td>
    <td class="tg-thfk">nomes dos integrantes do elenco</td>
  </tr>
  <tr>
    <td class="tg-4eio">descricao</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">sinopse da obra</td>
  </tr>
  <tr>
    <td class="tg-thfk">num_criticas_publico</td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk">total de críticas recebidas do público</td>
  </tr>
  <tr>
    <td class="tg-4eio">num_criticas_critica</td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio">total de críticas recebidas dos críticos</td>
  </tr>
</tbody>
</table></div>

<br>

### 2. Dicionário da base Imdb_pessoas

<br>

<style type="text/css">
.tg  {border:none;border-collapse:collapse;border-color:#9ABAD9;border-spacing:0;}
.tg td{background-color:#EBF5FF;border-color:#9ABAD9;border-style:solid;border-width:0px;color:#444;
  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:4px 10px;word-break:normal;}
.tg th{background-color:#409cff;border-color:#9ABAD9;border-style:solid;border-width:0px;color:#fff;
  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:4px 10px;word-break:normal;}
.tg .tg-4eio{background-color:#D2E4FC;border-color:#ffffff;font-size:12px;text-align:left;vertical-align:top}
.tg .tg-thfk{border-color:#ffffff;font-size:12px;text-align:left;vertical-align:top}
.tg .tg-w9cf{border-color:#ffffff;font-size:12px;font-weight:bold;text-align:left;vertical-align:top}
@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;}}</style>
<div class="tg-wrap"><table class="tg" style="undefined;table-layout: fixed; width: 828px">
<colgroup>
<col style="width: 211.005682px">
<col style="width: 211.005682px">
<col style="width: 406.005682px">
</colgroup>
<thead>
  <tr>
    <th class="tg-w9cf">Variável</th>
    <th class="tg-w9cf">Tipo</th>
    <th class="tg-w9cf">Descrição</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-4eio">pessoa_id</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">identificador alfanumérico exclusivo da pessoa</td>
  </tr>
  <tr>
    <td class="tg-thfk">nome</td>
    <td class="tg-thfk">chr</td>
    <td class="tg-thfk">nome artístico ou abreviado do ator, diretor ou roteirista</td>
  </tr>
  <tr>
    <td class="tg-4eio">nome_nascimento</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">nome completo</td>
  </tr>
  <tr>
    <td class="tg-thfk">altura</td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk">altura em cm</td>
  </tr>
  <tr>
    <td class="tg-4eio">bio</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">biografia</td>
  </tr>
  <tr>
    <td class="tg-thfk">data_nascimento</td>
    <td class="tg-thfk">chr</td>
    <td class="tg-thfk">data de nascimento</td>
  </tr>
  <tr>
    <td class="tg-4eio">local_nascimento</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">local de nascimento</td>
  </tr>
  <tr>
    <td class="tg-thfk">data_falecimento</td>
    <td class="tg-thfk">date</td>
    <td class="tg-thfk">data de falecimento</td>
  </tr>
  <tr>
    <td class="tg-4eio">local_falecimento</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">local de falecimento</td>
  </tr>
  <tr>
    <td class="tg-thfk">razao_falecimento</td>
    <td class="tg-thfk">chr</td>
    <td class="tg-thfk">motivo ou causa do falecimento</td>
  </tr>
  <tr>
    <td class="tg-4eio">nome_conjuges</td>
    <td class="tg-4eio">chr</td>
    <td class="tg-4eio">nome(s) do cônjuge(s)</td>
  </tr>
  <tr>
    <td class="tg-thfk">num_conjuges</td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk">número de cônjuges</td>
  </tr>
  <tr>
    <td class="tg-4eio">num_divorcios</td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio">total de divórcios</td>
  </tr>
  <tr>
    <td class="tg-thfk">num_filhos</td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk">total de filhos</td>
  </tr>
  <tr>
    <td class="tg-4eio">num_conjuges_com_filhos</td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio">total de cônjuges com filhos</td>
  </tr>
</tbody>
</table></div>

<br>

### 3. Dicionário da base Imdb_avaliacao
<br>

<style type="text/css">
.tg  {border:none;border-collapse:collapse;border-color:#9ABAD9;border-spacing:0;}
.tg td{background-color:#EBF5FF;border-color:#9ABAD9;border-style:solid;border-width:0px;color:#444;
  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:4px 10px;word-break:normal;}
.tg th{background-color:#409cff;border-color:#9ABAD9;border-style:solid;border-width:0px;color:#fff;
  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:4px 10px;word-break:normal;}
.tg .tg-4eio{background-color:#D2E4FC;border-color:#ffffff;font-size:12px;text-align:left;vertical-align:top}
.tg .tg-thfk{border-color:#ffffff;font-size:12px;text-align:left;vertical-align:top}
.tg .tg-w9cf{border-color:#ffffff;font-size:12px;font-weight:bold;text-align:left;vertical-align:top}
@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;}}</style>
<div class="tg-wrap"><table class="tg" style="undefined;table-layout: fixed; width: 827px">
<colgroup>
<col style="width: 210.005682px">
<col style="width: 211.005682px">
<col style="width: 406.005682px">
</colgroup>
<thead>
  <tr>
    <th class="tg-w9cf">Variável</th>
    <th class="tg-w9cf">Tipo</th>
    <th class="tg-w9cf">Descrição</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-4eio"><span style="font-weight:400;font-style:normal">id_filme</span></td>
    <td class="tg-4eio"><span style="font-weight:400;font-style:normal">chr</span></td>
    <td class="tg-4eio"><span style="font-weight:400;font-style:normal">identificador alfanumérico exclusivo do título</span></td>
  </tr>
  <tr>
    <td class="tg-thfk">num_avaliacoes</td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk">total de avaliações</td>
  </tr>
  <tr>
    <td class="tg-4eio">nota_media</td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio">média da variável nota</td>
  </tr>
  <tr>
    <td class="tg-thfk">nota_mediana</td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk">mediana da variável nota</td>
  </tr>
  <tr>
    <td class="tg-4eio">nota_media_idade_0_18</td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio">média da variável nota entre os avaliadores de 0 a 18 anos</td>
  </tr>
  <tr>
    <td class="tg-thfk">num_votos_idade_0_18</td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk">número de votos dos avaliadores de 0 a 18 anos</td>
  </tr>
  <tr>
    <td class="tg-4eio">nota_media_idade_18_30</td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio"><span style="font-weight:400;font-style:normal">média da variável nota entre os avaliadores de 18 a 30 anos</span></td>
  </tr>
  <tr>
    <td class="tg-thfk"><span style="font-weight:400;font-style:normal">num_votos_idade_18_30</span></td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk"><span style="font-weight:400;font-style:normal">número de votos dos avaliadores de 18 a 30 anos</span></td>
  </tr>
  <tr>
    <td class="tg-4eio"><span style="font-weight:400;font-style:normal">nota_media_idade_30_45</span></td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio"><span style="font-weight:400;font-style:normal">média da variável nota entre os avaliadores de 30 a 45 anos</span></td>
  </tr>
  <tr>
    <td class="tg-thfk"><span style="font-weight:400;font-style:normal">num_votos_idade_30_45</span></td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk"><span style="font-weight:400;font-style:normal">número de votos dos avaliadores de 30 a 45 anos</span></td>
  </tr>
  <tr>
    <td class="tg-4eio">nota_media_45_mais<br></td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio"><span style="font-weight:400;font-style:normal">média da variável nota entre os avaliadores com 45 anos ou mais</span><br></td>
  </tr>
  <tr>
    <td class="tg-thfk"><span style="font-weight:400;font-style:normal">num_votos_idade_45_mais</span></td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk"><span style="font-weight:400;font-style:normal">número de votos dos avaliadores de 45 ou mais anos</span></td>
  </tr>
  <tr>
    <td class="tg-thfk">nota_media_top_1000_avaliadores</td>
    <td class="tg-thfk"><span style="font-weight:400;font-style:normal">dbl</span></td>
    <td class="tg-thfk">nota média dos top 1000 avaliadores</td>
  </tr>
  <tr>
    <td class="tg-4eio">num_votos_top_1000_avaliadores</td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio">número de votos dos top 1000 avaliadores</td>
  </tr>
  <tr>
    <td class="tg-thfk">nota_media_eua</td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk">média da variável nota nos EUA</td>
  </tr>
  <tr>
    <td class="tg-4eio">num_votos_eua</td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio">número de votos nos EUA</td>
  </tr>
  <tr>
    <td class="tg-thfk">nota_media_fora_eua</td>
    <td class="tg-thfk">dbl</td>
    <td class="tg-thfk">média da variável nota fora dos EUA</td>
  </tr>
  <tr>
    <td class="tg-4eio">num_votos_fora_eua</td>
    <td class="tg-4eio">dbl</td>
    <td class="tg-4eio">número de votos fora dos EUA</td>
  </tr>
</tbody>
</table></div>





