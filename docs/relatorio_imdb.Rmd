---
title: "I see you"
subtitle: "Base de Dados IMDB"
author: "Marcio Vakassugui"
date: "2022-05-10"
output: 
  html_document: 
    code_folding: hide
    includes:
      in_header: "cabecalho.html"
    theme: paper
    highlight: zenburn
    toc: yes
    toc_float: yes
    smooth_scroll: no
    collapsed: yes
  html_notebook: 
    toc: yes
---

```{r setup }
#| include=FALSE

knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  align = "center",
  fig.height = 7,
  fig.width = 14
)
```
<br><br><br><br><br>

# <font color = #303E28> Introdução </font>

<br>

::: {align="justify" style="text-indent: 3em;"}
O IMDB, *Internet Move Database*, é uma das maiores bases pesquisáeis de dados sobre filmes e séries disponíveis para acesso para uso pessoal e não comercial fornecida por um dos mais respeitados *sites* de crítica popular de filmes e séries do mundo. Todos os usuários registrados no [Internet Movie DataBase](https://www.imdb.com/) podem avaliar os filmes, as séries e os documentários com notas de 1 a 10. Na sua página, é possivel encontrar as notas médias dos filmes, *trailers*,  a lista com as principais bilheterias da semana nos Estados Unidos, informações sobre o elenco e direção, resenhas de críticos, galerias de fotos e curiosidades.

Este trabalho de conclusão de curso objetiva a aplicação dos recursos abordados no curso "R para Ciência de Dados II", como organização de projetos, manipulação dos dados por meio dos pacotes *__dplyr__* e *__tidyr__*, de textos com  *__stringr__*, de datas e fatores com *__lubridade__* e *forcats* respectivamente, além de outras ferramentas e pacotes importantes como "*__expressões regulares__*", "*__funções anônimas__*", *__git__* e *__github__* e aplicações dos pacotes *__purrr__* e *__nse__*.

O conteúdo deste projeto é direcionado aos leitores interessados na sétima arte, que não abrem mão de assistir a um filme, na aconchegante poltrona de casa ou do cinema. Caso também tenha interesse em linguagem R, encontrará facilmente os códigos da manipulação dos dados e das gerações dos gráficos e tabelas.

Trarei algumas curiosidades sobre a base IMDB e também sobre um filme me impressionou o público há 12 anos com o lançamento do seu capítulo 1 e que em dezembro de 2022 retornará às telas dos cinemas de todo o mundo para a apresentação do segundo  de um total de cinco capítulos. 
:::


```{r carregar os pacotes}
#| echo = FALSE

library(readr)                                                                                      # leitura.
library(tidyverse)                                                                              # manipulação.
library(lubridate)                                                                     # manipulação de datas.
library(forcats)                                                                    # maninpulação de factors.
library(kableExtra)                                                                                 # tabelas.
library(plotly)                                                                      # extensão para gráficos.
library(gghighlight)                                                                 # extensão para gráficos.
library(ggtext)                                                                      # extensão para gráficos.
library(ggthemes)                                                                     # temas para relatórios.
library(patchwork)
```

```{r  Leitura das bases}
#| echo = FALSE

imdb <- read_rds("../data-raw/imdb.rds")
imdb_avaliacoes <- read_rds("../data-raw/imdb_avaliacoes.rds")
imdb_pessoas <- read_rds("../data-raw/imdb_pessoas.rds")
    
```

```{r manipulação de dados}
#| echo = FALSE

# alterar o tipo da variável data_lancamento de "char" para "date" -----------------------------

imdb <- imdb |>    
  mutate(
    data_lancamento = ymd(data_lancamento),                               # conversão para date.
  )
```

<br>

# <font color = #303E28> Análises </font>

<br>

::: {align="justify" style="text-indent: 3em;"}
As três bases analisadas (imdb, imdb_avaliacoes e imdb_pessoas) possuem em suas primeiras linhas os cabeçalhos com nomes de suas  variáveis. O *database* imdb possui `r nrow(imdb)` linhas com `r ncol(imdb)` variáveis e conta com os dados de lançamentos entre 1894 a 2020. O *database* imdb_avaliacoes também possui `r nrow(imdb_avaliacoes)` linhas e `r ncol(imdb_avaliacoes)` colunas e o *database* imd_pessoas possui `r nrow(imdb_pessoas)` linhas  `r ncol(imdb_pessoas)` variáveis.

Na seção Anexos, ao final deste relatório,  encontram-se os dicionários das bases com as designações das variáveis e suas descrições.

Todos os códigos de preparação  e de manipulação das bases como limpeza dos dados, união e junção de tabelas, entre outras, estão disponíveis para visualização, juntamente com os códigos de construção das tabelas e gráficos por meio do botão "code/hide". 
:::

<br>

### <font color = #303E28> 1.Mês histórico </font>

<br>

::: {align="justify" style="text-indent: 3em;"}

Em que mês, em toda  história, ocorreu o maior número de estreias de filmes e ou séries? 

Analisando o gráfico abaixo, vemos que a quantidade de filmes produzidos evoluiu de 393 obras para 3281 lançamentos em 2018 e, em função da pandemia, um queda em 2019 para 3108 filmes.

:::

<br><br>

```{r plot qtde de filmes por ano}
#| echo = TRUE,
#| fig.height = 4,
#| fig.width = 9,
#| fig.cap = "Fonte: Base de dados IMDB (Internet Movie Database",
#| highlight = TRUE

p_filmes_ano <- imdb |> 
  mutate(ano_lancamento = year(data_lancamento)) |>                            # cria a coluna ano_lancamento.
  select(ano_lancamento) |> 
  drop_na() |>
  group_by(ano_lancamento) |> 
  summarise(qte = n()) |>                                 # resume por ano e quantidade de filmes em cada ano.
  slice_head(n=112) |>                    # linha 113 possui dados de 2021 de alguns meses. Exclui esta linha.
  ggplot()+
  aes(x = ano_lancamento, 
      y = qte)+
  annotate("rect",                                                # cria anotação retangular ao redor de 2018.
           xmin = 2010,
           xmax = 2026,
           ymin = 2950, 
           ymax = 3500,
           fill = "#99D8FF", 
           alpha = 0.3
           ) +
  annotate("text",                                               # cria anotação de texto sobre o ano de 2018.
           x = 1960, 
           y = 3281,
           label = "2018 - ano com maior número lançamentos da história", 
           size = 3
           ) +
  geom_segment(aes(y = 3281,                                              # cria a linha da anotação de texto.
                   x = 1992,  
                   xend = 2009,     
                   yend = 3281   
                   ),
               size = 0.3,
               fill = "#000000"   
               ) +
  geom_line(color = "blue")+                                                          # cria gráfico de linha.
  geom_point(color = "red",                                 # cria gráfico de pontos sobre o gráfico de linha.
             shape = 7,
             size = 0.5
             )+
  gghighlight(ano_lancamento >=1960,                    # destaca os dados com ano_lançamento superior a 1960.
              unhighlighted_params = list(colour = "#4C586B"
                                          )
              )+
  labs(title = "Total de filmes por ano",                            # define os textos para o título e eixos.
       x = "
    Ano",
    y = "Quantidade
    
    "
  )+
  scale_x_continuous(breaks = seq(0,                   # define a escala do eixo x de 0 a 2022, passo 10 anos.
                                  2022, 
                                  10
                                  )
                     ) +
  scale_y_continuous(breaks = seq(0,                    # define a escala do eixo y de 0 a 4000, passo de 500.
                                  4000, 
                                  500
                                  )
                     ) +
  theme_classic()                                                                 # escolhe o tema do gráfico.
  
p_filmes_ano |> 
  ggplotly()                                                                                # gera a o plotly.
```

<br><br>

::: {align="justify" style="text-indent: 3em;"}

Neste ano, pré-pandêmico, ocorreram as maiores quantidades de lançamentos de filmes por mês da história. Então, qual seria o mês com os maiores totais?

:::


```{r preparacao da base e tabela mes com maior numero de lancamentos de filmes}

### Cria a coluna mes
imdb_datas <- imdb |>
  mutate(mes = month(data_lancamento, label = TRUE, abbr = TRUE))  

### Obtém o mês com o maior número de lançamentos.
mes_maior_lancamento <- imdb_datas |>                        
  group_by(mes, ano) |>        
  summarise(qte = n()) |>             
  drop_na() |> 
  slice_max(qte) |> 
  arrange(desc(qte))

### cria tabela com dados do mês e maior número de estreias.
tab_mes_maior_lancamento <- mes_maior_lancamento |>   
  head(n=1) |> 
  kbl(
    align = "l",                                               # alinhamento do texto do cabeçalho à esquerda.
    col.names = c("Mês",                                             # define o nome dos cabeçalhos da tabela.
                  "Ano de Lançamento", 
                  "Quantidade de Filmes Lançados"),
    full_width = TRUE,
  ) |> 
  kable_styling(                                                          # altera as configurações da tabela.
    html_font = "get_schwifty",
    bootstrap_options = "basic",
    font_size = 10,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
  ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                        # altera as configurações das colunas.
              bold = FALSE,
              width = "3cm"
  ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "3cm"
  ) |>
  column_spec(3,
              bold = FALSE,
              width = "4cm"
  ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",                           # cria rodapé.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
  )

tab_mes_maior_lancamento                                                                 # visualiza a tabela.

```


```{r plot total de lançamentos por mês}
#| fig.height = 6,
#| fig.width = 14

# Cria o gráfico com 
meses_mais_qte <- mes_maior_lancamento |> 
  group_by(qte, ano) |> 
  summarise(mes) |> 
  arrange(desc(qte)) |> 
  unite(col = "mes_ano", c("mes","ano"), sep = "") |> 
  arrange(desc(qte)) |> 
  head(20) 

 
cores_plot02 <- c("#CC5A71", "#536265", "#536265", "#536265", "#536265","#536265",
                  "#536265", "#536265", "#536265", "#536265", "#536265","#536265",
                  "#536265")

plot01 <- meses_mais_qte|> 
  ggplot(aes(x = fct_reorder(mes_ano, qte, .desc = TRUE), 
             y = qte, 
             fill = mes_ano,
             label = qte))+               # cria o gráfico de lollypop - combinando geom_point e geom_segment.
  geom_point(                                                                        # cria elemento circular.
    size = 5,                                                                                      # diâmetro.
    color = cores_plot02                                                                       # cor vermelha.
  )+
  geom_label(                                                                            # formatar os labels.
    size = 4,                                                               # diâmetro do círculo do lollypop.
    alpha = 0,                                                                     # elimina o fundo do label.
    label.size = NA,                                                  # elimina a moldura retangular do label.
    color = cores_plot02,                                                        # cor do círculo em vermelho.
    vjust = -1,                                                           # posição do label acima do círculo.
  ) +
  geom_segment(aes(x = mes_ano,                                                   # criar o elemento segmento.
                   xend = mes_ano,
                   y = 0,
                   yend = qte
                   ),
               color = cores_plot02,
               size = 1.5,                                                              # largura do segmento.                          
  )+
  labs(                                                                # editar o texto do título em markdown.
    title = "Total de lançamentos por *<span style = 'color:#CC5A71;'>mes </span>*",
    subtitle ="Os meses com maior quantidade de estreias",                 # editao o texto subtítulo em text.
    y = "Quantidade de filmes
    ",
    x = "
    Meses do ano"
  ) +
  theme_classic()+                                                               # seleção do tema do gráfico.
  scale_y_continuous(breaks = seq(0, 500, 50),
                     limits = c(0,500)) +                                         # formatar escala do eixo y.  
  theme(                                                        
    panel.background = element_rect(fill = "#FFFFFF"),                                     # fundo do gráfico.
    plot.background = element_rect(fill = "#FFFFFF"),                           # fundo da moldura retangular.
    plot.margin = unit(c(1, 1, 1, 1), "cm"),                                          # distância das margens.
    plot.title = element_markdown(                                            # título do gráfico em markdown.
      size = 24,
      family = "Arial",                                                                     # fonte do título.
      margin = unit(c(0, 0, 0.5, 0), "cm")                                                # margens do título.
    ), 
    plot.subtitle = element_text(                                                        #textos do subtitulo.
      size = 14,
      family = "Arial",   
    ),
    text = element_text(                                                                  # textos do gráfico.
      family = "Arial",    
      color = "#000000",
      size = 14
    ),
    axis.text.x = element_text(                                                             # texto do eixo x.
      color = "#000000",       
      size = 15,
      margin = unit(c(0.3, 0, 0.5, 0), "cm")  
    ),
    axis.text.y = element_markdown(                                                         # texto do eixo y.
      color = "#000000",    
      size = 15,
      family = "Arial", 
    ),
    axis.ticks.x = element_line(color = "#1F1F1F"),                                         # ticks do eixo x.
    axis.line.x = element_line(color = "#1F1F1F"),                                   # cor da linha do eixo x.
    axis.ticks.y = element_line(color = "#1F1F1F"),                             # padrões dos ticks do eixo x.
    axis.line.y = element_line(
      color = "#000000",                                                             # cor da linha do eixo x.
      size = 0.4,
    ),
    axis.title = element_text(                                                    # texto do título do eixo x.
      size = 16,
      hjust = 0.5,
    ),
    legend.position = "none"                                                               # exclui a legenda.
  )

plot01                                                                                  # visualiza o gráfico.
  

```


::: {align="justify" style="text-indent: 3em;"}
No auge de lançamentos, o mês de outubro teve 397 *premieres*. Este foi o mês com o maior número de estreias. 

Listamos abaixo os 15 filmes deste mês de outubro pelas maiores notas médias IMDB, considerando apenas os avaliados por mais de 10000 pessoas.
:::

```{r relacao dos 15 filmes de outubro de 2018 com maior numero de lancamentos }

## Manipulação da base para obtenção da relação dos 15 filmes  de outubro de 2018 por ranking 
mes_maior_lancamento <- imdb_datas |>                                # lista dos 15 filmes com melhor ranking.
  group_by(mes) |>        
  summarise(qte = n(),
            titulo,
            data_lancamento, 
            nota_imdb, 
            num_avaliacoes,
            pais,
            ano = year(data_lancamento)) |>
  filter(mes == "out" & ano == 2018 & num_avaliacoes >= 10000) |> 
  arrange(desc(nota_imdb)) |> 
  slice_head(n=15)

mes_maior_lancamento$mes <- NULL                                                        # Exclusão de colunas. 
mes_maior_lancamento$qte <- NULL

## Tabela com os 15 filmes  de outubro de 2018com melhores rankings
mes_maior_lancamento |> 
  select(titulo, data_lancamento, nota_imdb, num_avaliacoes, pais) |> 
kbl(
  align = "l",                                                            # alinhamento do texto do cabeçalho.
  col.names = c("título",                                                       # define o nome das variáveis.
                "lançamento", 
                "nota",
                "avaliações",
                "país"),
  ) |> 
  kable_styling(                                                          # altera as configurações da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "Arial",
    font_size = 10,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD"),
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                        # altera as configurações das colunas.
              bold = FALSE,
              width = "3cm",
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "1cm"
              
              ) |>
  column_spec(3,
              bold = FALSE,
              width = "1cm"
              ) |> 
  column_spec(4,
              bold = FALSE,
              width = "1cm"
              ) |> 
  column_spec(5,
              bold = FALSE,
              width = "4cm"
              ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )
```

<br>

::: {align="justify" style="text-indent: 3em;"}
Destaca-se os filmes "Ratsasan" e "A Star is born", aquele pela nota maisl alta e este pelo elenco que contou com o ator Bradley Cooper e a cantora Lady Gaga. 

Abaixo, alguns dados extraídos da base IMDB e algumas informações obtidas da *Web* sobre estes dois filmes.
:::

<br>

####  {.tabset .tabset-fade}

##### A Star is Born

```{r filme nasce uma estrela}

imdb_nasce_uma_estrela <- imdb |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao, elenco, orcamento, receita) |> 
  filter(titulo == "A Star Is Born")
```

::: {align="justify" style="text-indent: 3em;"}
O filme "`r imdb_nasce_uma_estrela$titulo`" foi  lançado  no Brasil como "Nasce uma Estrela". De origem stadunidense pertence aos gêneros drama, musical e romance. Sua *premier* ocorreu no dia 11 de outubro de 2018 com duração de `r imdb_nasce_uma_estrela$duracao` minutos sob a direção de `r imdb_nasce_uma_estrela$direcao`, roteiro de `r imdb_nasce_uma_estrela$roteiro`, contou com a participação de `r imdb_nasce_uma_estrela$elenco` em seu elenco. A obra teve um orçamento, de acordo com a base, de US`r imdb_nasce_uma_estrela$orcamento` e uma receita de US`r imdb_nasce_uma_estrela$receita`, obtendo um lucro de US$ 76188866.

De acordo com o *wikipedia*, cogitou-se a participação da cantora **Beyouncé** para estrelar o papel principal. Entretanto, em maio de 2016, a revista americana *Deadline Holliwood* publicou um artigo que dizia que Bradley Cooper queria Lady Gaga como protagonista. Este filme foi a primeira participação imponente de Lady Gaga no cinema.

:::
<br>

##### Ratsasan

```{r filme ratsasan}

imdb_ratsasan <- imdb |> 
  select(titulo, data_lancamento, duracao, direcao, roteiro, producao, elenco) |> 
  filter(titulo == "Ratsasan")
```


::: {align="justify" style="text-indent: 3em;"}
O filme "`r imdb_ratsasan$titulo`" disponível na plataforma Netflix (consulta em 17/05/2022) é um filme dos gêneros ação, crime e suspense. Foi produzido em língua tamil. Conta a história de de um aspirante a diretor de cinema que se torna policial após a morte de seu pai e tenta rastrear um serial *killer*.
Foi lançado no dia 05 de outubro de 2018 com duração de `r imdb_ratsasan$duracao` minutos, dirigido por `r imdb_ratsasan$direcao`, roteiro de `r imdb_ratsasan$roteiro`, contou com os atores `r imdb_ratsasan$elenco`.

A base IMDB não possui dados sobre o orçamento e a receita arredada, mas de acordo como o *wikipedia* o filme arrecadou, por exemplo, nos Estados Unidos US\$ 2624379, no Reino Unido Є 748185 e no Canadá US$ 1567893.
:::


### <font color = #303E28> 2. Dia especial </font>

<br>

::: {align="justify" style="text-indent: 3em;"}

Analisando as datas de lançamentos dos filmes em 2022 na página [mundo conectado](https://mundoconectado.com.br/artigos/v/21921/todos-os-123-filmes-que-estreiam-nos-cinemas-brasileiros-em-2022), verifica-se, em nosso país, que os filmes t no mesmo têm suas estreias no mesmo dia, ou seja, em uma mesma quinta-feira (antes de março de 2014 os lançamentos ocorriam nas sextas-feiras, mas o dia das estreias foi alterado após acordo entre os exibidores e ditribuidores brasileiros). 

Neste mês as estreias tivemos o lançamento dos filmes "Doutor Estranho in the Multiverse of Madness" e "Mrs. Harries Goes to Paris" no dia 05, os filmes "Paris 13th District" e "King" no dia 12, "Uma Pitada de Sorte", "DC Liga dos SuperPets" e "Quatro Amigas Numa Fria" no dia 19 e "Top Gun Maverick", "Bob's Burger" e "Vovó Ninja" no dia 26 de maio.
 
Em relação à base IMDB, qual seria o dia com a maior quantidade de filmes lançados?

<br>

:::

```{r dia com o maior numero de lancamento}

#### Manipulação da base para a obtencão do dia com o maior número de lançamentos---------------------
dia_maior_lancamento <- imdb |> 
  mutate(dia = day(data_lancamento)) |> 
  group_by(dia) |> 
  summarise(qtde = n()) |> 
  drop_na() |> 
  slice_max(order_by = qtde)

### Tabela com os dados do dia com maior número de lançamentos --------------------------------------
dia_maior_lancamento |>                                                                
  kbl(align = "l",                                                        # alinhamento do texto do cabeçalho.
      col.names = c("Dia",                                                        # define o nome das colunas.
                  "Quantidade de Filmes Lançados"
                  ),
      ) |> 
  kable_styling(bootstrap_options = c("striped",                                    # define estilo da tabela.
                                      "condensed"),
                html_font = "get_schwifty",
                font_size = 10,
                full_width = TRUE, 
                fixed_thead = list(enabled = TRUE,
                                   background = "#EDF6FD"
                                   )
                ) |> 
  kable_classic_2() |>                                                              # define o tema da tabela.
  column_spec(1,                                                            # define os padrões da coluna dia.
              bold = FALSE,
              width = "5cm"
              ) |>      
  column_spec(2,                                # define os padrões da coluna "Quantidade de Filmes Lançados".
              bold = FALSE,
              width = "5cm"
              ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",               # cria o rodapé da tabela.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )
```


```{r grafico lancamentos x dias}

### Grafico dias com maior quantidade de filmes ----------------------------------------------------------
plot_dia_filmes <- imdb |> 
  mutate(dia = day(data_lancamento)) |> 
  group_by(dia) |> 
  summarise(qtde = n()) |> 
  drop_na() |> 
  ggplot()+                              # cria o gráfico de lollypop - combinando geom_point e geom_segment.
  aes(x = dia, 
      y = qtde, 
      fill = dia, 
      label = qtde)+
  geom_point(                                                                       # cria elemento circular.
    size = 5,                                                                                     # diâmetro.
    color = "#CC5A71"                                                                         # cor vermelha.
  )+
  geom_label(                                                                           # formatar os labels.
    size = 4,                                                              # diâmetro do círculo do lollypop.
    alpha = 0,                                                                    # elimina o fundo do label.
    label.size = NA,                                                 # elimina a moldura retangular do label.
    color = "#CC5A71",                                                          # cor do círculo em vermelho.
    vjust = -1,                                                          # posição do label acima do círculo.
  ) +
  geom_segment(aes(x = dia,                                                      # criar o elemento segmento.
                   xend = dia,
                   y = 0,
                   yend = qtde
  ),
  size = 1.5,                                                                          # largura do segmento.
  color = "#CC5A71"                                                            # cor do segmento em vermelho.
  )+
  gghighlight(dia == 1 | dia == 31,                                                 # destaca os dias 1 e 31. 
              unhighlighted_params = list(colour = "#4C586B")                     # cor cinza para os demais.
  )+
  labs(                                                               # editar o texto do título em markdown.
    title = "Total de lançamentos por *<span style = 'color:#CC5A71;'>dia </span>*",
    subtitle ="Os dias com maior e menor quantidade de estreias",         # editao o texto subtítulo em text.
    y = "Quantidade de filmes
    ",
    x = "
    Dias do mês"
  ) +
  theme_classic()+                                                              # seleção do tema do gráfico.
  scale_y_continuous(breaks = seq(0, 8000, 1000),
                     limits = c(0,8000)) +                                       # formatar escala do eixo y.  
  scale_x_continuous(breaks = seq(0, 31, 1)) +                                   # formatar escala do eixo x.
  theme(                                                          # customizar:
    panel.background = element_rect(fill = "#FFFFFF"),                                    # fundo do gráfico.
    plot.background = element_rect(fill = "#FFFFFF"),                          # fundo da moldura retangular.
    plot.margin = unit(c(1, 1, 1, 1), "cm"),                                         # distância das margens.
    plot.title = element_markdown(                                           # título do gráfico em markdown.
      size = 24,
      family = "Arial",                                                                    # fonte do título.
      margin = unit(c(0, 0, 0.5, 0), "cm")                                               # margens do título.
    ), 
    plot.subtitle = element_text(                                                       #textos do subtitulo.
      size = 14,
      family = "Arial",   
    ),
    text = element_text(                                                                 # textos do gráfico.
      family = "Arial",    
      color = "#000000",
      size = 14
    ),
    axis.text.x = element_text(                                                            # texto do eixo x.
      color = "#000000",       
      size = 15,
      margin = unit(c(0.3, 0, 0.5, 0), "cm")  
    ),
    axis.text.y = element_markdown(                                                        # texto do eixo y.
      color = "#000000",    
      size = 15,
      family = "Arial", 
    ),
    axis.ticks.x = element_line(color = "#1F1F1F"),                                        # ticks do eixo x.
    axis.line.x = element_line(color = "#1F1F1F"),                                  # cor da linha do eixo x.
    axis.ticks.y = element_line(color = "#1F1F1F"),                            # padrões dos ticks do eixo x.
    axis.line.y = element_line(
      color = "#000000",                                                            # cor da linha do eixo x.
      size = 0.4,
    ),
    axis.title = element_text(                                                   # texto do título do eixo x.
      size = 16,
      hjust = 0.5,
    ),
    legend.position = "none"                                                              # exclui a legenda.
  ) 

plot_dia_filmes                                                                        # visualiza o gráfico.

```


::: {align="justify" style="text-indent: 3em;"}
Ao longo da história, o dia `r dia_maior_lancamento$dia`º foi aquele com a maior número de lançamentos. No total, foram `r dia_maior_lancamento$qtde` estréias neste dia. Depois os dias 15 com 2831, 14 com 2728 e 25 com 2727 filmes. 

A maior frequência de "*premieres*" neste dia, indica uma preferência de muitas produtoras em realizar as estreias de suas obras neste dia. 

:::

<br>

### <font color = #303E28> 3. Os paises com maior número de filmes </font>

<br>

::: {align="justify" style="text-indent: 3em;"}
De acordo com o [instituto do cinema](https://www.institutodecinema.com.br/mais/conteudo/bollywood-e-seu-jeito-lucrativo-de-fazer-cinema-), Hollywood não é a maior indústria cinematográfica do mundo. Este lugar é ocupado pela produtora Bollywood. Os indianos produzem cerca de 1500 filmes por ano e por se tratar do segundo país mais populoso do mundo tem uma média de espectadores superior a meio milhão por mês.

Todavia, segundo a base IMDB e considerando toda a história do cinema, qual seria o país com maior número de filmes produzidos?
:::

<br>

```{r top 5 de paises com mais filmes na base}
#| fig.out = 100

## Manipulação da base para a obtencão dos 5 países com mais filmes na base --------------------------
top_5_paises <- imdb |> 
  group_by(pais) |> 
  summarise(qtde = n()) |> 
  arrange(desc(qtde)) |> 
  slice_head(n=5)

## Tabela com os dados do dia com maior número de lançamentos ----------------------------------------
top_5_paises |>                                                                        
  kbl(align = "l",                                                        # alinhamento do texto do cabeçalho.
      col.names = c("País",                                                       # define o nome das colunas.
                  "Quantidade de Filmes Lançados"
                  ),
      ) |> 
  kable_styling(  bootstrap_options = c("striped",                                # define o estilo da tabela.
                                        "condensed"),
                  html_font = "Arial",
                  font_size = 10,
                  full_width = TRUE, 
                  fixed_thead = list(enabled = TRUE, 
                                     background = "#EDF6FD"
                                     )
                  ) |> 
  kable_classic_2() |>                                                              # define o tema da tabela.
  column_spec(1,                                                   # altera as configurações da coluna "País".
              bold = FALSE,
              width = "5cm"
  ) |>      
  column_spec(2,                          # altera as configurações da coluna "Quantidade de Filmes Lançados".
              bold = FALSE,
              width = "5cm"
  ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",               # cria o rodapé da tabela.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
  )

```

```{r grafico paises x qtde de filmes}
#| echo = TRUE,

### Manipulando os dados para obtenção dos 16 países com maiores quantidades de filmes lançados------
top_16_paises <- imdb |> 
  group_by(pais) |> 
  summarise(qtde = n()) |> 
  arrange(desc(qtde)) |> 
  slice_head(n=16)

### Palete de cores

cor <- c(                                                       # paleta  de cores para os elementos gráficos.
  "#c42847", "#ffad05", "#7d5ba6", "#00bbf9", "#2bc016",
  "#B2DDF7", "#B2DDF7", "#B2DDF7", "#B2DDF7", "#B2DDF7",
  "#B2DDF7", "#B2DDF7", "#B2DDF7", "#B2DDF7", "#B2DDF7",
  "#365F6D"
)

### Gráfico com os 16 países com maior número de filmes produzidos

plot_top_16_paises <- top_16_paises |> 
  ggplot(aes(y = fct_reorder(pais,      # reordenar a sequência dos países em ordem decrescente da quantidade.
                             qtde, 
                             .desc = FALSE
                             ),
             x = qtde, 
             label = qtde
             )
         ) +
  geom_col(fill = cor)+
  geom_label(size = 4.5,                                                                 # formatar os labels.
             alpha = 0,
             label.size = NA,    
             fontface = "plain",  
             color = "#000000",
             hjust = -0.3
             ) +
  geom_curve(aes(y = 14,                   # formatar curva para anotação " Relação dos países com mais.....".
                 x = 8000,  
                 xend = 15000,     
                 yend = 10
                 ),
             arrow = arrow(type = "closed",                                         # formata a seta da linha.
                           length = unit(0.02, "npc"
                                         )
                           ),
             curvature = -0.14,  
             color = "#000000" 
             ) +
  geom_curve(aes(y = 1,                             # formatar curva para anotação "Décima sexta posição....".
                 x = 3000,  
                 xend = 9500,     
                 yend = 2
                 ),
             arrow = arrow(type = "closed",                                         # formata a seta da linha.
                           length = unit(0.02,
                                         "npc") 
                           ),
             curvature = 0,                                                           # curvatura = 0 -- reta.
             color = "#000000"
             )+
  labs(                                                                            # define textos do gráfico.
    title = "Países com maior quantidade de lançamentos de filmes",
    subtitle = "Destaque para os cinco paises com maiores notas",
    x = "Quantidade de filmes lançados",
    y = "Paises"
  )+
  scale_x_continuous(                                                    # altera limites e quebras do eixo x.
    breaks = seq(0, 29000,5000),
    limits = c(0,29000)
  )+
  theme_classic()+                                                                 # define o tema do gráfico.
  theme(                                                  # Customizar o gráfico:
    panel.background = element_rect(fill = "#FFFFFF"),                            # altera o fundo do gráfico.
    plot.background = element_rect(fill = "#FFFFFF"),                  # altera o fundo da moldura retangular.
    legend.position = "none",                                                               # elimina legenda.
    plot.margin = unit(c(1, 1.5, 0.5, 1), "cm"),                          # distâncias do gráfico das margens.
    plot.title = element_text(                                          # define padrões do título do gráfico.
      size = 24,
      family = "Arial",
      margin = unit(c(0.3, 0, 0.5, -0,2), "cm")
    ), 
    plot.subtitle = element_text(                                    # define padrões do subtítulo do gráfico.
      size = 15,
      family = "Arial",
      margin = unit(c(0, 0, 0.5, 0), "cm")
    ),
    text = element_text(                                               # define padrões dos textos do gráfico.
      family = "Arial",    
      color = "#022859",
      size = 13,
    ),
    axis.text.x = element_text(                                           # define padrões do texto do eixo x.
      color = "#022859",       
      size = 14,
      family = "Arial",
      margin = unit(c(0.5, 0, 0.5, 0), "cm")    
    ),
    axis.text.y = element_markdown(                                       # define padrões do texto do eixo y.
      color = "#022859",    
      size = 14,
      family = "Arial", 
      margin = unit(c(0, 0.5, 0, 0.5), "cm")
    ),
    axis.ticks.x = element_line(color = "#1F1F1F"),                                         # ticks do eixo x.
    axis.line.x = element_line(color = "#1F1F1F"),                                   # cor da linha do eixo x.
    axis.ticks.y = element_line(color = "#1F1F1F"),                             # padrões dos ticks do eixo x.
    axis.line.y = element_line(
      color = "#000000",                                                             # cor da linha do eixo x.
      size = 0.4,
    ),
    axis.title = element_text(                                                    # texto do título do eixo x.
      face = "plain",    
      size = 15,
      hjust = 0.5,
    ),
  )+    
  annotate( "text",
            x = 21000, y = 9, label = "Relação dos cinco países com mais lançamentos 
            registrados na base IMDB",
            color = "#000000", 
            size = 4,
            family = "Arial"
  )+
  annotate( "text",
            x = 14000, y = 2, label = "Décima sexta posição do Brasil",
            color = "#000000", 
            size = 4,
            family = "Arial"
  )

plot_top_16_paises

```

<br>

::: {align="justify" style="text-indent: 3em;"}
No gráfico acima, destaquei a posição do nosso país no ranking. Foram 736 filmes produzidos entre 1931 e 2020.

Apresentamos os cinco filmes com mais de 10000 avaliaçoes, com as maiores pontuaçoes medias da imdb.
:::

<br>

```{r tabela - melhores filmes brasileiros - ranking imdb }

# Análise dos filmes brasileiros com maior ranking
top_5_filmes_brasil <- imdb |> 
  filter(pais == "Brazil" & num_avaliacoes >= 10000) |> 
  summarise( titulo, 
             ano, 
             genero, 
             nota_imdb,
             num_avaliacoes)|>
  arrange(desc(nota_imdb)) |> 
  slice_head(n = 5)

# Gŕafico dos filmes brasileiros com maior ranking
top_5_filmes_brasil |>                                                                        
  kbl(
    align = "l",                                                          # alinhamento do texto do cabeçalho.
    col.names = c("Título",                                                       # define o nome das colunas.
                  "Ano",
                  "Gênero",
                  "Nota IMDB",
                  "Numero de Avaliações"),
    ) |> 
  kable_styling(                                                                  # altera o estilo da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "Arial",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                          # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "7cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              # background = "#022859",
              # color = "#FFFFFF",
              width = "3cm"
              ) |> 
  column_spec(3,                                                          # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>
  column_spec(4,                                                          # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>
  column_spec(5,                                                          # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>
    footnote(general = "Base de dados IMDB (Internet Movie Database).",                     # inseri o rodapé.
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )
```

<br>

### <font color = #303E28> 4. Lista de todas as moedas citadas na base </font>

<br>

::: {align="justify" style="text-indent: 3em;"}
A variável orçamento representa o valor total estimado de gastos para a produção da obra cinematográfica ou de uma série. A indústria de filmes movimenta bilhões de dólares usados para a contratação de técnologias para produção de efeitos especiasi, trilhas sonoras, pagamento de suas equipes de produção e direção e artistas. 

A base analisada apresenta os valores de orçamento em variadas moedas, a depender do país da produção. Vamos relacionar quais são as moedas presentes no *dataset* e apresentá-las na tabela abaixo.

:::

<br>

```{r tabela - moedas na base - orçamento}

# lista de todas as moedas da base - coluna orçamento
moedas_orcamento <- imdb |> 
  select(orcamento) |>
  mutate(moeda = str_extract(string = orcamento,
                             pattern = "[\\w | \\$].* " )
         ) |> 
  distinct(moeda) |> 
  drop_na() |> 
  arrange(moeda)

moedas_orcamento <- moedas_orcamento |> 
  mutate(moeda = str_trim(moeda)) |> 
  mutate(moeda = str_replace(moeda, pattern = "\\$",
                             replacement = "USD"))

# utilizar uma base de moedas e suas divisas para juntar à tabela acima
# importar a tabela xls "siglas_moedas_paises"
tab_moedas <- readxl::read_xlsx("../data-raw/siglas_moedas_paises.xlsx")

# juntar as tabelas moedas_receita e tab_moedas por meio da coluna moeda
moedas_orcamento_unificada<- left_join(x = moedas_orcamento,
                                       y = tab_moedas, 
                                       by = "moeda",
                                       copy = TRUE) |> 
  distinct(moeda, divisa) |> 
  mutate(divisa = str_to_title(divisa))

moedas_orcamento_unificada |> 
  kbl(
    align = "l",                                                          # alinhamento do texto do cabeçalho.
    col.names = c("Moeda",                                                        # define o nome das colunas.
                  "Divisa"),
    ) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    html_font = "Arial",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                                          # altera as configurações da tabela.
              bold = FALSE,
              width = "5cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "5cm"
              ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )
```

<br>

::: {align="justify" style="text-indent: 3em;"}
São `r nrow(moedas_orcamento_unificada)` diferentes moedas utilizadas, que estão relacionadas por meio de seus códigos ISO. Algumas moedas não existem atualmente, como às dos 26 paises do Bloco Europeu que passaram a utilizar o Euro como moeda oficial.

:::
<br>

### <font color = #303E28> 5. Maiores lucros da indústria por gêneros em toda história </font>

<br>

::: {align="justify" style="text-indent: 3em;"}
Considerando a soma dos lucros dos filmes por gênero, podemos concluir que:

:::

<br>

```{r tabela - maiores lucros por gênero na história}

# considerando apenas o valores em dólares

filmes_dolares <- imdb |>
  select(orcamento, receita, genero, titulo) |> 
  filter(str_detect(orcamento, pattern = "\\$.*"))

# eliminar o símbolo $ nos valores das colunas orçamento e receita

filmes_dolares <- filmes_dolares |> 
  mutate(orcamento = str_remove(orcamento, pattern = "\\$ "),
         receita = str_remove(receita, pattern = "\\$ "))


# alterar o tipo das variáveis orcamento e  receita

filmes_dolares$orcamento <- as.numeric(filmes_dolares$orcamento)
filmes_dolares$receita <- as.numeric(filmes_dolares$receita)

  
# calcular o lucro dos filmes

filmes_dolares <- filmes_dolares |> 
  mutate(
    lucro = receita - orcamento
  ) |>
  drop_na()


# usar a base imdb, precisamos fazer a separação da coluna genero

filmes_dolares <- filmes_dolares |> 
  separate(col = genero,
           into = c("genero1", "genero2", "genero3"),
           sep = ","
  )

# pivotar a base de wide para long

filmes_dolares <- filmes_dolares |> 
  pivot_longer(
    cols = c("genero1", "genero2", "genero3"),
    names_to = "tipos_generos",
    values_to = "generos",
    values_drop_na = TRUE
  ) |> 
  mutate(generos = str_trim(generos))

# maiores lucros por gênero

lucros_genero <- filmes_dolares |>
  group_by(generos) |>
  summarise(lucro_total = sum(lucro)) |> 
  arrange(desc(lucro_total)) |> 
  slice_head(n=10)
lucros_genero |> 
  kbl(
    align = "l",                                            # alinhamento do texto do cabeçalho.
    col.names = c("Gêneros",                                           # define o nome das colunas.
                  "Lucro Total (US$) "),
    caption = "Maiores lucros por gênero"
    ) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    html_font = "Arial",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                            # altera as configurações da tabela.
              bold = FALSE,
              width = "5cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "5cm"
              ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )

```

<br>

::: {align="justify" style="text-indent: 3em;"}
No caso de a análise ser realizada considerando a soma dos lucros divididos pelo total de filmes realizados em cada gênero o resultado seria o lucro obtido em cada gênero por filme produzido. Nestes termos, o resultado seria:

:::
<br>

```{r tabela - lucro por genero por filme produzido}

lucros_genero_filme <- filmes_dolares |>
  group_by(generos) |>
  summarise(lucro_total = sum(lucro)/n()) |> 
  arrange(desc(lucro_total)) |> 
  slice_head(n=10)

lucros_genero_filme |> 
  kbl(
    align = "l",                                            # alinhamento do texto do cabeçalho.
    col.names = c("Gêneros",                                           # define o nome das colunas.
                  "Lucro Total por Filme Produzido (US$)"),
    ) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    html_font = "Arial",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                            # altera as configurações da tabela.
              bold = FALSE,
              width = "5cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              width = "5cm"
              ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )


```

<br>

### <font color = #303E28> 6. Maiores notas médias por gênero</font>



### <font color = #303E28> Conclusão</font>

#  



# Anexos

## Dicionários

### Dicionário da base IMDB

<br>

<style type="text/css">
.tg  {border-collapse:collapse;border-color:#ccc;border-spacing:0;}
.tg td{background-color:#fff;border-bottom-width:1px;border-color:#ccc;border-style:solid;border-top-width:1px;
  border-width:0px;color:#333;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:4px 10px;
  word-break:normal;}
.tg th{background-color:#f0f0f0;border-bottom-width:1px;border-color:#ccc;border-style:solid;border-top-width:1px;
  border-width:0px;color:#333;font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;
  padding:4px 10px;word-break:normal;}
.tg .tg-5bbp{background-color:#edf6fd;border-color:inherit;font-size:11px;text-align:left;vertical-align:middle}
.tg .tg-i82w{background-color:#f9f9f9;border-color:inherit;font-size:11px;text-align:left;vertical-align:middle}
.tg .tg-ncrr{border-color:inherit;font-size:11px;text-align:left;vertical-align:middle}
@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;}}</style>
<div class="tg-wrap"><table class="tg" style="undefined;table-layout: fixed; width: 834px">
<colgroup>
<col style="width: 211.005682px">
<col style="width: 102.005682px">
<col style="width: 521.005682px">
</colgroup>
<thead>
  <tr>
    <th class="tg-5bbp">Variável</th>
    <th class="tg-5bbp">Tipo</th>
    <th class="tg-5bbp">Descrição</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-i82w">id_filme</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">identificador alfanumérico exclusivo do título</td>
  </tr>
  <tr>
    <td class="tg-ncrr">titulo</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">nome da obra em materiais promocionais na data do lançamento</td>
  </tr>
  <tr>
    <td class="tg-i82w">titulo_original</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">nome original da obra, no idioma original</td>
  </tr>
  <tr>
    <td class="tg-ncrr">ano</td>
    <td class="tg-ncrr">dbl</td>
    <td class="tg-ncrr">ano da produção</td>
  </tr>
  <tr>
    <td class="tg-i82w">data_lancamento</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">data do lançamento do filme ou a data de início da série</td>
  </tr>
  <tr>
    <td class="tg-ncrr">genero</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">inclui até três gêneros associados ao título</td>
  </tr>
  <tr>
    <td class="tg-i82w">duracao</td>
    <td class="tg-i82w">dbl</td>
    <td class="tg-i82w">tempo de execução em minutos</td>
  </tr>
  <tr>
    <td class="tg-ncrr">pais</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">país</td>
  </tr>
  <tr>
    <td class="tg-i82w">idioma</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">idioma</td>
  </tr>
  <tr>
    <td class="tg-ncrr">orcamento</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">orçamento</td>
  </tr>
  <tr>
    <td class="tg-i82w">receita</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">receita</td>
  </tr>
  <tr>
    <td class="tg-ncrr">receita_eua</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">receita nos EUa</td>
  </tr>
  <tr>
    <td class="tg-i82w">nota_imdb</td>
    <td class="tg-i82w">dbl</td>
    <td class="tg-i82w">nota média obtida pela obra nas avaliações dos usuários</td>
  </tr>
  <tr>
    <td class="tg-ncrr">num_avaliacoes</td>
    <td class="tg-ncrr">dbl</td>
    <td class="tg-ncrr">total de avaliações realizadas para cada título</td>
  </tr>
  <tr>
    <td class="tg-i82w">direcao</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">diretor(es)</td>
  </tr>
  <tr>
    <td class="tg-ncrr">roteiro</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">roteirista(s)</td>
  </tr>
  <tr>
    <td class="tg-i82w">producao</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">empresa produtora</td>
  </tr>
  <tr>
    <td class="tg-ncrr">elenco</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">nomes dos integrantes do elenco</td>
  </tr>
  <tr>
    <td class="tg-i82w">descricao</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">sinopse da obra</td>
  </tr>
  <tr>
    <td class="tg-ncrr">num_criticas_publico</td>
    <td class="tg-ncrr">dbl</td>
    <td class="tg-ncrr">total de críticas recebidas do público</td>
  </tr>
  <tr>
    <td class="tg-i82w">num_criticas_critica</td>
    <td class="tg-i82w">dbl</td>
    <td class="tg-i82w">total de críticas recebidas dos críticos</td>
  </tr>
</tbody>
</table></div>

<br>
