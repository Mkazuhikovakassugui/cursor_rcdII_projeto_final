---
title: "I see you"
author: "Marcio Vakassugui"
date: "2022-05-10"
output: 
  html_document: 
    code_folding: hide
    theme: paper
    toc: yes
    toc_float: yes
    smooth_scroll: no
    collapsed: yes
  html_notebook: 
    toc: yes
runtime: shiny
---

```{r setup }
#| include=FALSE

knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  align = "center",
  fig.height = 7,
  fig.width = 14
)
```

```{r inclui figura jogo tabuleiro}
#| fig.align = "right",
#| out.width = "100%",
#| echo = FALSE,
#| out.width = 300 ,
#| out.height = 150,


knitr::include_graphics("http://1.bp.blogspot.com/_c7zUyhjdoVM/S3i8-RDd3II/AAAAAAAAAyY/9kngUbVrtVY/s320/olhar+avatar.jpg")
```

# Introdução

::: {align="justify" style="text-indent: 3em;"}
O IMDB, *Internet Move Database*, é uma das maiores bases pesquisáeis de dados sobre filmes e séries disponíveis para acesso para uso pessoal e não comercial fornecida por um dos mais respeitados *sites* de crítica popular de filmes e séries do mundo. Todos os usuários registrados no [Internet Movie DataBase](https://www.imdb.com/) podem avaliar os filmes, as séries e os documentários com notas de 1 a 10. Na sua página, é possivel encontrar as notas médias dos filmes, *trailers*,  a lista com as principais bilheterias da semana nos Estados Unidos, informações sobre o elenco e direção, resenhas de críticos, galerias de fotos e curiosidades.

Este trabalho de conclusão de curso objetiva a aplicação dos recursos abordados no curso "R para Ciência de Dados II", como organização de projetos, manipulação dos dados por meio dos pacotes *__dplyr__* e *__tidyr__*, de textos com  *__stringr__*, de datas e fatores com *__lubridade__* e *forcats* respectivamente, além de outras ferramentas e pacotes importantes como "*__expressões regulares__*", "*__funções anônimas__*", *__git__* e *__github__* e aplicações dos pacotes *__purrr__* e *__nse__*.

O conteúdo deste projeto é direcionado aos leitores interessados na sétima arte, que não abrem mão de assistir a um filme, na aconchegante poltrona de casa ou do cinema. Caso também tenha interesse em linguagem R, encontrará facilmente os códigos da manipulação dos dados e das gerações dos gráficos e tabelas.

Trarei algumas curiosidades sobre a base IMDB e também sobre um filme me impressionou o público há 12 anos com o lançamento do seu capítulo 1 e que em dezembro de 2022 retornará às telas dos cinemas de todo o mundo para a apresentação do segundo  de um total de cinco capítulos. 
:::


```{r carregar os pacotes}
#| echo = FALSE

library(lubridate)
library(tidyverse)
library(lubridate)
library(shiny)
library(ggthemes)
library(kableExtra)
library(ggtext)
library(forcats)
library(ggplot2)
library(readr)
library(plotly)

```

```{r  Leitura das bases}
#| echo = FALSE

# remotes::install_github("curso-r/basesCursoR")
# imdb <- basesCursoR::pegar_base("imdb_completa")
# imdb_pessoas <- basesCursoR::pegar_base("imdb_pessoas")
# imdb_avaliacoes <- basesCursoR::pegar_base("imdb_avaliacoes")

imdb <- read_rds("../data-raw/imdb.rds")
imdb_avaliacoes <- read_rds("../data-raw/imdb_avaliacoes.rds")
imdb_pessoas <- read_rds("../data-raw/imdb_pessoas.rds")
    
```

```{r manipulação de dados}
#| echo = FALSE

# alterar o tipo da variável data_lancamento de "char" para "date" -----------------------------

imdb <- imdb |>    
  mutate(
    data_lancamento = ymd(data_lancamento),                               # conversão para date.
  )
```

<br>

# Análises

::: {align="justify" style="text-indent: 3em;"}

As três bases analisadas (imdb, imdb_avaliacoes e imdb_pessoas) possuem em suas primeiras linhas os cabeçalhos com nomes de suas  variáveis. O *database* imdb possui `r nrow(imdb)` linhas com `r ncol(imdb)` variáveis e conta com os dados de lançamentos entre 1894 a 2020. O *database* imdb_avaliacoes também possui `r nrow(imdb_avaliacoes)` linhas e `r ncol(imdb_avaliacoes)` colunas e o *database* imd_pessoas possui `r nrow(imdb_pessoas)` linhas  `r ncol(imdb_pessoas)` variáveis.

Na seção Anexos, ao final deste relatório,  encontram-se os dicionários das bases com as designações das variáveis e suas descrições.

Todos os códigos de preparação  e de manipulação das bases como limpeza dos dados, união e junção de tabelas, entre outras, estão disponíveis para visualização, juntamente com os códigos de construção das tabelas e gráficos por meio do botão "code/hide". 

Em cada tópico analisaremos uma questão sobre a base IMDB e apresentaremos a resposta.

:::

### 1. Um mês muito especial

Em que mês, em toda  história, ocorreu o maior número de estreias de filmes e ou séries? 

```{r preparacao da base e tabela mes com mairo numero de lancamentos de filmes}
## Manipulação da base para determinação do mês com maior número de lançamentos de filmes

imdb <- imdb |>                                              # converte variável para tipo date.
  mutate(
    data_lancamento = ymd(data_lancamento))                            


imdb_datas <- imdb |>                     # retorna mes como oprimeiro dia do mês de lançamento.
  mutate(
    mes = floor_date(data_lancamento, "month")      
  )

mes_maior_lancamento <- imdb_datas |>           # Obtém o mês com o maior número de lançamentos.
  group_by(mes) |>        
  summarise(qte = n()) |>             
  separate(  
    col = mes,                         
    into = c("ano", "mes")) |>                                     
  drop_na() |> 
  slice_max(
    order_by = qte
  ) 

## Tabela com  os dados do mês com o maior número de lançamentos

mes_maior_lancamento |>                                                                
kbl(
  align = "l",                                              # alinhamento do texto do cabeçalho.
  col.names = c("Ano de Lançamento",                              # define o nome das variáveis.
                "Mês", 
                "Quantidade de Filmes Lançados"),
  caption = "Outubro de 2018",
  full_width = TRUE,
  #format = "simple"
) |> 
  kable_styling(                                            # altera as configurações da tabela.
    html_font = "get_schwifty",
    bootstrap_options = "basic",
    font_size = 10,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
  ) |> 
  kable_classic_2() |> 
  column_spec(1,                                          # altera as configurações das colunas.
              bold = FALSE,
              #background = "#022859", 
              #color = "#FFFFFF",
              width = "3cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              # background = "#022859",
              # color = "#FFFFFF",
              width = "3cm"
              ) |>
  column_spec(3,
              bold = FALSE,
              # background = "#022859",
              # color = "#FFFFFF",
              width = "4cm"
              ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )

```



::: {align="justify" style="text-indent: 3em;"}
Em Outubro de `r mes_maior_lancamento$ano`, foram lançados `r mes_maior_lancamento$qte` filmes. Este foi o mês em toda a história da indústria cinematográfica com o maior número de lançamentos em um mês.

No gráfico abaixo, apresentamos os trinta meses com as maiores quantidades de lançamentos ocorridos.

```{r qtde de filmes por ano}
#| echo = TRUE,
#| fig.height = 4,
#| fig.width = 9,
#| fig.cap = "Quantidade de Filmes por Ano ao Longo da História",
#| highlight = TRUE



filmes_ano <- imdb |> 
  mutate(ano_lancamento = year(data_lancamento)) |> 
  select(ano_lancamento) |> 
  drop_na() |>
  group_by(ano_lancamento) |> 
  summarise(qte = n()) |> 
  slice_head(n=112) |> 
  ggplot()+
  aes(x = ano_lancamento, y = qte)+
  geom_line()+
  geom_point(
    color = "blue",
    shape = 7,
    size = 0.5
  )+
  theme_classic()
  

filmes_ano |> 
  ggplotly()

```






Na tabela abaixo listamos os 30 filmes lançados nesta data em ordem descrescente de suas notas médias IMDB. Consideramos somente os filmes com numero de avaliações superiores a 10000 pessoas.
:::

```{r relacao dos 10 filmes de outubro de 2018 com maior numero de lancamentos }

## Manipulação da base para obtenção da relação dos 30 filmes por ranking 

mes_maior_lancamento <- imdb_datas |>                 # lista dos 30 filmes com melhor ranking.
  group_by(mes) |>        
  summarise(qte = n(),
            titulo,
            data_lancamento, 
            nota_imdb, 
            num_avaliacoes,
            pais) |>
  filter(mes == "2018-10-1" & num_avaliacoes >= 10000) |> 
  arrange(desc(nota_imdb)) |> 
  slice_head(n=10)

mes_maior_lancamento$mes <- NULL                                          # Exclusão de colunas. 
mes_maior_lancamento$qte <- NULL

## Tabela com os 10 filmes  de outubro de 2018com melhores rankings

mes_maior_lancamento |>                                                               
kbl(
  align = "l",                                              # alinhamento do texto do cabeçalho.
  col.names = c("título",                                         # define o nome das variáveis.
                "lançamento", 
                "nota",
                "avaliações",
                "país"),
  caption = "10 melhores rankings de Outubro de 2018 ",
  ) |> 
  kable_styling(                                            # altera as configurações da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "get_schwifty",
    font_size = 10,
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD"),
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                          # altera as configurações das colunas.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "3cm",
              ) |>      
  column_spec(2, 
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "1cm"
              
              ) |>
  column_spec(3,
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "1cm"
              ) |> 
  column_spec(4,
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "1cm"
              ) |> 
  column_spec(5,
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "4cm"
              ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )
```

::: {align="justify" style="text-indent: 3em;"}
Ratsasan é um filme de terror e foi produzido em língua tamil. Conta a história de de um aspirante a diretor de cinema que se torna policial após a morte de seu pai e tenta rastrear um serial *killer*.
:::

<br>

## Um dia muito especial

::: {align="justify" style="text-indent: 3em;"}
E qual seria o dia com a maior quantidade de filmes lançados? Podemos fazer esta análise. Novamente, código e resposta abaixo.
:::

```{r dia com o maior numero de lancamento}

## Manipulação da base para a obtencão do dia com o maior número de lançamentos

dia_maior_lancamento <- imdb |> 
  mutate(dia = day(data_lancamento)) |> 
  group_by(dia) |> 
  summarise(qtde = n()) |> 
  drop_na() |> 
  slice_max(order_by = qtde)

## Tabela com os dados do dia com maior número de lançamentos

dia_maior_lancamento |>                                                                
  kbl(
    align = "l",                                            # alinhamento do texto do cabeçalho.
    col.names = c("Dia", 
                  "Quantidade de Filmes Lançados"),                 # define o nome das colunas.
  caption = "Primeiro dia dos meses",
    ) |> 
  kable_styling(                                            # altera as configurações da tabela.
    bootstrap_options = c("striped", "condensed"),
    html_font = "get_schwifty",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,
              bold = FALSE,
              # background = "#022859",
              # color = "#FFFFFF",
              width = "5cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              # background = "#022859",
              # color = "#FFFFFF",
              width = "5cm"
              ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )
```

::: {align="justify" style="text-indent: 3em;"}
Os `r dia_maior_lancamento$dia`ºs dia dos mêses são os preferidos pelas produtoras para os lançamentos. Foram `r dia_maior_lancamento$qtde` estréias neste dia ao longo dos anos. Seguido pelos dias 15 com 2831, 14 com 2728 e 25 com 2727 filmes.
:::

<br>

## Os paises com maior número de filmes

::: {align="justify" style="text-indent: 3em;"}
De acordo com a base IMDB temos a seguinte relação dos países com mais filmes:
:::

```{r top 5 de paises com mais filmes na base}

## Manipulação da base para a obtencão dos 5 países com mais filmes na base

top_5_paises <- imdb |> 
  group_by(pais) |> 
  summarise(qtde = n()) |> 
  arrange(desc(qtde)) |> 
  slice_head(n=5)

## Tabela com os dados do dia com maior número de lançamentos

top_5_paises |>                                                                        
  kbl(
    align = "l",                                            # alinhamento do texto do cabeçalho.
    col.names = c("País",                                           # define o nome das colunas.
                  "Quantidade de Filmes Lançados"),
    caption = "Cinco países com maior quantidade de filmes produzidos"
    ) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    html_font = "get_schwifty",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                            # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              # background = "#022859",
              # color = "#FFFFFF",
              width = "5cm"
              ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )


```

```{r grafico 01}
#| echo = TRUE,
#| fig.height = 7,
#| fig.width = 14,
#| out.width = 1300,
#| out.height = 700


top_20_paises <- imdb |> 
  group_by(pais) |> 
  summarise(qtde = n()) |> 
  arrange(desc(qtde)) |> 
  slice_head(n=16)

cor <- c(                                         # paleta  de cores para os elementos gráficos.
  "#c42847", "#ffad05", "#7d5ba6", "#00bbf9", "#2bc016",
  "#B2DDF7", "#B2DDF7", "#B2DDF7", "#B2DDF7", "#B2DDF7",
  "#B2DDF7", "#B2DDF7", "#B2DDF7", "#B2DDF7", "#B2DDF7",
  "#365F6D"
)

top_20_paises |> 
  ggplot(aes(y = fct_reorder(pais, 
                             qtde, 
                             .desc = FALSE),
             x = qtde, 
             label = qtde
             )
         ) +
    geom_col(fill = cor)+
  geom_label(                                                              # formatar os labels.
    size = 3.8, 
    alpha = 0,
    label.size = NA,    
    fontface = "bold",    
    color = "#FFFFFF",
    hjust = -0.3
  ) +
   geom_curve(aes(y = 14,                                        # formatar curva para anotação.
                  x = 6000,  
                  xend = 15000,     
                  yend = 10   
   ),
   arrow = arrow(                                                    # formatar a seta da curva.
     type = "closed",          
     length = unit(0.02, "npc")     
   ),
   curvature = -0.14,  
   color = "#B2DDF7"   
  ) +
  geom_curve(aes(y = 1,                                          # formatar curva para anotação.
                 x = 2000,  
                 xend = 9500,     
                 yend = 2   
  ),
  arrow = arrow(                                                     # formatar a seta da curva.
    type = "closed",          
    length = unit(0.02, "npc")     
  ),
  curvature = 0,  
  color = "#B2DDF7"
  )+
  labs(
    title = "Países com maior quantidade de lançamentos de filmes",
    subtitle = "Destaque para os cinco paises com maiores notas",
    x = "Quantidade de filmes lançados",
    y = "Paises"
  )+
  scale_x_continuous(
    breaks = seq(0, 29000,10000),
    limits = c(0,29000)
  )+
  theme_classic()+
  theme(
    panel.background = element_rect(fill = "#022859"),                       # fundo do gráfico.
    plot.background = element_rect(fill = "#B2DDF7"),             # fundo da moldura retangular.
    legend.position = "none",
    plot.margin = unit(c(1, 1.5, 0.5, 1), "cm"),
    plot.title = element_markdown(                                          # título do gráfico.
      size = 32,
      face = "plain",
      family = "NationalHero!",
      hjust = 0.5,
      margin = unit(c(0.3, 0, 0.5, -0,2), "cm")
    ), 
    plot.subtitle = element_markdown(
      size = 14,
      hjust = 0,
      family = "arial",
      margin = unit(c(0, 0, 0.5, 0), "cm")
    ),
    text = element_text(                                                    # textos do gráfica.
      family = "arial",    
      color = "#022859",
      size = 11,
      hjust = 0,
      face = "bold"
    ),
    axis.text.x = element_text(                                           # texto do eixo x.
      color = "#022859",       
      size = 11,
      face = "bold",
      family = "Rio2016",
      margin = unit(c(0.5, 0, 0.5, 0), "cm")  
    ),
    axis.text.y = element_markdown(                                       # texto do eixo y.
      color = "#022859",    
      size = 13,
      face = "bold",
      family = "Rio2016", 
      margin = unit(c(0, 0.5, 0, 0.5), "cm")
    ),
    axis.ticks.x = element_line(color = "#1F1F1F"),                         # ticks do eixo x.
    axis.line.x = element_line(color = "#1F1F1F"),                   # cor da linha do eixo x.
    axis.ticks.y = element_line(color = "#1F1F1F"),             # padrões dos ticks do eixo x.
    axis.line.y = element_line(
      color = "#000000",                                           # cor da linha do eixo x.
      size = 0.4,
    ),
    axis.title = element_text(                                    # texto do título do eixo x.
      face = "bold",    
      size = 13,
      hjust = 0.5,
    )
  )+    
  annotate( "text",
            x = 21000, y = 9, label = "Relação dos cinco países com mais lançamentos 
            registrados na base IMDB",
            color = "#B2DDF7", 
            size = 4,
            family = "arial",
            fontface = "bold"
  )+
  annotate( "text",
            x = 14000, y = 2, label = "Décima sexta posição do Brasil",
            color = "#B2DDF7", 
            size = 4,
            family = "arial",
            fontface = "bold"
  )

```

::: {align="justify" style="text-indent: 3em;"}
No gráfico acima, destaquei a posição do nosso país no ranking. Foram 736 filmes produzidos entre 1931 e 2020.

Apresentamos os cinco filmes com mais de 10000 avaliaçoes, com as maiores pontuaçoes medias da imdb.
:::

```{r tabela - melhores filmes brasileiros - ranking imdb }

# os filmes brasileiros com maior ranking

top_5_filmes_brasil <- imdb |> 
  filter(pais == "Brazil" & num_avaliacoes >= 10000) |> 
  summarise( titulo, 
             ano, 
             genero, 
             nota_imdb,
             num_avaliacoes)|>
  arrange(desc(nota_imdb)) |> 
  slice_head(n = 5)


top_5_filmes_brasil |>                                                                        
  kbl(
    align = "l",                                            # alinhamento do texto do cabeçalho.
    col.names = c("Título",                                           # define o nome das colunas.
                  "Ano",
                  "Gênero",
                  "Nota IMDB",
                  "Numero de Avaliações"),
    caption = "Filmes brasileiros com melhores rankings"
    ) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    html_font = "get_schwifty",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                            # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              # background = "#022859",
              # color = "#FFFFFF",
              width = "5cm"
              ) |> 
  column_spec(3,                                            # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>
  column_spec(4,                                            # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>
  column_spec(5,                                            # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>
  
  footnote(general = "Base de dados IMDB (Internet Movie Database).",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )
```

## Lista de todas as moedas citadas na base

A variável orçamento representa o valor total estimado de gastos para a produção da obra cinematográfica ou de uma série. A indústria de filmes movimenta bilhões de dólares usados para a contratação de técnologias para produção de efeitos especiasi, trilhas sonoras, pagamento de suas equipes de produção e direção e artistas. 

A base analisada apresenta os valores de orçamento em variadas moedas, a depender do país da produção. Vamos relacionar quais são as moedas presentes no *dataset* e apresentá-las na tabela abaixo.

```{r tabela - moedas na base - orçamento}

# lista de todas as moedas da base - coluna orçamento
moedas_orcamento <- imdb |> 
  select(orcamento) |>
  mutate(moeda = str_extract(string = orcamento,
                             pattern = "[\\w | \\$].* " )
         ) |> 
  distinct(moeda) |> 
  drop_na() |> 
  arrange(moeda)

moedas_orcamento <- moedas_orcamento |> 
  mutate(moeda = str_trim(moeda)) |> 
  mutate(moeda = str_replace(moeda, pattern = "\\$",
                             replacement = "USD"))

# utilizar uma base de moedas e suas divisas para juntar à tabela acima
# importar a tabela xls "siglas_moedas_paises"
tab_moedas <- readxl::read_xlsx("../data-raw/siglas_moedas_paises.xlsx")

# juntar as tabelas moedas_receita e tab_moedas por meio da coluna moeda
moedas_orcamento_unificada<- left_join(x = moedas_orcamento,
                                       y = tab_moedas, 
                                       by = "moeda",
                                       copy = TRUE) |> 
  distinct(moeda, divisa) |> 
  mutate(divisa = str_to_title(divisa))

moedas_orcamento_unificada |> 
  kbl(
    align = "l",                                            # alinhamento do texto do cabeçalho.
    col.names = c("Moeda",                                           # define o nome das colunas.
                  "Divisa"),
    caption = "Moedas dos orçamentos dos filmes"
    ) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    html_font = "get_schwifty",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                            # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              # background = "#022859",
              # color = "#FFFFFF",
              width = "5cm"
              ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )
```

São `r nrow(moedas_orcamento_unificada)` diferentes moedas utilizadas, que estão relacionadas por meio de seus códigos ISO. Algumas moedas não existem atualmente, como às dos 26 paises do Bloco Europeu que passaram a utilizar o Euro como moeda oficial.


## Maiores lucros da indústria por gêneros em toda história

Considerando a soma dos lucros dos filmes por gênero, podemos concluir que:


```{r tabela - maiores lucros por gênero na história}

# considerando apenas o valores em dólares

filmes_dolares <- imdb |>
  select(orcamento, receita, genero, titulo) |> 
  filter(str_detect(orcamento, pattern = "\\$.*"))

# eliminar o símbolo $ nos valores das colunas orçamento e receita

filmes_dolares <- filmes_dolares |> 
  mutate(orcamento = str_remove(orcamento, pattern = "\\$ "),
         receita = str_remove(receita, pattern = "\\$ "))


# alterar o tipo das variáveis orcamento e  receita

filmes_dolares$orcamento <- as.numeric(filmes_dolares$orcamento)
filmes_dolares$receita <- as.numeric(filmes_dolares$receita)

  
# calcular o lucro dos filmes

filmes_dolares <- filmes_dolares |> 
  mutate(
    lucro = receita - orcamento
  ) |>
  drop_na()


# usar a base imdb, precisamos fazer a separação da coluna genero

filmes_dolares <- filmes_dolares |> 
  separate(col = genero,
           into = c("genero1", "genero2", "genero3"),
           sep = ","
  )

# pivotar a base de wide para long

filmes_dolares <- filmes_dolares |> 
  pivot_longer(
    cols = c("genero1", "genero2", "genero3"),
    names_to = "tipos_generos",
    values_to = "generos",
    values_drop_na = TRUE
  ) |> 
  mutate(generos = str_trim(generos))

# maiores lucros por gênero

lucros_genero <- filmes_dolares |>
  group_by(generos) |>
  summarise(lucro_total = sum(lucro)) |> 
  arrange(desc(lucro_total)) |> 
  slice_head(n=10)


lucros_genero |> 
  kbl(
    align = "l",                                            # alinhamento do texto do cabeçalho.
    col.names = c("Gêneros",                                           # define o nome das colunas.
                  "Lucro Total"),
    caption = "Maiores lucros por gênero"
    ) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    html_font = "get_schwifty",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                            # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              # background = "#022859",
              # color = "#FFFFFF",
              width = "5cm"
              ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )

```

No caso de a análise ser realizada considerando a soma dos lucros divididos pelo total de filmes realizados em cada gênero o resultado seria o lucro obtido em cada gênero por filme produzido. Nestes termos, o resultado seria:


```{r tabela - lucro por genero por filme produzido}

lucros_genero_filme <- filmes_dolares |>
  group_by(generos) |>
  summarise(lucro_total = sum(lucro)/n()) |> 
  arrange(desc(lucro_total)) |> 
  slice_head(n=10)

lucros_genero_filme |> 
  kbl(
    align = "l",                                            # alinhamento do texto do cabeçalho.
    col.names = c("Gêneros",                                           # define o nome das colunas.
                  "Lucro Total por Filme Produzido"),
    caption = "Maiores lucros por filme produzido em cada gênero"
    ) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    html_font = "get_schwifty",
    font_size = 10,       
    full_width = TRUE, 
    fixed_thead = list(enabled = TRUE, background = "#EDF6FD")
    ) |> 
  kable_classic_2() |> 
  column_spec(1,                                            # altera as configurações da tabela.
              bold = FALSE,
              # background = "#022859", 
              # color = "#FFFFFF",
              width = "5cm"
              ) |>      
  column_spec(2, 
              bold = FALSE,
              # background = "#022859",
              # color = "#FFFFFF",
              width = "5cm"
              ) |> 
  footnote(general = "Base de dados IMDB (Internet Movie Database).",
           footnote_as_chunk = TRUE,
           fixed_small_size = TRUE,
           general_title = "Fonte:",
           )


```






# Conclusão 



# Anexos

## Dicionários

### Dicionário da base IMDB

<style type="text/css">
.tg  {border-collapse:collapse;border-color:#ccc;border-spacing:0;}
.tg td{background-color:#fff;border-bottom-width:1px;border-color:#ccc;border-style:solid;border-top-width:1px;
  border-width:0px;color:#333;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:4px 10px;
  word-break:normal;}
.tg th{background-color:#f0f0f0;border-bottom-width:1px;border-color:#ccc;border-style:solid;border-top-width:1px;
  border-width:0px;color:#333;font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;
  padding:4px 10px;word-break:normal;}
.tg .tg-5bbp{background-color:#edf6fd;border-color:inherit;font-size:11px;text-align:left;vertical-align:middle}
.tg .tg-i82w{background-color:#f9f9f9;border-color:inherit;font-size:11px;text-align:left;vertical-align:middle}
.tg .tg-ncrr{border-color:inherit;font-size:11px;text-align:left;vertical-align:middle}
@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;}}</style>
<div class="tg-wrap"><table class="tg" style="undefined;table-layout: fixed; width: 834px">
<colgroup>
<col style="width: 211.005682px">
<col style="width: 102.005682px">
<col style="width: 521.005682px">
</colgroup>
<thead>
  <tr>
    <th class="tg-5bbp">Variável</th>
    <th class="tg-5bbp">Tipo</th>
    <th class="tg-5bbp">Descrição</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-i82w">id_filme</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">identificador alfanumérico exclusivo do título</td>
  </tr>
  <tr>
    <td class="tg-ncrr">titulo</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">nome da obra em materiais promocionais na data do lançamento</td>
  </tr>
  <tr>
    <td class="tg-i82w">titulo_original</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">nome original da obra, no idioma original</td>
  </tr>
  <tr>
    <td class="tg-ncrr">ano</td>
    <td class="tg-ncrr">dbl</td>
    <td class="tg-ncrr">ano da produção</td>
  </tr>
  <tr>
    <td class="tg-i82w">data_lancamento</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">data do lançamento do filme ou a data de início da série</td>
  </tr>
  <tr>
    <td class="tg-ncrr">genero</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">inclui até três gêneros associados ao título</td>
  </tr>
  <tr>
    <td class="tg-i82w">duracao</td>
    <td class="tg-i82w">dbl</td>
    <td class="tg-i82w">tempo de execução em minutos</td>
  </tr>
  <tr>
    <td class="tg-ncrr">pais</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">país</td>
  </tr>
  <tr>
    <td class="tg-i82w">idioma</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">idioma</td>
  </tr>
  <tr>
    <td class="tg-ncrr">orcamento</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">orçamento</td>
  </tr>
  <tr>
    <td class="tg-i82w">receita</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">receita</td>
  </tr>
  <tr>
    <td class="tg-ncrr">receita_eua</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">receita nos EUa</td>
  </tr>
  <tr>
    <td class="tg-i82w">nota_imdb</td>
    <td class="tg-i82w">dbl</td>
    <td class="tg-i82w">nota média obtida pela obra nas avaliações dos usuários</td>
  </tr>
  <tr>
    <td class="tg-ncrr">num_avaliacoes</td>
    <td class="tg-ncrr">dbl</td>
    <td class="tg-ncrr">total de avaliações realizadas para cada título</td>
  </tr>
  <tr>
    <td class="tg-i82w">direcao</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">diretor(es)</td>
  </tr>
  <tr>
    <td class="tg-ncrr">roteiro</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">roteirista(s)</td>
  </tr>
  <tr>
    <td class="tg-i82w">producao</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">empresa produtora</td>
  </tr>
  <tr>
    <td class="tg-ncrr">elenco</td>
    <td class="tg-ncrr">chr</td>
    <td class="tg-ncrr">nomes dos integrantes do elenco</td>
  </tr>
  <tr>
    <td class="tg-i82w">descricao</td>
    <td class="tg-i82w">chr</td>
    <td class="tg-i82w">sinopse da obra</td>
  </tr>
  <tr>
    <td class="tg-ncrr">num_criticas_publico</td>
    <td class="tg-ncrr">dbl</td>
    <td class="tg-ncrr">total de críticas recebidas do público</td>
  </tr>
  <tr>
    <td class="tg-i82w">num_criticas_critica</td>
    <td class="tg-i82w">dbl</td>
    <td class="tg-i82w">total de críticas recebidas dos críticos</td>
  </tr>
</tbody>
</table></div>

